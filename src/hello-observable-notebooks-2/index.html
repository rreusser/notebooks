<!doctype html>
<notebook theme="air">
  <title>Hello, Observable Notebooks 2.0!</title>
  <script id="1" type="text/markdown">
    # Hello, Observable Notebooks 2.0!
  </script>
  <script id="21" type="text/markdown">
    [Observable Notebooks 2.0](https://observablehq.com/notebook-kit/) is here! And my first impression is‚Ä¶ it‚Äôs *good*.
  </script>
  <script id="67" type="text/markdown">
    More important than anything I have to say about it, it was perfectly easy to integrate into my website and *you‚Äôre looking at it.*  üéâüçæü•≥
  </script>
  <script id="2" type="text/markdown">
    Let‚Äôs back up. I‚Äôve been a strong believer in [Observable](https://observablehq.com/) notebooks since the public beta launched in 2018. It‚Äôs the coding environment I always wanted but had not myself managed to will into existence. Reactive cell evaluation conforms easily to my mental model of how code should run, and Observable‚Äôs editor UI/UX and product execution has always been top-notch. [Observable Plot](https://observablehq.com/plot/) is wonderful. I have about 520 private notebooks, about about [sixty of which](https://observablehq.com/collection/@rreusser/writeups) are somewhat presentable.
  </script>
  <script id="15" type="text/markdown">
    Of course Observable isn‚Äôt perfect. [Observable-flavored JavaScript](https://observablehq.com/documentation/cells/observable-javascript) isn‚Äôt for everyone. JavaScript libraries to power numerical analysis have always been underpowered. The vertically-tall notebook format doesn‚Äôt perfectly fit horizontally-wide screens. And ‚Äú[Please](https://talk.observablehq.com/t/dataflow-a-self-hosted-observable-notebook-editor/5055) [allow](https://talk.observablehq.com/t/offline-editor/4905) [us](https://talk.observablehq.com/t/noob-can-you-run-your-own-observable-server/757/1) [to](https://talk.observablehq.com/t/private-installations/501) [edit](https://talk.observablehq.com/t/notebooks-as-offline-first-single-webfiles/10145) [notebooks](https://talk.observablehq.com/t/where-is-observable-going/10372) [outside of Observable](https://talk.observablehq.com/t/source-control-observable/3117)‚Äù has been a long-running feature request.
  </script>
  <script id="16" type="text/markdown">
    Finally, and perhaps most importantly, I‚Äôve always been uneasy about ceding control of my work to a private company. From everything I can see as an outsider, they‚Äôre wonderful people making wonderful products. Still, it‚Äôs a roll of the dice to fully trust that notebooks I create today will be here tomorrow.
  </script>
  <script id="17" type="text/markdown">
    They haven‚Äôt suddenly solved everything, but when I saw the [Observable Desktop](https://observablehq.com/notebook-kit/desktop) and [Observable Notebook Kit](https://github.com/observablehq/notebook-kit) product announcements, it was quickly clear they‚Äôd done something meaningful and done it well.
  </script>
  <script id="18" type="text/markdown">
    ## Observable Desktop
  </script>
  <script id="19" type="text/markdown">
    I mean, this is it, right? An offline editor application whose output is a human-readable HTML file. What else is there? Notebooks are now just a few lines of code. The interface works offline and if you install a lightweight dev server, you can sidestep the app in favor of a text editor and a web browser.
  </script>
  <script id="20" type="text/markdown">
    ```html
    <!doctype html>
    <notebook theme="air">
      <title>Hello, Observable Notebook Kit</title>
      <script id="1" type="text/markdown">
        # Hello, Observable Notebook Kit
      <\/script>
      ...
    </notebook>
    ```
  </script>
  <script id="37" type="text/markdown">
    There‚Äôs no sense talking this to death. You should [go try the app](https://observablehq.com/notebook-kit/desktop)!
  </script>
  <script id="11" type="text/markdown">
    ## Notebook Kit
  </script>
  <script id="39" type="text/markdown">
    The second new component is [Notebook Kit](https://observablehq.com/notebook-kit/kit). There‚Äôs a bit more to understand here. There are different library components‚Äîvite, build, utility, and runtime‚Äîand I‚Äôve only scratched the surface.
  </script>
  <script id="25" type="text/markdown">
    As far as the coding experience goes, there are some subtle differences. In addition to [Observable JavaScript](https://observablehq.com/documentation/cells/observable-javascript), you can now code in *plain old* JavaScript. It took me a bit of experimentation to understand how this plays with reactive cell evaluation.
  </script>
  <script id="29" type="text/markdown">
    Recall that with Observable JavaScript, each cell has a single output. The runtime performs a topological sort of cell inputs and outputs and executes cells in whatever order is required. Cells look like either a bare value, e.g.
  </script>
  <script id="26" type="application/vnd.observable.javascript" pinned="">
    x = y + 5
  </script>
  <script id="27" type="text/markdown">
    or wrapped in a block with a return statement like this
  </script>
  <script id="28" type="application/vnd.observable.javascript" pinned="">
    y = { return z + 1; }
  </script>
  <script id="40" type="text/markdown">
    The new development is that plain old JavaScript now also plays well with Observable notebooks, though it now takes a `display()` helper to produce visual output.
  </script>
  <script id="32" type="module" pinned="">
    const z = r;
    display(z);
  </script>
  <script id="41" type="text/markdown">
    Notice that `z` has already been used above when defining `x` in an Observable JavaScript cell! It‚Äôs still reactive. From what I can tell, it‚Äôs still working `.js` cells into the topologically-sorted execution order; it‚Äôs just that it now permits plain JavaScript with multiple outputs.
  </script>
  <script id="48" type="text/markdown">
    And as always, this is still Observable, so it‚Äôs all running live and has access to lovely libraries like [Observable Inputs](https://observablehq.com/documentation/inputs/overview).
  </script>
  <script id="47" type="application/vnd.observable.javascript" pinned="">
    viewof r = Inputs.range([1, 10], {step: 1, label: 'r'})
  </script>
  <script id="59" type="text/markdown">
    There do appear to be a few missing features, though of course that‚Äôs to be expected since it‚Äôs billed as a technology preview. For example, pulling in Observable notebook cells with `import` works great. But importing a `viewof` does not.
  </script>
  <script id="61" type="application/vnd.observable.javascript" pinned="">
    import { figure, rotation } from '@rreusser/drawing-3d-objects-with-svg'
  </script>
  <script id="63" type="module" pinned="">
    figure
  </script>
  <script id="62" type="module" pinned="">
    rotation // Fails to import the animating slider!
  </script>
  <script id="66" type="text/markdown">
    Importing the variable `rotation` only imports its value, when what we really want to import `viewof rotation`, i.e. the animating slider. In the web interface, we‚Äôd write that like the following:
  </script>
  <script id="65" type="application/vnd.observable.javascript" pinned="">
    // import { viewof rotation } from '@rreusser/drawing-3d-objects-with-svg'
  </script>
  <script id="60" type="text/markdown">
    but in Notebooks 2.0, this fails. (In fact, it doesn‚Äôt only fail to *run*, `viewof` is a syntax error which causes the static site to fail to *build*.) Compare with the successful import [here](https://observablehq.com/d/fd061c92e0975083).
  </script>
  <script id="38" type="text/markdown">
    ## Integration
  </script>
  <script id="42" type="text/markdown">
    The real moment of truth for me though was discovering what it means to integrate this into my personal website.
  </script>
  <script id="49" type="text/markdown">
    Overall, the story is quite good. It uses the wonderful [Vite](https://vite.dev/) tooling to produce static output. Multiple pages are easy to set up. And you can provide a HTML template to wrap content. I accomplished most of this with some light vite configuration, [which you can find here](https://github.com/rreusser/notebooks/blob/main/vite.config.js).
  </script>
  <script id="71" type="text/markdown">
    I also ended up slightly modifying [@observablehq/notebook-kit](https://github.com/observablehq/notebook-kit) so that I could pull notebook metadata into the surrounding template via a `transformTemplate` function I added. You can find my changes [here](https://github.com/observablehq/notebook-kit/compare/main...rreusser:notebook-kit:transform-template?expand=1), which I may submit as a PR, though I do suspect there are probably better ways to accomplish this.
  </script>
  <script id="52" type="text/markdown">
    ## Conclusion
  </script>
  <script id="53" type="text/markdown">
    I‚Äôve always been a fan of Observable, but with this new tooling, it feels like we‚Äôve sort of arrived. I always wanted sort of a combo blogging platform slash notebook development environment, and for the first time ever, it‚Äôs sort of just unfolded in front of me without any major obstacles.
  </script>
</notebook>
