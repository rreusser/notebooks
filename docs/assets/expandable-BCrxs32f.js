function te(f,{width:P,height:E,toggleOffset:L=[8,8],margin:w=0,padding:C=0,onResize:h,controls:N,state:x,wide:S=!1,maxWidth:U=1200,aspectRatio:T}){let p=x?.expanded??!1,H=P,M=E,b=!1,s={x:16,y:16},o=null,m=!1,y={x:0,y:0};const $=N?Array.isArray(N)?N:[N]:[],g=[];let v=null;const c=document.createElement("div");c.className="expandable-container";const n=document.createElement("div");n.className="expandable-content";const u=document.createElement("div");if(u.className="expandable-overlay",u.addEventListener("click",()=>A()),$.length>0){o=document.createElement("div"),o.className="expandable-controls-panel",o.style.display="none";const l=document.createElement("div");l.className="expandable-controls-header";const e=document.createElement("span");e.textContent="Controls";const t=document.createElement("button");t.className="expandable-controls-toggle",t.innerHTML="▼",t.title="Collapse controls",t.addEventListener("click",r=>{r.stopPropagation(),V()}),l.appendChild(e),l.appendChild(t);const i=document.createElement("div");i.className="expandable-controls-content",o.appendChild(l),o.appendChild(i),l.addEventListener("mousedown",r=>{r.target!==t&&(m=!0,y.x=r.clientX-s.x,y.y=r.clientY-s.y,l.style.cursor="grabbing",r.preventDefault())}),document.addEventListener("mousemove",r=>{m&&(s.x=r.clientX-y.x,s.y=r.clientY-y.y,k(),B())}),document.addEventListener("mouseup",()=>{if(m){m=!1;const r=o?.querySelector(".expandable-controls-header");r&&(r.style.cursor="move")}}),l.addEventListener("touchstart",r=>{if(r.target===t)return;m=!0;const d=r.touches[0];y.x=d.clientX-s.x,y.y=d.clientY-s.y,r.preventDefault()},{passive:!1}),document.addEventListener("touchmove",r=>{if(!m)return;const d=r.touches[0];s.x=d.clientX-y.x,s.y=d.clientY-y.y,k(),B()},{passive:!0}),document.addEventListener("touchend",()=>{m=!1})}function k(){if(!o)return;const l=o.getBoundingClientRect();s.x=Math.max(0,Math.min(s.x,window.innerWidth-l.width)),s.y=Math.max(0,Math.min(s.y,window.innerHeight-l.height))}function B(){o&&p&&(o.style.left=`${s.x}px`,o.style.top=`${s.y}px`)}function V(){if(b=!b,!o)return;const l=o.querySelector(".expandable-controls-content"),e=o.querySelector(".expandable-controls-toggle");b?(l&&(l.style.display="flex"),e&&(e.innerHTML="▼",e.title="Collapse controls")):(l&&(l.style.display="none"),e&&(e.innerHTML="▶",e.title="Expand controls"))}function F(){for(let l=g.length-1;l>=0;l--){const e=g[l];if(e){if(e.placeholder&&e.placeholder.parentNode&&e.placeholder.parentNode.removeChild(e.placeholder),e.selector){const t=document.querySelector(e.selector);if(t&&t!==e.element){e.element.parentNode&&e.element.parentNode.removeChild(e.element);continue}}e.element&&e.originalParent&&(e.originalNextSibling?e.originalParent.insertBefore(e.element,e.originalNextSibling):e.originalParent.appendChild(e.element))}}g.length=0}function Z(){v||(v=new MutationObserver(l=>{if(!p||!o)return;const e=o.querySelector(".expandable-controls-content");if(e)for(const t of g){if(!t.selector)continue;const i=document.querySelector(t.selector);if(i&&i!==t.element&&!e.contains(i)){const r=t.element;t.element=i,t.originalParent=i.parentNode,t.originalNextSibling=i.nextSibling;const d=document.createElement("div");d.className="expandable-controls-placeholder",d.style.display="none",i.parentNode.insertBefore(d,i),t.placeholder&&t.placeholder.parentNode&&t.placeholder.parentNode.removeChild(t.placeholder),t.placeholder=d,r.parentNode===e?(e.insertBefore(i,r),e.removeChild(r)):e.appendChild(i)}}}),v.observe(document.body,{childList:!0,subtree:!0}))}function D(){v&&(v.disconnect(),v=null)}const a=document.createElement("button");if(a.className="expandable-toggle",a.innerHTML="⤢",a.title="Expand",a.style.top=`${-L[1]}px`,a.style.right=`${-L[0]}px`,typeof f=="function"&&(f=f()),typeof f=="string"){const l=document.createElement("div");l.innerHTML=f,f=l.firstElementChild||l}n.appendChild(f),n.appendChild(a),c.appendChild(n);function q(){if(!S||p)return;const l=window.innerWidth,e=Math.min(U,l-40),t=T?Math.round(e/T):E,r=((document.querySelector(".observablehq--cell")?.offsetWidth||640)-e)/2;n.style.width=`${e}px`,n.style.marginLeft=`${r}px`,(e!==H||t!==M)&&(H=e,M=t,h&&h(f,e,t,!1))}S?requestAnimationFrame(q):h&&h(f,P,E,!1);let W=null;function X(){!p&&c.isConnected&&(W=c.offsetHeight)}requestAnimationFrame(()=>{X()});function Y(l,e){H=l,M=e,h&&h(f,l,e,p)}function A(){p=!1,x&&(x.expanded=!1),c.classList.remove("expandable-expanded"),a.innerHTML="⤢",a.title="Expand",a.style.top=`${-L[1]}px`,a.style.right=`${-L[0]}px`,u.parentNode&&u.remove(),D(),o&&(o.classList.remove("expandable-expanded"),o.style.display="none",F()),c.style.height="",n.style.position="relative",n.style.display="inline-block",n.style.top="",n.style.left="",n.style.transform="",n.style.width="",n.style.height="",n.style.marginLeft="",n.style.overflow="",n.style.boxShadow="",n.classList.remove("expanded"),n.style.padding="",n.style.borderRadius="",n.style.zIndex="1",S?requestAnimationFrame(q):Y(P,E),window.dispatchEvent(new Event("resize")),requestAnimationFrame(()=>{X()})}function O(){if(!p)return;const l=window.innerWidth,e=window.innerHeight,[t,i]=Array.isArray(w)?w:[w,w],[r,d]=Array.isArray(C)?C:[C,C],G=l-t*2-r*2,J=e-i*2-d*2,_=G+r*2,R=J+d*2;n.style.position="fixed",n.style.display="block",n.style.width=`${_}px`,n.style.height=`${R}px`,n.style.overflow="hidden",n.style.zIndex="9999",n.style.marginLeft="0",t===0&&i===0?(n.style.top="0",n.style.left="0",n.style.transform="none",n.style.borderRadius="0",n.style.boxShadow="none"):(n.style.top=`${i}px`,n.style.left=`${t}px`,n.style.transform="none",n.style.borderRadius="8px",n.style.boxShadow="0 8px 32px rgba(0,0,0,0.3)"),n.classList.add("expanded"),n.style.padding=`${d}px ${r}px`;const Q=n.querySelector("figure");Q&&(Q.style.margin="0"),Y(G,J)}function I(){if(p=!0,x&&(x.expanded=!0),c.classList.add("expandable-expanded"),a.innerHTML="✕",a.title="Collapse",a.style.top="8px",a.style.right="8px",u.parentNode||document.body.appendChild(u),u.style.opacity="1",u.style.pointerEvents="auto",W?c.style.height=`${W}px`:c.style.height=`${c.offsetHeight}px`,$.length>0&&o){const l=o.querySelector(".expandable-controls-content");if(l)for(const e of $){const t=typeof e=="string"?document.querySelector(e):e;if(!t||!t.parentNode)continue;const i=document.createElement("div");i.className="expandable-controls-placeholder",i.style.height=`${t.offsetHeight}px`,i.style.display="block",g.push({element:t,selector:typeof e=="string"?e:null,originalParent:t.parentNode,originalNextSibling:t.nextSibling,placeholder:i}),t.parentNode.insertBefore(i,t),l.appendChild(t)}if(g.length>0){o.parentNode||document.body.appendChild(o),o.classList.add("expandable-expanded"),o.style.display="",o.style.left=`${s.x}px`,o.style.top=`${s.y}px`,b=!(window.innerWidth<640);const t=o.querySelector(".expandable-controls-content"),i=o.querySelector(".expandable-controls-toggle");b?(t&&(t.style.display="flex"),i&&(i.innerHTML="▼",i.title="Collapse controls")):(t&&(t.style.display="none"),i&&(i.innerHTML="▶",i.title="Expand controls"))}}O(),Z()}a.addEventListener("click",l=>{l.stopPropagation(),p?A():I()});const j=()=>{p?O():S&&q()};window.addEventListener("resize",j);const z=l=>{l.key==="Escape"&&p&&A()};document.addEventListener("keydown",z);const K=new MutationObserver(()=>{document.contains(c)||(document.removeEventListener("keydown",z),window.removeEventListener("resize",j),D(),u.parentNode&&u.remove(),F(),o&&o.parentNode&&o.remove(),K.disconnect())});return K.observe(document.body,{childList:!0,subtree:!0}),Object.defineProperty(c,"expandedDimensions",{get:()=>({width:H,height:M,expanded:p})}),x?.expanded&&requestAnimationFrame(()=>{I()}),c}export{te as expandable};
