function Q({targetData:$,parentLevels:v,levelInfo:p,tileSize:e,pixelSize:E,workgroupSize:J=128,directions:N=[[1,0],[-1,0],[0,1],[0,-1]]}){const g=v.length;if(g<1||g>4)throw new Error(`numLevels must be 1-4, got ${g}`);const w=e+2,L=e*e;if($.length!==w*w)throw new Error(`Target data size mismatch: expected ${w}Ã—${w}, got ${$.length}`);for(let t=0;t<g;t++){const n=p[t].bufferSize*p[t].bufferSize;if(v[t].length!==n)throw new Error(`Parent level ${t} size mismatch: expected ${n}, got ${v[t].length}`)}const A=new Float32Array(L);A.fill(0);const X=1/N.length,Y=-g,M=Math.floor(e*(1+Math.pow(2,Math.abs(Y)))),Z=t=>{const n=[Math.max(0,Math.min(e-1,t[0])),Math.max(0,Math.min(e-1,t[1]))];return n[0]+n[1]*e},q=t=>{const n=[Math.max(-1,Math.min(e+1-1,t[0])),Math.max(-1,Math.min(e+1-1,t[1]))],o=[n[0]+1,n[1]+1];return o[0]+o[1]*w},D=(t,n,o)=>{let s=[0,0];if(o[1]===0){const f=o[0]<0?M-1:0;s[0]=f+o[0]*t,s[1]=n}else{const f=o[1]<0?M-1:0;s[0]=n,s[1]=f+o[1]*t}const h=M*.5,i=e*.5;return[(s[0]-h+i)/e,(s[1]-h+i)/e]},O=t=>t[0]>=0&&t[0]<1&&t[1]>=0&&t[1]<1,F=(t,n)=>{if(n>=g)return!1;const o=p[n];return o.bufferSize===0?!1:t[0]>=o.coverageMin[0]&&t[0]<o.coverageMax[0]&&t[1]>=o.coverageMin[1]&&t[1]<o.coverageMax[1]},P=(t,n)=>{const o=p[n],s=e/o.scale;return[o.targetOffset[0]+t[0]*s,o.targetOffset[1]+t[1]*s]},j=t=>[Math.floor(t[0]*e),Math.floor(t[1]*e)],k=t=>[t[0]*e*E,t[1]*e*E],U=(t,n)=>{const o=p[n],s=P(t,n),h=Math.floor(s[0]),i=Math.floor(s[1]),f=s[0]-h,B=s[1]-i,c=o.bufferSize-1,u=Math.max(0,Math.min(c,h)),x=Math.max(0,Math.min(c,i)),z=Math.max(0,Math.min(c,h+1)),C=Math.max(0,Math.min(c,i+1)),a=v[n],y=a[x*o.bufferSize+u],r=a[x*o.bufferSize+z],m=a[C*o.bufferSize+u],d=a[C*o.bufferSize+z],l=y*(1-f)+r*f,T=m*(1-f)+d*f;return l*(1-B)+T*B},H=t=>{if(O(t)){const n=j(t),o=q(n);return $[o]}for(let n=0;n<g;n++)if(F(t,n))return U(t,n);return 0};for(const t of N)for(let n=0;n<M;n++){let o=[0,0];if(t[1]===0){const u=t[0]<0?M-1:0;o[0]=u-t[0],o[1]=n}else{const u=t[1]<0?M-1:0;o[0]=n,o[1]=u-t[1]}const s=M*.5,h=e*.5,i=[(o[0]-s+h)/e,(o[1]-s+h)/e],f=H(i),B=k(i),c=[];c.push([B[0],B[1],f]);for(let u=0;u<M;u++){const x=D(u,n,t),z=H(x),C=k(x),a=[C[0],C[1],z],y=c[c.length-1];let r=[y[0]-a[0],y[1]-a[1],y[2]-a[2]],m=r[2]*r[2]/(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);for(m=r[2]>0?m:-m;c.length>1;){const d=c[c.length-2];r=[d[0]-a[0],d[1]-a[1],d[2]-a[2]];let l=r[2]*r[2]/(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);if(l=r[2]>0?l:-l,m>l)break;m=l,c.pop()}if(O(x)){const d=j(x),l=Z(d),T=c[c.length-1];r=[T[0]-a[0],T[1]-a[1],T[2]-a[2]];const b=[r[0],r[1],r[2]/E],G=Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]),I=X*Math.exp(-b[2]/G);A[l]+=I}c.push(a)}}return A}export{Q as computeLSAOCPU};
