const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/terrain-viewer-B6SY1xG2.js","assets/tile-math-BziQlsn7.js","assets/elevation-profile-BF3MYNlB.js"])))=>i.map(i=>d[i]);
import{d as xe,_ as B}from"./index-ByB2dbry.js";xe({root:document.getElementById("cell-1"),expanded:[],variables:[]},{id:1,body:async(l,t)=>{const{TILE_URL_TERRAIN:V,TILE_URL_SENTINEL:S,TILE_URL_TAHOE:N,TILE_URL_TAHOE_SENTINEL:W}=await B(()=>import("./tile-urls-DWqr2Nyz.js"),[]).then(P=>{if(!("TILE_URL_TERRAIN"in P))throw new SyntaxError("export 'TILE_URL_TERRAIN' not found");if(!("TILE_URL_SENTINEL"in P))throw new SyntaxError("export 'TILE_URL_SENTINEL' not found");if(!("TILE_URL_TAHOE"in P))throw new SyntaxError("export 'TILE_URL_TAHOE' not found");if(!("TILE_URL_TAHOE_SENTINEL"in P))throw new SyntaxError("export 'TILE_URL_TAHOE_SENTINEL' not found");return P}),H={Denali:{sources:{"arctic-dem":{type:"terrain",tiles:[V],minzoom:4,maxzoom:13,bounds:[-152.9,62.2,-148.8,64],attribution:'<a href="https://www.pgc.umn.edu/data/arcticdem/" target="_blank" rel="noopener">ArcticDEM</a> | <a href="https://catalog.data.gov/dataset/srtm30-global-1-km-digital-elevation-model-dem-version-11-land-surface" target="_blank" rel="noopener">SRTM30</a>'},sentinel:{type:"raster",tiles:[S],minzoom:4,maxzoom:11,bounds:[-152.9,62.2,-148.8,64],attribution:'<a href="https://dataspace.copernicus.eu/" target="_blank" rel="noopener">Copernicus Sentinel-2</a>'},peaks:{type:"geojson",data:"osm/peaks.geojson",attribution:'<a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener">OpenStreetMap</a>'},fkt:{type:"geojson",data:"strava/fkt.geojson",simplify:1e-4,attribution:'<a href="https://www.strava.com/activities/9223277277" target="_blank" rel="noopener">Strava</a>'}},camera:{center:[.08005793958567985,.00021365516506647512,.27291423467021114],distance:.0004971889617079275,phi:2.4972122538258654,theta:.13580281526641474},base:[{id:"satellite",source:"sentinel",blend:"source-over"}],features:[{id:"ski-tracks",type:"line",source:"fkt",paint:{"line-color":"#ff8800","line-width":5,"line-border-color":"#331100","line-border-width":2,"atmosphere-opacity":.5}},{id:"peak-circles",type:"circle",source:"peaks",paint:{"circle-radius":3,"circle-color":"#000000","circle-stroke-color":"#ffffff","circle-stroke-width":1.5,"atmosphere-opacity":.5}},{id:"peak-labels",type:"text",source:"peaks",paint:{"text-field":"name","text-size":16,"text-color":"#000000","text-halo-color":"#ffffff","text-halo-width":1.25,"atmosphere-opacity":.5}}]},"Lake Tahoe":{sources:{"tahoe-terrain":{type:"terrain",tiles:[N],minzoom:0,maxzoom:13,bounds:[-120.87,38.8,-119.68,39.85],attribution:'<a href="https://spacedata.copernicus.eu/collections/copernicus-digital-elevation-model" target="_blank" rel="noopener">Copernicus DEM</a>'},"tahoe-sentinel":{type:"raster",tiles:[W],minzoom:8,maxzoom:12,bounds:[-120.87,38.8,-119.68,39.85],attribution:'<a href="https://dataspace.copernicus.eu/" target="_blank" rel="noopener">Copernicus Sentinel-2</a>'},"tahoe-landmarks":{type:"geojson",data:"osm/tahoe-landmarks.geojson",attribution:'<a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener">OpenStreetMap</a>'}},camera:{center:[.1659,0,.38101],distance:6e-4,phi:Math.PI/2,theta:.4},base:[{id:"satellite",source:"tahoe-sentinel",blend:"source-over"}],features:[{id:"landmark-circles",type:"circle",source:"tahoe-landmarks",paint:{"circle-radius":3,"circle-color":"#000000","circle-stroke-color":"#ffffff","circle-stroke-width":1.5,"atmosphere-opacity":.5}},{id:"landmark-labels",type:"text",source:"tahoe-landmarks",paint:{"text-field":"name","text-size":16,"text-color":"#000000","text-halo-color":"#ffffff","text-halo-width":1.25,"atmosphere-opacity":.5}}]}},h=l(t.select(Object.keys(H),{label:"Dataset"}));return{TILE_URL_TERRAIN:V,TILE_URL_SENTINEL:S,TILE_URL_TAHOE:N,TILE_URL_TAHOE_SENTINEL:W,datasets:H,datasetName:h}},inputs:["view","Inputs"],outputs:["TILE_URL_TERRAIN","TILE_URL_SENTINEL","TILE_URL_TAHOE","TILE_URL_TAHOE_SENTINEL","datasets","datasetName"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});xe({root:document.getElementById("cell-2"),expanded:[],variables:[]},{id:2,body:async(l,t,V,S,N,W)=>{const[{TerrainMap:H},{createGPULines:h},{default:P},{expandable:ae},{ElevationProfile:J},{gpx:U}]=await Promise.all([B(()=>import("./terrain-viewer-B6SY1xG2.js"),__vite__mapDeps([0,1])).then(i=>{if(!("TerrainMap"in i))throw new SyntaxError("export 'TerrainMap' not found");return i}),B(()=>import("https://cdn.jsdelivr.net/npm/webgpu-instanced-lines/+esm"),[]).then(i=>{if(!("createGPULines"in i))throw new SyntaxError("export 'createGPULines' not found");return i}),B(()=>import("https://cdn.jsdelivr.net/npm/simplify-js/+esm"),[]).then(i=>{if(!("default"in i))throw new SyntaxError("export 'default' not found");return i}),B(()=>import("./expandable-BCrxs32f.js"),[]).then(i=>{if(!("expandable"in i))throw new SyntaxError("export 'expandable' not found");return i}),B(()=>import("./elevation-profile-BF3MYNlB.js"),__vite__mapDeps([2,1])).then(i=>{if(!("ElevationProfile"in i))throw new SyntaxError("export 'ElevationProfile' not found");return i}),B(()=>import("https://cdn.jsdelivr.net/npm/@tmcw/togeojson/+esm"),[]).then(i=>{if(!("gpx"in i))throw new SyntaxError("export 'gpx' not found");return i})]),E=l[t];window._lastDataset&&window._lastDataset!==t&&V.replaceState(null,"",window.location.pathname),window._lastDataset=t;const x=document.createElement("canvas");x.className="terrain";const v=await H.create(x,{...E,font:{atlas:"./mapviewer/fonts/roboto-regular.png",metadata:"./mapviewer/fonts/roboto-regular.json"},createGPULines:h,simplifyFn:P}),I=S`<div class="slope-legend" style="display: none">
  <div class="slope-legend-title">Slope angle</div>
  <div class="slope-legend-blocks">
    <div style="background: rgb(255, 199, 0)"></div>
    <div style="background: rgb(255, 140, 0)"></div>
    <div style="background: rgb(255, 77, 0)"></div>
    <div style="background: rgb(191, 0, 0)"></div>
    <div style="background: rgb(102, 0, 153)"></div>
    <div style="background: rgb(0, 51, 204)"></div>
    <div style="background: rgb(0, 0, 0)"></div>
  </div>
  <div class="slope-legend-labels">
    <span>26-29°</span>
    <span>30-31°</span>
    <span>32-34°</span>
    <span>35-45°</span>
    <span>46-50°</span>
    <span>51-59°</span>
    <span>60°+</span>
  </div>
</div>`;v._slopeLegend=I;const p=S`<div class="elevation-label"></div>`;x.addEventListener("mousemove",i=>{const w=v.raycast(i.clientX,i.clientY);if(w){const _=v.queryElevationMercator(w.worldPos[0],w.worldPos[2]);if(_!=null){const a=Math.round(_*3.28084);p.textContent=`${a.toLocaleString()} ft`,p.style.opacity="1"}else p.style.opacity="0"}else p.style.opacity="0"}),x.addEventListener("mouseleave",()=>{p.style.opacity="0"});const A=new J,Y=A.createDOM();v.onElevationRefine=()=>{const i=A.activeLayerId;if(!i)return;if(!v._lineLayers.find(_=>_.id===i)){A.hide();return}const w=v.getLayerElevationProfile(i);w&&A.update(w)};const D=S`<div style="position: relative">`;D.appendChild(x),D.appendChild(p),D.appendChild(I),D.appendChild(v.attribution),D.appendChild(Y);const $=S`<div class="drop-overlay" style="display:none">Drop GeoJSON or GPX file</div>`;D.appendChild($);const O=S`<button class="compass-rose" title="Orient north">
  <svg viewBox="0 0 28 28" width="24" height="24" style="display:block">
    <path d="M14 4L17.5 14L14 12L10.5 14Z" fill="#D32F2F"/>
    <path d="M14 24L10.5 14L14 16L17.5 14Z" fill="#9E9E9E"/>
  </svg>
</button>`;D.appendChild(O);const z=O.querySelector("svg");function K(){if(!O.isConnected)return;const i=90-v.camera.state.phi*180/Math.PI;z.style.transform=`rotate(${i}deg)`,requestAnimationFrame(K)}return requestAnimationFrame(K),O.addEventListener("click",()=>{const i=Math.PI/2,w=v.camera.state.phi;let _=i-w;_-=Math.round(_/(2*Math.PI))*2*Math.PI;const a=performance.now();function j(oe){const F=Math.min(1,(oe-a)/300),ee=F*F*(3-2*F);v.camera.state.phi=w+_*ee,v.camera.taint(),F<1&&requestAnimationFrame(j)}requestAnimationFrame(j)}),N(ae(D,{wide:!0,width:640,height:600,toggleOffset:[-12,-12],controls:".terrain-controls",onResize(i,w,_,a){a?(x.style.width=`${w}px`,x.style.height=`${_}px`):(x.style.width="",x.style.height=""),v.camera.taint()}})),W.then(()=>{A.destroy(),v.destroy()}),{TerrainMap:H,createGPULines:h,simplify:P,expandable:ae,ElevationProfile:J,gpxToGeoJSON:U,config:E,canvas:x,viewer:v,slopeLegend:I,elevationLabel:p,elevationProfile:A,profilePanel:Y,container:D,dropOverlay:$,compassBtn:O,compassSvg:z,updateCompass:K}},inputs:["datasets","datasetName","history","html","display","invalidation"],outputs:["TerrainMap","createGPULines","simplify","expandable","ElevationProfile","gpxToGeoJSON","config","canvas","viewer","slopeLegend","elevationLabel","elevationProfile","profilePanel","container","dropOverlay","compassBtn","compassSvg","updateCompass"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});xe({root:document.getElementById("cell-3"),expanded:[],variables:[]},{id:3,body:async(l,t,V,S,N,W,H,h,P,ae)=>{const{default:J}=await B(()=>import("https://cdn.jsdelivr.net/npm/suncalc/+esm"),[]).then(e=>{if(!("default"in e))throw new SyntaxError("export 'default' not found");return e}),U=l`<div class="terrain-controls"></div>`,E={date:new Date,timeOfDay:14,utcOffset:-8},x=t._location;function v(e){const o=Math.floor(e)%24,s=Math.round(e%1*60);return`${String(o).padStart(2,"0")}:${String(s).padStart(2,"0")}`}function I(){const e=E.timeOfDay,o=E.date,s=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate(),Math.floor(e)-E.utcOffset,e%1*60,0)),n=J.getPosition(s,x.lat,x.lon),r=n.altitude,d=n.azimuth;t.settings.sunDirection=[-Math.cos(r)*Math.sin(d),Math.sin(r),Math.cos(r)*Math.cos(d)]}I();function p(e,o,s){e.appendChild(o),o.addEventListener("input",()=>s(o.value))}function A(e,{open:o=!1,trailing:s=null}={}){const n=l`<div class="ctrl-section"></div>`,r=l`<div class="ctrl-section-header"></div>`,d=l`<span class="ctrl-chevron">&#9654;</span>`;r.appendChild(d),r.appendChild(l`<span class="ctrl-section-title">${e}</span>`),s&&r.appendChild(s),n.appendChild(r);const m=l`<div class="ctrl-section-body"></div>`;return o?n.classList.add("open"):m.style.display="none",n.appendChild(m),r.addEventListener("click",g=>{if(g.target.closest("button"))return;const y=n.classList.toggle("open");m.style.display=y?"":"none"}),{section:n,body:m}}const Y=l`<button class="draw-path-btn" title="Draw a path on the terrain">Draw path</button>`,{section:D,body:$}=A("Layers",{open:!0,trailing:Y});U.appendChild(D);const O='<svg viewBox="0 0 20 20" width="16" height="16" style="display:block"><path d="M10 4C4.5 4 1 10 1 10s3.5 6 9 6 9-6 9-6-3.5-6-9-6z" fill="none" stroke="currentColor" stroke-width="1.5"/><circle cx="10" cy="10" r="3" fill="none" stroke="currentColor" stroke-width="1.5"/></svg>',z='<svg viewBox="0 0 20 20" width="16" height="16" style="display:block"><path d="M10 4C4.5 4 1 10 1 10s3.5 6 9 6 9-6 9-6-3.5-6-9-6z" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.35"/><circle cx="10" cy="10" r="3" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.35"/><line x1="4" y1="16" x2="16" y2="4" stroke="currentColor" stroke-width="1.5"/></svg>';function K(e){return e?"#"+[e[0],e[1],e[2]].map(o=>Math.round(o*255).toString(16).padStart(2,"0")).join(""):"#ff8800"}function i(e,o,s,n){const r=l`<div class="layer-prop"><label>${o}</label><input type="color" class="layer-color" value="${K(s)}"></div>`;r.querySelector("input").addEventListener("input",d=>n(d.target.value)),e.appendChild(r)}function w(e,o,s,n,r,d,m){const g=l`<div class="layer-prop"><label>${o}</label><input type="range" min="${n}" max="${r}" step="${d}" value="${s}"><span class="layer-prop-value">${s}</span></div>`,y=g.querySelector("input"),b=g.querySelector(".layer-prop-value");y.addEventListener("input",()=>{b.textContent=y.value,m(Number(y.value))}),e.appendChild(g)}function _(){$.innerHTML="";const e=l`<div class="layer-row">
    <button class="layer-eye" title="Toggle visibility"></button>
    <span class="layer-name">Imagery</span>
  </div>`,o=e.querySelector(".layer-eye");o.innerHTML=t.settings.showImagery?O:z,o.addEventListener("click",function(){t.settings.showImagery=!t.settings.showImagery,this.innerHTML=t.settings.showImagery?O:z}),$.appendChild(e);const s=[...t._lineLayers.map(n=>({...n,kind:"line"})),...t._circleLayers.map(n=>({...n,kind:"circle"})),...t._textLayers.map(n=>({...n,kind:"text"}))];for(const n of s){const r=l`<div class="layer-item"></div>`,d=l`<div class="layer-row"></div>`,m=l`<button class="layer-eye" title="Toggle visibility"></button>`;m.innerHTML=n.visible?O:z,m.addEventListener("click",()=>{n.visible=!n.visible,t.setLayerVisibility(n.id,n.visible),m.innerHTML=n.visible?O:z}),d.appendChild(m);const g=l`<span class="layer-chevron">&#9654;</span>`;d.appendChild(g),d.appendChild(l`<span class="layer-name">${n.id}</span>`);const y=l`<button class="layer-delete" title="Remove layer">&times;</button>`;y.addEventListener("click",()=>{t.removeLayer(n.id),_()}),d.appendChild(y),r.appendChild(d);const b=l`<div class="layer-props" style="display:none"></div>`,L=n.id;if(n.kind==="line"){i(b,"Color",n.layer._lineColor,C=>t.setLayerPaint(L,"line-color",C)),i(b,"Border",n.layer._borderColor,C=>t.setLayerPaint(L,"line-border-color",C)),w(b,"Width",n.layer._lineWidth,1,12,.5,C=>t.setLayerPaint(L,"line-width",C)),w(b,"Border width",n.layer._borderWidth,0,6,.5,C=>t.setLayerPaint(L,"line-border-width",C));const f=l`<button class="layer-download-btn">Download GeoJSON</button>`;f.addEventListener("click",()=>{const C=t.getLayerGeoJSON(L);if(!C)return;const be=new Blob([JSON.stringify(C,null,2)],{type:"application/json"}),c=URL.createObjectURL(be),k=document.createElement("a");k.href=c,k.download=`${L}.geojson`,k.click(),URL.revokeObjectURL(c)}),b.appendChild(f);const ce=l`<button class="layer-download-btn">Elevation profile</button>`;ce.addEventListener("click",()=>{const C=t.getLayerElevationProfile(L);C&&V.show(L,n.id,C,n.layer._lineColor)}),b.appendChild(ce)}else n.kind==="circle"?(i(b,"Fill",n.layer._fillColor,f=>t.setLayerPaint(L,"circle-color",f)),i(b,"Stroke",n.layer._strokeColor,f=>t.setLayerPaint(L,"circle-stroke-color",f)),w(b,"Radius",n.layer._radius,1,12,.5,f=>t.setLayerPaint(L,"circle-radius",f)),w(b,"Stroke width",n.layer._strokeWidth,0,6,.5,f=>t.setLayerPaint(L,"circle-stroke-width",f))):n.kind==="text"&&(i(b,"Color",n.layer._color,f=>t.setLayerPaint(L,"text-color",f)),i(b,"Halo",n.layer._strokeColor,f=>t.setLayerPaint(L,"text-halo-color",f)),w(b,"Halo width",n.layer._strokeWidth,0,4,.25,f=>t.setLayerPaint(L,"text-halo-width",f)));r.appendChild(b),g.addEventListener("click",()=>{const f=r.classList.toggle("open");b.style.display=f?"":"none"}),d.querySelector(".layer-name").addEventListener("click",()=>{const f=r.classList.toggle("open");b.style.display=f?"":"none"}),d.querySelector(".layer-name").style.cursor="pointer",$.appendChild(r)}}_(),Y.addEventListener("click",()=>oe());const a={active:!1,points:[],previewEntry:null,nextLayerId:1,drawItem:null,pointCount:null},j=l`<div class="draw-overlay" style="display:none">Click to add points. Double-click or Enter to finish. Esc to cancel. ⌘Z to undo.</div>`;t.canvas.parentElement.appendChild(j);function oe(){const e=`drawn-path-${a.nextLayerId}`;a.active=!0,a.points=[],a.previewEntry=null,t.canvas.classList.add("drawing"),j.style.display="";const o=l`<div class="layer-item draw-active"></div>`,s=l`<div class="layer-row"></div>`;s.appendChild(l`<span class="layer-name" style="flex:1">${e}</span>`),a.pointCount=l`<span class="draw-point-count">0 pts</span>`,s.appendChild(a.pointCount);const n=l`<button class="draw-action-btn" title="Undo last point"></button>`;n.innerHTML='<svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 7h7a3 3 0 0 1 0 6H8"/><path d="M6 10L3 7l3-3"/></svg>',n.addEventListener("click",async()=>{a.points.length>0&&(a.points.pop(),F(),await se())}),s.appendChild(n);const r=l`<button class="draw-action-btn draw-done-btn" title="Finish path"></button>`;r.innerHTML='<svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 8.5l3.5 3.5 6.5-8"/></svg>',r.addEventListener("click",()=>ie()),s.appendChild(r);const d=l`<button class="draw-action-btn" title="Cancel"></button>`;d.innerHTML='<svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4l8 8M12 4l-8 8"/></svg>',d.addEventListener("click",()=>ue()),s.appendChild(d),o.appendChild(s),a.drawItem=o,$.appendChild(o)}function F(){a.pointCount&&(a.pointCount.textContent=`${a.points.length} pts`)}function ee(){a.active=!1,a.points=[],t.canvas.classList.remove("drawing"),j.style.display="none",a.drawItem&&(a.drawItem.remove(),a.drawItem=null,a.pointCount=null)}async function se(){if(a.previewEntry&&(t.removeLineLayer(a.previewEntry.id),a.previewEntry=null),a.points.length>=2){const e={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:a.points.map(o=>[o.lon,o.lat,o.elev])},properties:{}}]};a.previewEntry=await t.addLineLayer("__draw_preview",e,{"line-color":"#2196F3","line-width":4,"line-border-color":"#0D47A1","line-border-width":1.5,"atmosphere-opacity":.5})}}async function ie(){if(a.previewEntry&&(t.removeLineLayer("__draw_preview"),a.previewEntry=null),a.points.length>=2){const e=`drawn-path-${a.nextLayerId++}`,o={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:a.points.map(s=>[s.lon,s.lat,s.elev])},properties:{}}]};await t.addLineLayer(e,o,{"line-color":"#2196F3","line-width":4,"line-border-color":"#0D47A1","line-border-width":1.5,"atmosphere-opacity":.5}),_()}ee()}function ue(){a.previewEntry&&(t.removeLineLayer("__draw_preview"),a.previewEntry=null),ee()}let X=null;t.canvas.addEventListener("pointerdown",e=>{a.active&&(X={x:e.clientX,y:e.clientY})}),t.canvas.addEventListener("pointerup",async e=>{if(!a.active||!X)return;const o=e.clientX-X.x,s=e.clientY-X.y;if(X=null,Math.sqrt(o*o+s*s)>5)return;const n=t.raycast(e.clientX,e.clientY);if(!n)return;const r=n.worldPos[0],d=n.worldPos[2],m=(r-.5)*360,g=(2*Math.atan(Math.exp(Math.PI*(1-2*d)))-Math.PI/2)*180/Math.PI,y=t.queryElevationMercator(r,d)||0;a.points.push({lon:m,lat:g,elev:y,mx:r,mz:d}),F(),await se()}),t.canvas.addEventListener("dblclick",async e=>{a.active&&(e.preventDefault(),a.points.length>1&&a.points.pop(),await ie())}),document.addEventListener("keydown",async e=>{a.active&&(e.key==="Escape"?ue():e.key==="Enter"?await ie():e.key==="z"&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),a.points.length>0&&(a.points.pop(),await se())))});let Z=0;S.addEventListener("dragover",e=>{e.preventDefault()}),S.addEventListener("dragenter",e=>{e.preventDefault(),Z++,N.style.display=""}),S.addEventListener("dragleave",e=>{Z--,Z<=0&&(Z=0,N.style.display="none")}),S.addEventListener("drop",async e=>{e.preventDefault(),Z=0,N.style.display="none";const o=e.dataTransfer.files[0];if(!o)return;const s=await o.text(),n=o.name,r=n.split(".").pop().toLowerCase();let d;if(r==="gpx"){const g=new W().parseFromString(s,"text/xml");d=H(g)}else if(r==="geojson"||r==="json")d=JSON.parse(s);else return;const m=n.replace(/\.[^.]+$/,"").replace(/[^a-zA-Z0-9_-]/g,"-");await t.addLineLayer(m,d,{"line-color":"#4CAF50","line-width":4,"line-border-color":"#1B5E20","line-border-width":1.5,"atmosphere-opacity":.5}),_()});const{section:Ce,body:R}=A("Analysis",{open:!0});U.appendChild(Ce),p(R,h.range([0,2],{value:t.settings.verticalExaggeration,step:.01,label:"Vertical exaggeration"}),e=>{t.settings.verticalExaggeration=e}),p(R,h.range([0,1],{value:t.settings.hillshadeOpacity,step:.01,label:"Hillshade opacity"}),e=>{t.settings.hillshadeOpacity=e}),p(R,h.range([0,1],{value:t.settings.contourOpacity,step:.01,label:"Contour opacity"}),e=>{t.settings.contourOpacity=e}),p(R,h.range([0,1],{value:t.settings.slopeAngleOpacity,step:.01,label:"Slope angle opacity"}),e=>{t.settings.slopeAngleOpacity=e,t._slopeLegend.style.display=e>0?"":"none"}),p(R,h.range([0,1],{value:t.settings.slopeAspectOpacity,step:.01,label:"Slope aspect opacity"}),e=>{t.settings.slopeAspectOpacity=e});{const e="http://www.w3.org/2000/svg",r=["N","NE","E","SE","S","SW","W","NW"],d=[{key:"slopeAspectMaskAbove",label:"Above",rInner:0,rOuter:18},{key:"slopeAspectMaskNear",label:"Near",rInner:18,rOuter:36},{key:"slopeAspectMaskBelow",label:"Below",rInner:36,rOuter:54}],m=68,g={slopeAspectMaskAbove:0,slopeAspectMaskNear:0,slopeAspectMaskBelow:0},y=document.createElementNS(e,"svg");y.setAttribute("viewBox","0 0 180 180"),y.setAttribute("width",180),y.setAttribute("height",180),y.style.display="block",y.style.margin="0 auto";for(const c of d)for(let k=0;k<8;k++){const u=(k*45-22.5-90)*Math.PI/180,T=(k*45+22.5-90)*Math.PI/180,M=document.createElementNS(e,"path");let ve;if(c.rInner===0){const me=90+c.rOuter*Math.cos(u),Le=80+c.rOuter*Math.sin(u),Ee=90+c.rOuter*Math.cos(T),we=80+c.rOuter*Math.sin(T);ve=`M90,80L${me.toFixed(1)},${Le.toFixed(1)}L${Ee.toFixed(1)},${we.toFixed(1)}Z`}else{const me=90+c.rInner*Math.cos(u),Le=80+c.rInner*Math.sin(u),Ee=90+c.rOuter*Math.cos(u),we=80+c.rOuter*Math.sin(u),Me=90+c.rInner*Math.cos(T),Ae=80+c.rInner*Math.sin(T),De=90+c.rOuter*Math.cos(T),Oe=80+c.rOuter*Math.sin(T);ve=`M${me.toFixed(1)},${Le.toFixed(1)}L${Ee.toFixed(1)},${we.toFixed(1)}L${De.toFixed(1)},${Oe.toFixed(1)}L${Me.toFixed(1)},${Ae.toFixed(1)}Z`}M.setAttribute("d",ve),M.setAttribute("fill","#fff"),M.setAttribute("stroke","#333"),M.setAttribute("stroke-width","0.5"),M.style.cursor="pointer",M.style.transition="fill 0.1s";const Q=c.key,pe=k;M.addEventListener("click",()=>{g[Q]^=1<<pe,M.setAttribute("fill",g[Q]&1<<pe?"#59D91A":"#fff"),t.settings[Q]=g[Q]}),M.addEventListener("mouseenter",()=>{g[Q]&1<<pe||M.setAttribute("fill","#eee")}),M.addEventListener("mouseleave",()=>{g[Q]&1<<pe||M.setAttribute("fill","#fff")}),y.appendChild(M)}for(let c=0;c<8;c++){const k=(c*45-90)*Math.PI/180,u=document.createElementNS(e,"text");u.setAttribute("x",(90+m*Math.cos(k)).toFixed(1)),u.setAttribute("y",(80+m*Math.sin(k)).toFixed(1)),u.setAttribute("text-anchor","middle"),u.setAttribute("dominant-baseline","central"),u.setAttribute("font-size","10"),u.setAttribute("font-family","system-ui, sans-serif"),u.setAttribute("fill","#333"),u.setAttribute("pointer-events","none"),u.textContent=r[c],y.appendChild(u)}const b=168,L=d.map(c=>c.label),f=60,ce=90-(L.length-1)*f/2;for(let c=0;c<L.length;c++){const k=ce+c*f,u=document.createElementNS(e,"rect");u.setAttribute("x",k-16),u.setAttribute("y",b-4),u.setAttribute("width",8),u.setAttribute("height",8),u.setAttribute("fill","#fff"),u.setAttribute("stroke","#333"),u.setAttribute("stroke-width","0.5"),y.appendChild(u);const T=document.createElementNS(e,"text");T.setAttribute("x",k-4),T.setAttribute("y",b),T.setAttribute("dominant-baseline","central"),T.setAttribute("font-size","9"),T.setAttribute("font-family","system-ui, sans-serif"),T.setAttribute("fill","#555"),T.textContent=L[c],y.appendChild(T)}const C=l`<div class="aspect-rose"></div>`,be=l`<label style="font-size: 12px; font-weight: 500; font-family: system-ui, sans-serif; color: #555;">Slope aspect</label>`;C.appendChild(be),C.appendChild(y),R.appendChild(C)}p(R,h.range([0,13e3],{value:t.settings.treelineLower,step:50,label:"Lower treeline (ft)"}),e=>{t.settings.treelineLower=e}),p(R,h.range([0,13e3],{value:t.settings.treelineUpper,step:50,label:"Upper treeline (ft)"}),e=>{t.settings.treelineUpper=e});const{section:_e,body:q}=A("Environment");U.appendChild(_e),p(q,h.date({value:E.date,label:"Date"}),e=>{e&&(E.date=e,I())});const te=h.range([0,24],{value:E.timeOfDay,step:1/60,label:"Time of day"}),ne=te.querySelector("output");ne&&(ne.textContent=v(E.timeOfDay)),p(q,te,e=>{E.timeOfDay=e,ne&&(ne.textContent=v(e)),I()});const re=[{label:"AKST (UTC−9)",offset:-9},{label:"AKDT (UTC−8)",offset:-8},{label:"PST (UTC−8)",offset:-8},{label:"PDT (UTC−7)",offset:-7},{label:"MST (UTC−7)",offset:-7},{label:"MDT (UTC−6)",offset:-6},{label:"CST (UTC−6)",offset:-6},{label:"CDT (UTC−5)",offset:-5},{label:"EST (UTC−5)",offset:-5},{label:"EDT (UTC−4)",offset:-4}],ye=x.lat>55?"AKDT (UTC−8)":"PDT (UTC−7)",fe=h.select(re.map(e=>e.label),{value:ye,label:"Time zone"});p(q,fe,e=>{const o=re.find(s=>s.label===e);o&&(E.utcOffset=o.offset),I()});const he=re.find(e=>e.label===ye);he&&(E.utcOffset=he.offset),I();const le=l`<div class="sun-times"></div>`;q.appendChild(le);function ke(e){return e.getTime()/36e5+E.utcOffset}function de(){const e=E.date,o=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0)),s=J.getTimes(o,x.lat,x.lon),n=[["Sunrise",s.sunrise],["AM golden",s.goldenHourEnd],["Noon",s.solarNoon],["PM golden",s.goldenHour],["Sunset",s.sunset]];le.innerHTML="";for(const[r,d]of n){const g=(ke(d)%24+24)%24,y=l`<button class="sun-time-btn"><span class="sun-time-label">${r}</span><span class="sun-time-value">${v(g)}</span></button>`;y.addEventListener("click",()=>{E.timeOfDay=g,te.value=g,te.dispatchEvent(new P("input",{bubbles:!0}))}),le.appendChild(y)}}de();const Se=E._onDateChange,ge=q.querySelector('input[type="date"]');ge&&ge.addEventListener("input",()=>setTimeout(de,0)),fe.addEventListener("input",()=>setTimeout(de,0)),p(q,h.range([.05,1],{value:t.settings.atmosphereDensity,step:.01,label:"Atmosphere density"}),e=>{t.settings.atmosphereDensity=e});const{section:Te,body:G}=A("Debug");return U.appendChild(Te),p(G,h.range([10,90],{value:Math.round(t.camera.state.fov*180/Math.PI),step:1,label:"FOV (degrees)"}),e=>{t.camera.state.fov=e*Math.PI/180,t.camera.taint()}),p(G,h.range([1,5],{value:t.settings.densityThreshold,step:.1,label:"Tile scale",transform:Math.log}),e=>{t.settings.densityThreshold=e}),p(G,h.toggle({label:"Show tile borders"}),e=>{t.settings.showTileBorders=e}),p(G,h.toggle({label:"Show wireframe"}),e=>{t.settings.showWireframe=e}),p(G,h.toggle({label:"Freeze coverage"}),e=>{t.settings.freezeCoverage=e}),p(G,h.toggle({label:"Show collision boxes"}),e=>{t.settings.showCollisionBoxes=e}),ae(U),{SunCalc:J,controlsContainer:U,sunState:E,location:x,formatTime:v,updateSunDirection:I,addControl:p,createSection:A,drawBtn:Y,layerPanel:D,layerList:$,eyeOpenSVG:O,eyeClosedSVG:z,hexFromColor:K,addColorProp:i,addRangeProp:w,rebuildLayerPanel:_,drawState:a,drawOverlay:j,enterDrawMode:oe,updateDrawItemCount:F,exitDrawMode:ee,updatePreview:se,finishDrawing:ie,cancelDrawing:ue,pointerDownPos:X,dragCounter:Z,analysis:Ce,analysisContent:R,environment:_e,envContent:q,timeInput:te,timeOutput:ne,tzOptions:re,defaultTz:ye,tzSelect:fe,defaultTzEntry:he,sunTimesEl:le,utcToLocal:ke,updateSunTimes:de,origDateHandler:Se,dateInput:ge,debug:Te,debugContent:G}},inputs:["html","viewer","elevationProfile","container","dropOverlay","DOMParser","gpxToGeoJSON","Inputs","Event","display"],outputs:["SunCalc","controlsContainer","sunState","location","formatTime","updateSunDirection","addControl","createSection","drawBtn","layerPanel","layerList","eyeOpenSVG","eyeClosedSVG","hexFromColor","addColorProp","addRangeProp","rebuildLayerPanel","drawState","drawOverlay","enterDrawMode","updateDrawItemCount","exitDrawMode","updatePreview","finishDrawing","cancelDrawing","pointerDownPos","dragCounter","analysis","analysisContent","environment","envContent","timeInput","timeOutput","tzOptions","defaultTz","tzSelect","defaultTzEntry","sunTimesEl","utcToLocal","updateSunTimes","origDateHandler","dateInput","debug","debugContent"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});
