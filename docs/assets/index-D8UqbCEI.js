import{d as Ce,_ as H}from"./index-ByB2dbry.js";Ce({root:document.getElementById("cell-1"),expanded:[],variables:[]},{id:1,body:()=>({config:{sources:{mapterhorn:{type:"terrain",encoding:"terrarium",tiles:["https://tiles.mapterhorn.com/{z}/{x}/{y}.webp"],minzoom:0,maxzoom:14,bounds:[-180,-85.05,180,85.05],attribution:'<a href="https://mapterhorn.com/attribution" target="_blank" rel="noopener">© Mapterhorn</a>'},s2cloudless:{type:"raster",tiles:["https://tiles.maps.eox.at/wmts/1.0.0/s2cloudless-2021_3857/default/GoogleMapsCompatible/{z}/{y}/{x}.jpg"],minzoom:0,maxzoom:14,bounds:[-180,-85.05,180,85.05],attribution:'<a href="https://s2maps.eu/" target="_blank" rel="noopener">Sentinel-2 cloudless by EOX</a>'},peaks:{type:"geojson",data:"osm/peaks.geojson",attribution:'<a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener">OpenStreetMap</a>'},fkt:{type:"geojson",data:"strava/fkt.geojson",simplify:1e-4,attribution:'<a href="https://www.strava.com/activities/9223277277" target="_blank" rel="noopener">Strava</a>'}},camera:{center:[.08005793958567985,.00021365516506647512,.27291423467021114],distance:.0004971889617079275,phi:2.4972122538258654,theta:.13580281526641474},base:[{id:"s2-imagery",source:"s2cloudless",blend:"source-over"}],features:[{id:"ski-tracks",type:"line",source:"fkt",paint:{"line-color":"#ff8800","line-width":5,"line-border-color":"#331100","line-border-width":2,"atmosphere-opacity":.5}},{id:"peak-circles",type:"circle",source:"peaks",paint:{"circle-radius":3,"circle-color":"#000000","circle-stroke-color":"#ffffff","circle-stroke-width":1.5,"atmosphere-opacity":.5}},{id:"peak-labels",type:"text",source:"peaks",paint:{"text-field":"name","text-size":16,"text-color":"#000000","text-halo-color":"#ffffff","text-halo-width":1.25,"atmosphere-opacity":.5}}]}}),inputs:[],outputs:["config"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});Ce({root:document.getElementById("cell-2"),expanded:[],variables:[]},{id:2,body:async(i,t,de,R)=>{const[{TerrainMap:q},{createGPULines:Q},{default:ee},{expandable:b},{ElevationProfile:te},{gpx:ce}]=await Promise.all([H(()=>import("./terrain-viewer-DPUmBXc5.js"),[]).then(r=>{if(!("TerrainMap"in r))throw new SyntaxError("export 'TerrainMap' not found");return r}),H(()=>import("https://cdn.jsdelivr.net/npm/webgpu-instanced-lines/+esm"),[]).then(r=>{if(!("createGPULines"in r))throw new SyntaxError("export 'createGPULines' not found");return r}),H(()=>import("https://cdn.jsdelivr.net/npm/simplify-js/+esm"),[]).then(r=>{if(!("default"in r))throw new SyntaxError("export 'default' not found");return r}),H(()=>import("./expandable-BCrxs32f.js"),[]).then(r=>{if(!("expandable"in r))throw new SyntaxError("export 'expandable' not found");return r}),H(()=>import("./elevation-profile-Cgl4BqPW.js"),[]).then(r=>{if(!("ElevationProfile"in r))throw new SyntaxError("export 'ElevationProfile' not found");return r}),H(()=>import("https://cdn.jsdelivr.net/npm/@tmcw/togeojson/+esm"),[]).then(r=>{if(!("gpx"in r))throw new SyntaxError("export 'gpx' not found");return r})]),D=document.createElement("canvas");D.className="terrain";const L=await q.create(D,{...i,font:{atlas:"./mapviewer/fonts/roboto-regular.png",metadata:"./mapviewer/fonts/roboto-regular.json"},createGPULines:Q,simplifyFn:ee}),$=t`<div class="slope-legend" style="display: none">
  <div class="slope-legend-title">Slope angle</div>
  <div class="slope-legend-blocks">
    <div style="background: rgb(255, 199, 0)"></div>
    <div style="background: rgb(255, 140, 0)"></div>
    <div style="background: rgb(255, 77, 0)"></div>
    <div style="background: rgb(191, 0, 0)"></div>
    <div style="background: rgb(102, 0, 153)"></div>
    <div style="background: rgb(0, 51, 204)"></div>
    <div style="background: rgb(0, 0, 0)"></div>
  </div>
  <div class="slope-legend-labels">
    <span>26-29°</span>
    <span>30-31°</span>
    <span>32-34°</span>
    <span>35-45°</span>
    <span>46-50°</span>
    <span>51-59°</span>
    <span>60°+</span>
  </div>
</div>`,y=t`<div class="elevation-label"></div>`;D.addEventListener("mousemove",r=>{const x=L.raycast(r.clientX,r.clientY);if(x){const O=L.queryElevationMercator(x.worldPos[0],x.worldPos[2]);if(O!=null){const F=Math.round(O*3.28084);y.textContent=`${F.toLocaleString()} ft`,y.style.opacity="1"}else y.style.opacity="0"}else y.style.opacity="0"}),D.addEventListener("mouseleave",()=>{y.style.opacity="0"});const A=new te,U=A.createDOM();L.on("elevationrefine",()=>{const r=A.activeLayerId;if(!r)return;if(!L.getLayer(r)){A.hide();return}const x=L.getLayerElevationProfile(r);x&&A.update(x)});const C=t`<div style="position: relative">`;C.appendChild(D),C.appendChild(y),C.appendChild($),C.appendChild(L.attribution),C.appendChild(U);const f=t`<div class="drop-overlay" style="display:none">Drop GeoJSON or GPX file</div>`;C.appendChild(f);const P=t`<button class="compass-rose" title="Orient north">
  <svg viewBox="0 0 28 28" width="24" height="24" style="display:block">
    <path d="M14 4L17.5 14L14 12L10.5 14Z" fill="#D32F2F"/>
    <path d="M14 24L10.5 14L14 16L17.5 14Z" fill="#9E9E9E"/>
  </svg>
</button>`;C.appendChild(P);const G=P.querySelector("svg");function V(){P.isConnected&&(G.style.transform=`rotate(${L.bearing}deg)`,requestAnimationFrame(V))}return requestAnimationFrame(V),P.addEventListener("click",()=>{const r=L.bearing;let x=-r;x=((x+180)%360+360)%360-180;const O=performance.now();function F(z){const _=Math.min(1,(z-O)/300),N=_*_*(3-2*_);L.bearing=r+x*N,_<1&&requestAnimationFrame(F)}requestAnimationFrame(F)}),de(b(C,{wide:!0,width:640,height:600,toggleOffset:[-12,-12],controls:".terrain-controls",onResize(r,x,O,F){F?(D.style.width=`${x}px`,D.style.height=`${O}px`):(D.style.width="",D.style.height=""),L.triggerRedraw()}})),R.then(()=>{A.destroy(),L.destroy()}),{TerrainMap:q,createGPULines:Q,simplify:ee,expandable:b,ElevationProfile:te,gpxToGeoJSON:ce,canvas:D,viewer:L,slopeLegend:$,elevationLabel:y,elevationProfile:A,profilePanel:U,container:C,dropOverlay:f,compassBtn:P,compassSvg:G,updateCompass:V}},inputs:["config","html","display","invalidation"],outputs:["TerrainMap","createGPULines","simplify","expandable","ElevationProfile","gpxToGeoJSON","canvas","viewer","slopeLegend","elevationLabel","elevationProfile","profilePanel","container","dropOverlay","compassBtn","compassSvg","updateCompass"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});Ce({root:document.getElementById("cell-3"),expanded:[],variables:[]},{id:3,body:async(i,t,de,R,q,Q,ee,b,te,ce,D)=>{const{default:L}=await H(()=>import("https://cdn.jsdelivr.net/npm/suncalc/+esm"),[]).then(e=>{if(!("default"in e))throw new SyntaxError("export 'default' not found");return e}),$=i`<div class="terrain-controls"></div>`,y={date:new Date,timeOfDay:1,utcOffset:-8},A=t.location;function U(e){const o=Math.floor(e)%24,n=Math.round(e%1*60);return`${String(o).padStart(2,"0")}:${String(n).padStart(2,"0")}`}function C(){const e=y.timeOfDay,o=y.date,n=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate(),Math.floor(e)-y.utcOffset,e%1*60,0)),l=L.getPosition(n,A.lat,A.lon),s=l.altitude,d=l.azimuth;t.settings.sunDirection=[-Math.cos(s)*Math.sin(d),Math.sin(s),Math.cos(s)*Math.cos(d)]}C();function f(e,o,n){e.appendChild(o),o.addEventListener("input",()=>n(o.value))}function P(e,{open:o=!1,trailing:n=null}={}){const l=i`<div class="ctrl-section"></div>`,s=i`<div class="ctrl-section-header"></div>`,d=i`<span class="ctrl-chevron">&#9654;</span>`;s.appendChild(d),s.appendChild(i`<span class="ctrl-section-title">${e}</span>`),n&&s.appendChild(n),l.appendChild(s);const m=i`<div class="ctrl-section-body"></div>`;return o?l.classList.add("open"):m.style.display="none",l.appendChild(m),s.addEventListener("click",g=>{if(g.target.closest("button"))return;const u=l.classList.toggle("open");m.style.display=u?"":"none"}),{section:l,body:m}}const G=i`<button class="draw-path-btn" title="Draw a path on the terrain">Draw path</button>`,{section:V,body:r}=P("Layers",{open:!1,trailing:G});$.appendChild(V);const x='<svg viewBox="0 0 20 20" width="16" height="16" style="display:block"><path d="M10 4C4.5 4 1 10 1 10s3.5 6 9 6 9-6 9-6-3.5-6-9-6z" fill="none" stroke="currentColor" stroke-width="1.5"/><circle cx="10" cy="10" r="3" fill="none" stroke="currentColor" stroke-width="1.5"/></svg>',O='<svg viewBox="0 0 20 20" width="16" height="16" style="display:block"><path d="M10 4C4.5 4 1 10 1 10s3.5 6 9 6 9-6 9-6-3.5-6-9-6z" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.35"/><circle cx="10" cy="10" r="3" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.35"/><line x1="4" y1="16" x2="16" y2="4" stroke="currentColor" stroke-width="1.5"/></svg>';function F(e){return e?"#"+[e[0],e[1],e[2]].map(o=>Math.round(o*255).toString(16).padStart(2,"0")).join(""):"#ff8800"}function z(e,o,n,l){const s=i`<div class="layer-prop"><label>${o}</label><input type="color" class="layer-color" value="${F(n)}"></div>`;s.querySelector("input").addEventListener("input",d=>l(d.target.value)),e.appendChild(s)}function _(e,o,n,l,s,d,m){const g=i`<div class="layer-prop"><label>${o}</label><input type="range" min="${l}" max="${s}" step="${d}" value="${n}"><span class="layer-prop-value">${n}</span></div>`,u=g.querySelector("input"),v=g.querySelector(".layer-prop-value");u.addEventListener("input",()=>{v.textContent=u.value,m(Number(u.value))}),e.appendChild(g)}function N(){r.innerHTML="";const e=i`<div class="layer-row">
    <button class="layer-eye" title="Toggle visibility"></button>
    <span class="layer-name">Imagery</span>
  </div>`,o=e.querySelector(".layer-eye");o.innerHTML=t.settings.showImagery?x:O,o.addEventListener("click",function(){t.settings.showImagery=!t.settings.showImagery,this.innerHTML=t.settings.showImagery?x:O}),r.appendChild(e);for(const n of t.getLayers()){const l=i`<div class="layer-item"></div>`,s=i`<div class="layer-row"></div>`;let d=n.visible;const m=i`<button class="layer-eye" title="Toggle visibility"></button>`;m.innerHTML=d?x:O,m.addEventListener("click",()=>{d=!d,t.setLayerVisibility(n.id,d),m.innerHTML=d?x:O}),s.appendChild(m);const g=i`<span class="layer-chevron">&#9654;</span>`;s.appendChild(g),s.appendChild(i`<span class="layer-name">${n.id}</span>`);const u=i`<button class="layer-delete" title="Remove layer">&times;</button>`;u.addEventListener("click",()=>{t.removeLayer(n.id),N()}),s.appendChild(u),l.appendChild(s);const v=i`<div class="layer-props" style="display:none"></div>`,w=n.id,E=n.paint;if(n.type==="line"){z(v,"Color",E["line-color"],k=>t.setLayerPaint(w,"line-color",k)),z(v,"Border",E["line-border-color"],k=>t.setLayerPaint(w,"line-border-color",k)),_(v,"Width",E["line-width"],1,12,.5,k=>t.setLayerPaint(w,"line-width",k)),_(v,"Border width",E["line-border-width"],0,6,.5,k=>t.setLayerPaint(w,"line-border-width",k));const h=i`<button class="layer-download-btn">Download GeoJSON</button>`;h.addEventListener("click",()=>{const k=t.getLayerGeoJSON(w);if(!k)return;const p=new Blob([JSON.stringify(k,null,2)],{type:"application/json"}),M=URL.createObjectURL(p),c=document.createElement("a");c.href=M,c.download=`${w}.geojson`,c.click(),URL.revokeObjectURL(M)}),v.appendChild(h);const Y=i`<button class="layer-download-btn">Elevation profile</button>`;Y.addEventListener("click",()=>{const k=t.getLayerElevationProfile(w);k&&de.show(w,n.id,k,E["line-color"])}),v.appendChild(Y)}else n.type==="circle"?(z(v,"Fill",E["circle-color"],h=>t.setLayerPaint(w,"circle-color",h)),z(v,"Stroke",E["circle-stroke-color"],h=>t.setLayerPaint(w,"circle-stroke-color",h)),_(v,"Radius",E["circle-radius"],1,12,.5,h=>t.setLayerPaint(w,"circle-radius",h)),_(v,"Stroke width",E["circle-stroke-width"],0,6,.5,h=>t.setLayerPaint(w,"circle-stroke-width",h))):n.type==="text"&&(z(v,"Color",E["text-color"],h=>t.setLayerPaint(w,"text-color",h)),z(v,"Halo",E["text-halo-color"],h=>t.setLayerPaint(w,"text-halo-color",h)),_(v,"Halo width",E["text-halo-width"],0,4,.25,h=>t.setLayerPaint(w,"text-halo-width",h)));l.appendChild(v),g.addEventListener("click",()=>{const h=l.classList.toggle("open");v.style.display=h?"":"none"}),s.querySelector(".layer-name").addEventListener("click",()=>{const h=l.classList.toggle("open");v.style.display=h?"":"none"}),s.querySelector(".layer-name").style.cursor="pointer",r.appendChild(l)}}N(),G.addEventListener("click",()=>Ee());const a={active:!1,points:[],previewEntry:null,nextLayerId:1,drawItem:null,pointCount:null},ne=i`<div class="draw-overlay" style="display:none">Click to add points. Double-click or Enter to finish. Esc to cancel. ⌘Z to undo.</div>`;t.canvas.parentElement.appendChild(ne);function Ee(){const e=`drawn-path-${a.nextLayerId}`;a.active=!0,a.points=[],a.previewEntry=null,t.canvas.classList.add("drawing"),ne.style.display="";const o=i`<div class="layer-item draw-active"></div>`,n=i`<div class="layer-row"></div>`;n.appendChild(i`<span class="layer-name" style="flex:1">${e}</span>`),a.pointCount=i`<span class="draw-point-count">0 pts</span>`,n.appendChild(a.pointCount);const l=i`<button class="draw-action-btn" title="Undo last point"></button>`;l.innerHTML='<svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 7h7a3 3 0 0 1 0 6H8"/><path d="M6 10L3 7l3-3"/></svg>',l.addEventListener("click",async()=>{a.points.length>0&&(a.points.pop(),pe(),await oe())}),n.appendChild(l);const s=i`<button class="draw-action-btn draw-done-btn" title="Finish path"></button>`;s.innerHTML='<svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 8.5l3.5 3.5 6.5-8"/></svg>',s.addEventListener("click",()=>ae()),n.appendChild(s);const d=i`<button class="draw-action-btn" title="Cancel"></button>`;d.innerHTML='<svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4l8 8M12 4l-8 8"/></svg>',d.addEventListener("click",()=>ye()),n.appendChild(d),o.appendChild(n),a.drawItem=o,r.appendChild(o)}function pe(){a.pointCount&&(a.pointCount.textContent=`${a.points.length} pts`)}function ue(){a.active=!1,a.points=[],t.canvas.classList.remove("drawing"),ne.style.display="none",a.drawItem&&(a.drawItem.remove(),a.drawItem=null,a.pointCount=null)}async function oe(){if(a.previewEntry&&(t.removeLineLayer(a.previewEntry.id),a.previewEntry=null),a.points.length>=2){const e={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:a.points.map(o=>[o.lon,o.lat,o.elev])},properties:{}}]};a.previewEntry=await t.addLineLayer("__draw_preview",e,{"line-color":"#2196F3","line-width":4,"line-border-color":"#0D47A1","line-border-width":1.5,"atmosphere-opacity":.5})}}async function ae(){if(a.previewEntry&&(t.removeLineLayer("__draw_preview"),a.previewEntry=null),a.points.length>=2){const e=`drawn-path-${a.nextLayerId++}`,o={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:a.points.map(n=>[n.lon,n.lat,n.elev])},properties:{}}]};await t.addLineLayer(e,o,{"line-color":"#2196F3","line-width":4,"line-border-color":"#0D47A1","line-border-width":1.5,"atmosphere-opacity":.5}),N()}ue()}function ye(){a.previewEntry&&(t.removeLineLayer("__draw_preview"),a.previewEntry=null),ue()}let J=null;t.canvas.addEventListener("pointerdown",e=>{a.active&&(J={x:e.clientX,y:e.clientY})}),t.canvas.addEventListener("pointerup",async e=>{if(!a.active||!J)return;const o=e.clientX-J.x,n=e.clientY-J.y;if(J=null,Math.sqrt(o*o+n*n)>5)return;const l=t.raycast(e.clientX,e.clientY);if(!l)return;const s=l.worldPos[0],d=l.worldPos[2],m=(s-.5)*360,g=(2*Math.atan(Math.exp(Math.PI*(1-2*d)))-Math.PI/2)*180/Math.PI,u=t.queryElevationMercator(s,d)||0;a.points.push({lon:m,lat:g,elev:u,mx:s,mz:d}),pe(),await oe()}),t.canvas.addEventListener("dblclick",async e=>{a.active&&(e.preventDefault(),a.points.length>1&&a.points.pop(),await ae())}),document.addEventListener("keydown",async e=>{a.active&&(e.key==="Escape"?ye():e.key==="Enter"?await ae():e.key==="z"&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),a.points.length>0&&(a.points.pop(),await oe())))});let X=0;R.addEventListener("dragover",e=>{e.preventDefault()}),R.addEventListener("dragenter",e=>{e.preventDefault(),X++,q.style.display=""}),R.addEventListener("dragleave",e=>{X--,X<=0&&(X=0,q.style.display="none")}),R.addEventListener("drop",async e=>{e.preventDefault(),X=0,q.style.display="none";const o=e.dataTransfer.files[0];if(!o)return;const n=await o.text(),l=o.name,s=l.split(".").pop().toLowerCase();let d;if(s==="gpx"){const g=new Q().parseFromString(n,"text/xml");d=ee(g)}else if(s==="geojson"||s==="json")d=JSON.parse(n);else return;const m=l.replace(/\.[^.]+$/,"").replace(/[^a-zA-Z0-9_-]/g,"-");await t.addLineLayer(m,d,{"line-color":"#4CAF50","line-width":4,"line-border-color":"#1B5E20","line-border-width":1.5,"atmosphere-opacity":.5}),N()});const{section:ke,body:I}=P("Analysis",{open:!1});$.appendChild(ke),f(I,b.range([0,2],{value:t.settings.verticalExaggeration,step:.01,label:"Vertical exaggeration"}),e=>{t.settings.verticalExaggeration=e}),f(I,b.range([0,1],{value:t.settings.hillshadeOpacity,step:.01,label:"Hillshade opacity"}),e=>{t.settings.hillshadeOpacity=e}),f(I,b.range([0,1],{value:t.settings.contourOpacity,step:.01,label:"Contour opacity"}),e=>{t.settings.contourOpacity=e}),f(I,b.range([0,1],{value:t.settings.slopeAngleOpacity,step:.01,label:"Slope angle opacity"}),e=>{t.settings.slopeAngleOpacity=e,te.style.display=e>0?"":"none"}),f(I,b.range([0,1],{value:t.settings.slopeAspectOpacity,step:.01,label:"Slope aspect opacity"}),e=>{t.settings.slopeAspectOpacity=e});{const e="http://www.w3.org/2000/svg",s=["N","NE","E","SE","S","SW","W","NW"],d=[{key:"slopeAspectMaskAbove",label:"Above",rInner:0,rOuter:18},{key:"slopeAspectMaskNear",label:"Near",rInner:18,rOuter:36},{key:"slopeAspectMaskBelow",label:"Below",rInner:36,rOuter:54}],m=68,g={slopeAspectMaskAbove:0,slopeAspectMaskNear:0,slopeAspectMaskBelow:0},u=document.createElementNS(e,"svg");u.setAttribute("viewBox","0 0 180 180"),u.setAttribute("width",180),u.setAttribute("height",180),u.style.display="block",u.style.margin="0 auto";for(const p of d)for(let M=0;M<8;M++){const c=(M*45-22.5-90)*Math.PI/180,S=(M*45+22.5-90)*Math.PI/180,T=document.createElementNS(e,"path");let ve;if(p.rInner===0){const me=90+p.rOuter*Math.cos(c),we=80+p.rOuter*Math.sin(c),xe=90+p.rOuter*Math.cos(S),Le=80+p.rOuter*Math.sin(S);ve=`M90,80L${me.toFixed(1)},${we.toFixed(1)}L${xe.toFixed(1)},${Le.toFixed(1)}Z`}else{const me=90+p.rInner*Math.cos(c),we=80+p.rInner*Math.sin(c),xe=90+p.rOuter*Math.cos(c),Le=80+p.rOuter*Math.sin(c),Ae=90+p.rInner*Math.cos(S),Oe=80+p.rInner*Math.sin(S),Pe=90+p.rOuter*Math.cos(S),_e=80+p.rOuter*Math.sin(S);ve=`M${me.toFixed(1)},${we.toFixed(1)}L${xe.toFixed(1)},${Le.toFixed(1)}L${Pe.toFixed(1)},${_e.toFixed(1)}L${Ae.toFixed(1)},${Oe.toFixed(1)}Z`}T.setAttribute("d",ve),T.setAttribute("fill","#fff"),T.setAttribute("stroke","#333"),T.setAttribute("stroke-width","0.5"),T.style.cursor="pointer",T.style.transition="fill 0.1s";const K=p.key,le=M;T.addEventListener("click",()=>{g[K]^=1<<le,T.setAttribute("fill",g[K]&1<<le?"#59D91A":"#fff"),t.settings[K]=g[K]}),T.addEventListener("mouseenter",()=>{g[K]&1<<le||T.setAttribute("fill","#eee")}),T.addEventListener("mouseleave",()=>{g[K]&1<<le||T.setAttribute("fill","#fff")}),u.appendChild(T)}for(let p=0;p<8;p++){const M=(p*45-90)*Math.PI/180,c=document.createElementNS(e,"text");c.setAttribute("x",(90+m*Math.cos(M)).toFixed(1)),c.setAttribute("y",(80+m*Math.sin(M)).toFixed(1)),c.setAttribute("text-anchor","middle"),c.setAttribute("dominant-baseline","central"),c.setAttribute("font-size","10"),c.setAttribute("font-family","system-ui, sans-serif"),c.setAttribute("fill","#333"),c.setAttribute("pointer-events","none"),c.textContent=s[p],u.appendChild(c)}const v=168,w=d.map(p=>p.label),E=60,h=90-(w.length-1)*E/2;for(let p=0;p<w.length;p++){const M=h+p*E,c=document.createElementNS(e,"rect");c.setAttribute("x",M-16),c.setAttribute("y",v-4),c.setAttribute("width",8),c.setAttribute("height",8),c.setAttribute("fill","#fff"),c.setAttribute("stroke","#333"),c.setAttribute("stroke-width","0.5"),u.appendChild(c);const S=document.createElementNS(e,"text");S.setAttribute("x",M-4),S.setAttribute("y",v),S.setAttribute("dominant-baseline","central"),S.setAttribute("font-size","9"),S.setAttribute("font-family","system-ui, sans-serif"),S.setAttribute("fill","#555"),S.textContent=w[p],u.appendChild(S)}const Y=i`<div class="aspect-rose"></div>`,k=i`<label style="font-size: 12px; font-weight: 500; font-family: system-ui, sans-serif; color: #555;">Slope aspect</label>`;Y.appendChild(k),Y.appendChild(u),I.appendChild(Y)}f(I,b.range([0,13e3],{value:t.settings.treelineLower,step:50,label:"Lower treeline (ft)"}),e=>{t.settings.treelineLower=e}),f(I,b.range([0,13e3],{value:t.settings.treelineUpper,step:50,label:"Upper treeline (ft)"}),e=>{t.settings.treelineUpper=e});const{section:Se,body:j}=P("Environment");$.appendChild(Se),f(j,b.date({value:y.date,label:"Date"}),e=>{e&&(y.date=e,C())});const Z=b.range([0,24],{value:y.timeOfDay,step:1/60,label:"Time of day"}),W=Z.querySelector("output");W&&(W.textContent=U(y.timeOfDay)),f(j,Z,e=>{y.timeOfDay=e,W&&(W.textContent=U(e)),C()});const se=[{label:"AKST (UTC−9)",offset:-9},{label:"AKDT (UTC−8)",offset:-8},{label:"PST (UTC−8)",offset:-8},{label:"PDT (UTC−7)",offset:-7},{label:"MST (UTC−7)",offset:-7},{label:"MDT (UTC−6)",offset:-6},{label:"CST (UTC−6)",offset:-6},{label:"CDT (UTC−5)",offset:-5},{label:"EST (UTC−5)",offset:-5},{label:"EDT (UTC−4)",offset:-4}],fe="AKDT (UTC-8)",ge=b.select(se.map(e=>e.label),{value:fe,label:"Time zone"});f(j,ge,e=>{const o=se.find(n=>n.label===e);o&&(y.utcOffset=o.offset),C()});const he=se.find(e=>e.label===fe);he&&(y.utcOffset=he.offset),C();const ie=i`<div class="sun-times"></div>`;j.appendChild(ie);function Me(e){return e.getTime()/36e5+y.utcOffset}function re(){const e=y.date,o=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0)),n=L.getTimes(o,A.lat,A.lon),l=[["Sunrise",n.sunrise],["AM golden",n.goldenHourEnd],["Noon",n.solarNoon],["PM golden",n.goldenHour],["Sunset",n.sunset]];ie.innerHTML="";for(const[s,d]of l){const g=(Me(d)%24+24)%24,u=i`<button class="sun-time-btn"><span class="sun-time-label">${s}</span><span class="sun-time-value">${U(g)}</span></button>`;u.addEventListener("click",()=>{y.timeOfDay=g,Z.value=g,Z.dispatchEvent(new ce("input",{bubbles:!0}))}),ie.appendChild(u)}}re();const De=y._onDateChange,be=j.querySelector('input[type="date"]');be&&be.addEventListener("input",()=>setTimeout(re,0)),ge.addEventListener("input",()=>setTimeout(re,0)),f(j,b.range([.05,1],{value:t.settings.atmosphereDensity,step:.01,label:"Atmosphere density"}),e=>{t.settings.atmosphereDensity=e});const{section:Te,body:B}=P("Debug");return $.appendChild(Te),f(B,b.range([10,90],{value:Math.round(t.fov),step:1,label:"FOV (degrees)"}),e=>{t.fov=e}),f(B,b.range([.2,2],{value:1/t.settings.densityThreshold,step:.01,label:"Terrain detail"}),e=>{t.settings.densityThreshold=1/e}),f(B,b.range([.2,2],{value:1/t.settings.imageryDensityThreshold,step:.01,label:"Imagery detail"}),e=>{t.settings.imageryDensityThreshold=1/e}),f(B,b.toggle({label:"Show tile borders"}),e=>{t.settings.showTileBorders=e}),f(B,b.toggle({label:"Show wireframe"}),e=>{t.settings.showWireframe=e}),f(B,b.toggle({label:"Freeze coverage"}),e=>{t.settings.freezeCoverage=e}),f(B,b.toggle({label:"Show collision boxes"}),e=>{t.settings.showCollisionBoxes=e}),D($),{SunCalc:L,controlsContainer:$,sunState:y,location:A,formatTime:U,updateSunDirection:C,addControl:f,createSection:P,drawBtn:G,layerPanel:V,layerList:r,eyeOpenSVG:x,eyeClosedSVG:O,hexFromColor:F,addColorProp:z,addRangeProp:_,rebuildLayerPanel:N,drawState:a,drawOverlay:ne,enterDrawMode:Ee,updateDrawItemCount:pe,exitDrawMode:ue,updatePreview:oe,finishDrawing:ae,cancelDrawing:ye,pointerDownPos:J,dragCounter:X,analysis:ke,analysisContent:I,environment:Se,envContent:j,timeInput:Z,timeOutput:W,tzOptions:se,defaultTz:fe,tzSelect:ge,defaultTzEntry:he,sunTimesEl:ie,utcToLocal:Me,updateSunTimes:re,origDateHandler:De,dateInput:be,debug:Te,debugContent:B}},inputs:["html","viewer","elevationProfile","container","dropOverlay","DOMParser","gpxToGeoJSON","Inputs","slopeLegend","Event","display"],outputs:["SunCalc","controlsContainer","sunState","location","formatTime","updateSunDirection","addControl","createSection","drawBtn","layerPanel","layerList","eyeOpenSVG","eyeClosedSVG","hexFromColor","addColorProp","addRangeProp","rebuildLayerPanel","drawState","drawOverlay","enterDrawMode","updateDrawItemCount","exitDrawMode","updatePreview","finishDrawing","cancelDrawing","pointerDownPos","dragCounter","analysis","analysisContent","environment","envContent","timeInput","timeOutput","tzOptions","defaultTz","tzSelect","defaultTzEntry","sunTimesEl","utcToLocal","updateSunTimes","origDateHandler","dateInput","debug","debugContent"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});
