import{d as p,_ as P}from"./index-ByB2dbry.js";p({root:document.getElementById("cell-2"),expanded:[],variables:[]},{id:2,body:async(n,a)=>{const[{default:r},{default:u},{sprintf:s},{ode45:o},{threeBodyInitialConditions:i}]=await Promise.all([P(()=>import("https://cdn.jsdelivr.net/npm/ndarray/+esm"),[]).then(e=>{if(!("default"in e))throw new SyntaxError("export 'default' not found");return e}),P(()=>import("https://cdn.jsdelivr.net/npm/ndarray-fft/+esm"),[]).then(e=>{if(!("default"in e))throw new SyntaxError("export 'default' not found");return e}),P(()=>import("https://cdn.jsdelivr.net/npm/sprintf-js/+esm"),[]).then(e=>{if(!("sprintf"in e))throw new SyntaxError("export 'sprintf' not found");return e}),P(()=>import("https://api.observablehq.com/@rreusser/integration.js?v=4"),[]).then(e=>{const t={},d=n.module(e.default),l=n.module();if(!d.defines("ode45"))throw new SyntaxError("export 'ode45' not found");return l.variable(t.ode45=a()).import("ode45",d),t}),P(()=>import("https://api.observablehq.com/@rreusser/periodic-three-body-initial-conditions.js?v=4"),[]).then(e=>{const t={},d=n.module(e.default),l=n.module();if(!d.defines("threeBodyInitialConditions"))throw new SyntaxError("export 'threeBodyInitialConditions' not found");return l.variable(t.threeBodyInitialConditions=a()).import("threeBodyInitialConditions",d),t})]);return{ndarray:r,ndarrayFFT:u,sprintf:s,ode45:o,threeBodyInitialConditions:i}},inputs:["__ojs_runtime","__ojs_observer"],outputs:["ndarray","ndarrayFFT","sprintf","ode45","threeBodyInitialConditions"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-3"),expanded:[],variables:[]},{id:3,body:n=>{{const a=document.createElement("iframe"),r="<c><h><d><j>•</d><e><f><j>•</f><g><j>•<style>*{position:absolute}c,e{animation:q 5s infinite linear}e{animation-duration:1s}c{top:50vh;left:50vw}j{font-size:80px;transform:translate(-50%,-50%)}h{transform:translatex(20vw)}d{transform:translatex(-60vw)}f{transform:translatex(8vw)}g{transform:translatex(-8vw)}@keyframes q{to{transform:rotate(1turn)}}";a.srcdoc=r,a.style.width="300px",a.style.height="300px",a.style.border="1px solid #eee";const u=document.createElement("pre");u.style.width="100%",u.style.wordBreak="break-all",u.style.whiteSpace="pre-wrap",u.style.fontSize="0.85em";const s=document.createElement("code");s.textContent=r,u.appendChild(s);const o=document.createElement("figure"),i=document.createElement("div");i.style.display="flex",i.style.flexWrap="wrap",i.style.gap="1em",i.style.justifyContent="center";const e=document.createElement("div");e.style.flex="0 0 auto",e.appendChild(a);const t=document.createElement("div");t.style.flex="1 1 300px",t.appendChild(u),i.appendChild(e),i.appendChild(t),o.appendChild(i);const d=document.createElement("figcaption");d.textContent="The most concise physically accurate orbit I could code-golf, in 350 bytes.",o.appendChild(d),n(o)}},inputs:["display"],outputs:[],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-9"),expanded:[],variables:[]},{id:9,body:(n,a)=>({initialConditions:(()=>{const{group:u,sequence:s,orbit:o}=n,i=a[u]?.[s]?.[o];if(!i)return null;const e=i.x,t=i.v,d=i.m||[1,1,1];return{y0:[e[0][0],e[0][1],t[0][0],t[0][1],e[1][0],e[1][1],t[1][0],t[1][1],e[2][0],e[2][1],t[2][0],t[2][1]],period:i.T,m:d}})()}),inputs:["selectedConditions","threeBodyInitialConditions"],outputs:["initialConditions"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-10"),expanded:[],variables:[]},{id:10,body:(n,a)=>{function r(s,o,i){let e,t,d;const l=n.m[0],f=n.m[1],b=n.m[2];s[0]=o[2],s[1]=o[3],s[4]=o[6],s[5]=o[7],s[8]=o[10],s[9]=o[11],e=o[4]-o[0],t=o[5]-o[1],d=Math.pow(e*e+t*t,1.5),e/=d,t/=d,s[2]=e*f,s[3]=t*f,s[6]=-e*l,s[7]=-t*l,e=o[8]-o[0],t=o[9]-o[1],d=Math.pow(e*e+t*t,1.5),e/=d,t/=d,s[2]+=e*b,s[3]+=t*b,s[10]=-e*l,s[11]=-t*l,e=o[8]-o[4],t=o[9]-o[5],d=Math.pow(e*e+t*t,1.5),e/=d,t/=d,s[6]+=e*b,s[7]+=t*b,s[10]-=e*f,s[11]-=t*f}function u({n:s}){const o=[{x:[],y:[]},{x:[],y:[]},{x:[],y:[]}],i={t:0,y:n.y0.slice()};function e(d){o[0].x.push(d.y[0]),o[0].y.push(d.y[1]),o[1].x.push(d.y[4]),o[1].y.push(d.y[5]),o[2].x.push(d.y[8]),o[2].y.push(d.y[9])}e(i);const t={tolerance:1e-9};for(let d=0;d<s-1;d++){let l=0;for(t.t=d/s*n.period,t.tLimit=(d+1)/s*n.period,i.limitReached=!1;l++<1e3&&!i.limitReached;)a(i,r,t);e(i)}return o}return{planarThreeBodyDerivative:r,tabulateOrbit:u}},inputs:["initialConditions","ode45"],outputs:["planarThreeBodyDerivative","tabulateOrbit"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-11"),expanded:[],variables:[]},{id:11,body:(n,a)=>({trajectory:n({n:a})}),inputs:["tabulateOrbit","n"],outputs:["trajectory"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-13"),expanded:[],variables:[]},{id:13,body:(n,a,r)=>{function u(i,e){const t=n(i.slice()),d=n(e.slice());a(1,t,d);const l=f=>f/r;return[t.data.map(l),d.data.map(l)]}function s(i,e){const t=n(i.slice()),d=n(e.slice());a(-1,t,d);const l=f=>f*r;return[t.data.map(l),d.data.map(l)]}function o(i,e,t){return(i<Math.floor((e+1)/2)?i/(e*t):-(e-i)/(e*t))*Math.PI*2}return{fft:u,ifft:s,fftfreq:o}},inputs:["ndarray","ndarrayFFT","n"],outputs:["fft","ifft","fftfreq"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-33"),expanded:[],variables:[]},{id:33,body:(n,a,r)=>{const u=(()=>{const o=document.createElement("form");o.className="orbit-selector";let i="Šuvakov",e="V - Figure 8",t="V.1.A";const d=Object.keys(n).map(y=>({label:y,options:Object.keys(n[y]).map(h=>({label:h,value:`${y}: ${h}`}))})),l=document.createElement("label");l.innerHTML="<small><em>Sequence</em></small><br>";const f=document.createElement("select");f.name="sequence",d.forEach(y=>{const h=document.createElement("optgroup");h.label=y.label,y.options.forEach(E=>{const T=document.createElement("option");T.value=E.value,T.textContent=E.label,E.value===`${i}: ${e}`&&(T.selected=!0),h.appendChild(T)}),f.appendChild(h)}),l.appendChild(f);const b=document.createElement("label");b.innerHTML="<small><em>Orbit</em></small><br>";const g=document.createElement("select");g.name="orbit",b.appendChild(g);function j(){g.innerHTML="";const y=Object.keys(n[i]?.[e]||{});y.forEach(h=>{const E=document.createElement("option");E.value=h,E.textContent=h,h===t&&(E.selected=!0),g.appendChild(E)}),!y.includes(t)&&y.length>0&&(t=y[0],g.value=t)}j();const B=document.createElement("div");B.innerHTML='<strong style="font-size:0.9rem">Initial conditions</strong>',o.appendChild(B);const F=document.createElement("div");return F.style.cssText="display:flex;gap:1em;flex-wrap:wrap;",F.appendChild(l),F.appendChild(b),o.appendChild(F),f.onchange=()=>{const[y,h]=f.value.split(": ");i=y,e=h,j(),t=g.value,o.value={group:i,sequence:e,orbit:t},o.dispatchEvent(new CustomEvent("input",{bubbles:!0}))},g.onchange=()=>{t=g.value,o.value={group:i,sequence:e,orbit:t},o.dispatchEvent(new CustomEvent("input",{bubbles:!0}))},o.value={group:i,sequence:e,orbit:t},o})();a(u);const s=r.input(u);return{selectedConditionsInput:u,selectedConditions:s}},inputs:["threeBodyInitialConditions","display","Generators"],outputs:["selectedConditionsInput","selectedConditions"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-14"),expanded:[],variables:[]},{id:14,body:(n,a,r,u)=>{const s=1/n,o=Math.floor(n/2)+1,i=new Array(n).fill(0).map((d,l)=>a(l,n,1/n)),e=r.map(d=>u(d.x,d.y)),t=e.map(([d,l])=>d.map((f,b)=>Math.hypot(d[b],l[b])));return{dt:s,nfft:o,freq:i,trajectoryFFT:e,trajectoryFFTMag:t}},inputs:["n","fftfreq","trajectory","fft"],outputs:["dt","nfft","freq","trajectoryFFT","trajectoryFFTMag"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-15"),expanded:[],variables:[]},{id:15,body:(n,a,r,u)=>{const s=n.map(e=>e.map(t=>t>a?1:0)),o=r.map(([e,t],d)=>{const l=s[d],f=(b,g)=>b*l[g];return[e.map(f),t.map(f)]}),i=o.map(e=>u(e[0],e[1]));return{trajectoryFFTMask:s,filteredTrajectoryFFT:o,filteredTrajectory:i}},inputs:["trajectoryFFTMag","threshold","trajectoryFFT","ifft"],outputs:["trajectoryFFTMask","filteredTrajectoryFFT","filteredTrajectory"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-16"),expanded:[],variables:[]},{id:16,body:(n,a,r,u,s,o,i,e,t)=>{{const d=[n,a,r],l=u.flatMap((w,k)=>{const L=w.x.map((O,x)=>({x:O,y:w.y[x],body:k}));return L.push({x:w.x[0],y:w.y[0],body:k}),L}),f=s.flatMap(([w,k],L)=>{const O=w.map((x,H)=>({x,y:k[H],body:L}));return O.push({x:w[0],y:k[0],body:L}),O}),b=[...l,...f],g=o.extent(b,w=>w.x),j=o.extent(b,w=>w.y),B=Math.min(i,640),F=400,y=40,h=20,E=20,T=30,R=B-y-h,I=F-E-T,A=g[1]-g[0],C=j[1]-j[0],M=(g[0]+g[1])/2,q=(j[0]+j[1])/2,$=Math.max(A/R,C/I),S=1.05,m=[M-$*R/2*S,M+$*R/2*S],c=[q-$*I/2*S,q+$*I/2*S],v=e.plot({width:B,height:F,marginLeft:y,marginRight:h,marginTop:E,marginBottom:T,x:{domain:m},y:{domain:c},color:{domain:[0,1,2],range:d},marks:[e.line(l,{x:"x",y:"y",z:"body",stroke:"#ccc",strokeWidth:1.5}),e.line(f,{x:"x",y:"y",z:"body",stroke:"body"})]}),_=document.createElement("figure");_.appendChild(v);const D=document.createElement("figcaption");D.textContent="Filtered orbit (colored) overlaid on the integrated trajectory (gray).",_.appendChild(D),t(_)}},inputs:["colorA","colorB","colorC","trajectory","filteredTrajectory","d3","width","Plot","display"],outputs:[],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-34"),expanded:[],variables:[]},{id:34,body:(n,a)=>({n:n(a.range([10,1e4],{label:"Steps",transform:Math.log,step:1,value:1e3}))}),inputs:["view","Inputs"],outputs:["n"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-17"),expanded:[],variables:[]},{id:17,body:(n,a)=>({threshold:n(a.range([1e-10,10],{value:1e-4,label:"Threshold",transform:Math.log}))}),inputs:["view","Inputs"],outputs:["threshold"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-18"),expanded:[],variables:[]},{id:18,body:(n,a,r,u)=>{{let s=0;n.forEach(([o,i])=>{const e=a*a;for(let t=0;t<o.length;t++)o[t]*o[t]+i[t]*i[t]>=e&&s++}),r(u`Non-zero frequency components: **${s}**`)}},inputs:["filteredTrajectoryFFT","threshold","display","md"],outputs:[],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-19"),expanded:[],variables:[]},{id:19,body:(n,a,r,u,s,o,i,e,t,d,l,f,b,g,j)=>{{const B=[n,a,r],F=Math.min(u,640),y=s.flatMap((C,M)=>C.map((q,$)=>({freq:o[$],mag:q,body:M,active:i[M][$]===1}))),h=e.plot({width:F,height:200,marginBottom:30,x:{label:"Frequency",domain:[-Math.PI/t,Math.PI/t]},y:{label:"Magnitude",type:"log"},marks:[e.dot(y.filter(C=>!C.active),{x:"freq",y:"mag",fill:"#bbb",r:2}),e.dot(y.filter(C=>C.active),{x:"freq",y:"mag",fill:C=>B[C.body],r:2}),e.ruleY([d],{stroke:"#888",strokeDasharray:"4,4"})]}),E=new Array(l).fill(0).map((C,M)=>f.period*M/l),T=b.flatMap(({x:C,y:M},q)=>{const[$,S]=g[q];return C.map((m,c)=>({t:E[c],error:Math.hypot(m-$[c],M[c]-S[c]),body:q}))}),R=e.plot({width:F,height:200,marginTop:20,x:{label:"Time"},y:{label:"Position error",type:"log",domain:[1e-8,3]},marks:[e.dot(T,{x:"t",y:"error",fill:C=>B[C.body],r:1.5})]}),I=document.createElement("figure");I.appendChild(h),I.appendChild(R);const A=document.createElement("figcaption");A.textContent="Top: frequency components (positive = counterclockwise, negative = clockwise). Bottom: absolute position error of filtered trajectory.",I.appendChild(A),j(I)}},inputs:["colorA","colorB","colorC","width","trajectoryFFTMag","freq","trajectoryFFTMask","Plot","dt","threshold","n","initialConditions","trajectory","filteredTrajectory","display"],outputs:[],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-21"),expanded:[],variables:[]},{id:21,body:(n,a)=>{const r=document.createElement("div");return r.id="spinner-container",r.style.border="1px solid #ddd",r.style.display="inline-block",r.innerHTML=n,a(r),{container:r}},inputs:["threeBodyHTML","display"],outputs:["container"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-22"),expanded:[],variables:[]},{id:22,body:(n,a)=>({speed:n(a.range([.1,10],{value:1,label:"Speed",step:.01,transform:Math.log}))}),inputs:["view","Inputs"],outputs:["speed"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-23"),expanded:[],variables:[]},{id:23,body:(n,a)=>({size:n(a.range([20,360],{value:256,label:"Div size, px",step:1}))}),inputs:["view","Inputs"],outputs:["size"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-24"),expanded:[],variables:[]},{id:24,body:(n,a)=>({radius:n(a.range([5,50],{value:20,label:"Body radius, px",step:1,transform:Math.log}))}),inputs:["view","Inputs"],outputs:["radius"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-25"),expanded:[],variables:[]},{id:25,body:(n,a)=>({precision:n(a.range([0,5],{value:2,label:"Precision, digits",step:1}))}),inputs:["view","Inputs"],outputs:["precision"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-26"),expanded:[],variables:[]},{id:26,body:(n,a)=>({trailCount:n(a.range([0,12],{value:4,label:"Trail segments",step:1}))}),inputs:["view","Inputs"],outputs:["trailCount"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-27"),expanded:[],variables:[]},{id:27,body:(n,a)=>({trailSpacing:n(a.range([.01,.5],{value:.05,label:"Trail spacing, s",step:.01,transform:Math.log}))}),inputs:["view","Inputs"],outputs:["trailSpacing"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-28"),expanded:[],variables:[]},{id:28,body:(n,a)=>({colorA:n(a.color({value:"#a0d323",label:"Color A"}))}),inputs:["view","Inputs"],outputs:["colorA"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-29"),expanded:[],variables:[]},{id:29,body:(n,a)=>({colorB:n(a.color({value:"#23a0d3",label:"Color B"}))}),inputs:["view","Inputs"],outputs:["colorB"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-30"),expanded:[],variables:[]},{id:30,body:(n,a)=>({colorC:n(a.color({value:"#d323a0",label:"Color C"}))}),inputs:["view","Inputs"],outputs:["colorC"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-31"),expanded:[],variables:[]},{id:31,body:async(n,a,r,u,s,o,i,e,t,d,l,f,b,g,j,B,F,y)=>{const h=n.period/(a*2.5);let E=0,T=0;r.forEach(({x:m,y:c})=>{for(let v=0;v<u;v++)T=Math.max(T,Math.abs(m[v]),Math.abs(c[v]))});const R=[];for(let m=0;m<s.length;m++){let k=function(x,H){return parseFloat(x)===0?x:`${x}${H}`},O=function(x,H){o[H];const W=c[0][H],G=c[1][H],X=W*W+G*G,N=i*.4/T,Y=e===0?"%.0f":`%.${e}g`,J=t(Y,parseFloat((W*N).toFixed(e))),K=t(Y,parseFloat((G*N).toFixed(e)));if(Math.hypot(parseFloat(J),parseFloat(K))===0||X<d*d)return;const Q=x-L;L+=Q;function Z(z,V){return z=k(z,"px"),V=k(V,"px"),z==="0"?`translatey(${V})`:V==="0"?`translatex(${z})`:`translate(${z},${V})`}const U=Z(J,K);D.push(`rotate(0)${U}`),w.push(`rotate(${Q}turn)${U}`)};const c=s[m],v=c[0].length,_=Math.floor((v+1)/2),D=[],w=[];let L=0;for(let x=_-1;x>0;x--)O(-x,v-x);for(let x=0;x<_;x++)O(x,x);E+=D.length,R.push([D.join(""),w.join("")])}const I=1+l,A=3*I,C=[f,b,g],M=[];for(let m=0;m<3;m++)for(let c=0;c<I;c++){const v=m*I+c+1,_=c===0?1:(1-c/I).toFixed(2),D=c===0?"":`animation-delay:${(c*j/a).toFixed(3)}s;`,w=c===0?B:Math.max(2,B*(1-.4*c/I)),k=w!==B?`width:${w.toFixed(1)}px;height:${w.toFixed(1)}px;`:"";M.push(`.threebody-o>div:nth-child(${v}){background:${C[m]};animation-name:threebody-${m};opacity:${_};${D}}`),k&&M.push(`.threebody-o>div:nth-child(${v}):after{${k}}`)}const q=n.m.map((m,c)=>{if(m===1)return"";const v=(B*Math.sqrt(m)+.5).toFixed(0);return`.threebody-o>div:nth-child(${c*I+1}):after{width:${v}px;height:${v}px}`}).filter(m=>m).join(`
`),$=new Array(A).fill("<div></div>").join(""),S=`<style>
.threebody{width:${i}px;height:${i}px;position:relative}
.threebody-o{position:absolute;top:50%;left:50%}
.threebody-o>div{position:absolute;animation:${h}s infinite linear}
.threebody-o>div:after{content:'';position:absolute;width:${B}px;height:${B}px;border-radius:100%;transform:translate(-50%,-50%);background:inherit}
${M.join(`
`)}
${q}
${R.map(([m,c],v)=>`@keyframes threebody-${v}{from{transform:${m}}to{transform:${c}}}`).join(`
`)}
</style>
<div class="threebody"><div class="threebody-o">${$}</div></div>`;F(y`Total bytes (HTML + CSS): **${S.length}** bytes
Total CSS rotation transforms: **${E}**`);{const{collapseCodeBlocks:m}=await P(async()=>{const{collapseCodeBlocks:_}=await import("./collapsible-code-DxKx0ApL.js");return{collapseCodeBlocks:_}},[]),c=document.createElement("pre"),v=document.createElement("code");v.textContent=S,c.appendChild(v),F(c),m({maxHeight:300,skip:["cell-3"]})}return{duration:h,transformCount:E,range:T,css:R,elemsPerBody:I,totalElems:A,bodyColors:C,bodyRules:M,massRadiusRules:q,divs:$,threeBodyHTML:S}},inputs:["initialConditions","speed","trajectory","n","filteredTrajectoryFFT","freq","size","precision","sprintf","threshold","trailCount","colorA","colorB","colorC","trailSpacing","radius","display","md"],outputs:["duration","transformCount","range","css","elemsPerBody","totalElems","bodyColors","bodyRules","massRadiusRules","divs","threeBodyHTML"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});p({root:document.getElementById("cell-32"),expanded:[],variables:[]},{id:32,body:(n,a)=>{n(a`<style>
  .orbit-selector select {
    margin-top: 0.25em;
  }
</style>`)},inputs:["display","html"],outputs:[],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});
