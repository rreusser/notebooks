function U(f,{width:S,height:M,toggleOffset:E=[8,8],margin:C=0,padding:N=0,onResize:L,controls:w,state:x}){let p=x?.expanded??!1,q=S,T=M,v=!1,s={x:16,y:16},o=null,m=!1,y={x:0,y:0};const P=w?Array.isArray(w)?w:[w]:[],h=[];let g=null;const c=document.createElement("div");c.className="expandable-container";const l=document.createElement("div");l.className="expandable-content";const u=document.createElement("div");if(u.className="expandable-overlay",u.addEventListener("click",()=>$()),P.length>0){o=document.createElement("div"),o.className="expandable-controls-panel",o.style.display="none";const n=document.createElement("div");n.className="expandable-controls-header";const e=document.createElement("span");e.textContent="Controls";const t=document.createElement("button");t.className="expandable-controls-toggle",t.innerHTML="▼",t.title="Collapse controls",t.addEventListener("click",r=>{r.stopPropagation(),j()}),n.appendChild(e),n.appendChild(t);const i=document.createElement("div");i.className="expandable-controls-content",o.appendChild(n),o.appendChild(i),n.addEventListener("mousedown",r=>{r.target!==t&&(m=!0,y.x=r.clientX-s.x,y.y=r.clientY-s.y,n.style.cursor="grabbing",r.preventDefault())}),document.addEventListener("mousemove",r=>{m&&(s.x=r.clientX-y.x,s.y=r.clientY-y.y,A(),k())}),document.addEventListener("mouseup",()=>{if(m){m=!1;const r=o?.querySelector(".expandable-controls-header");r&&(r.style.cursor="move")}}),n.addEventListener("touchstart",r=>{if(r.target===t)return;m=!0;const d=r.touches[0];y.x=d.clientX-s.x,y.y=d.clientY-s.y,r.preventDefault()},{passive:!1}),document.addEventListener("touchmove",r=>{if(!m)return;const d=r.touches[0];s.x=d.clientX-y.x,s.y=d.clientY-y.y,A(),k()},{passive:!0}),document.addEventListener("touchend",()=>{m=!1})}function A(){if(!o)return;const n=o.getBoundingClientRect();s.x=Math.max(0,Math.min(s.x,window.innerWidth-n.width)),s.y=Math.max(0,Math.min(s.y,window.innerHeight-n.height))}function k(){o&&p&&(o.style.left=`${s.x}px`,o.style.top=`${s.y}px`)}function j(){if(v=!v,!o)return;const n=o.querySelector(".expandable-controls-content"),e=o.querySelector(".expandable-controls-toggle");v?(n&&(n.style.display="flex"),e&&(e.innerHTML="▼",e.title="Collapse controls")):(n&&(n.style.display="none"),e&&(e.innerHTML="▶",e.title="Expand controls"))}function B(){for(let n=h.length-1;n>=0;n--){const e=h[n];if(e){if(e.placeholder&&e.placeholder.parentNode&&e.placeholder.parentNode.removeChild(e.placeholder),e.selector){const t=document.querySelector(e.selector);if(t&&t!==e.element){e.element.parentNode&&e.element.parentNode.removeChild(e.element);continue}}e.element&&e.originalParent&&(e.originalNextSibling?e.originalParent.insertBefore(e.element,e.originalNextSibling):e.originalParent.appendChild(e.element))}}h.length=0}function K(){g||(g=new MutationObserver(n=>{if(!p||!o)return;const e=o.querySelector(".expandable-controls-content");if(e)for(const t of h){if(!t.selector)continue;const i=document.querySelector(t.selector);if(i&&i!==t.element&&!e.contains(i)){const r=t.element;t.element=i,t.originalParent=i.parentNode,t.originalNextSibling=i.nextSibling;const d=document.createElement("div");d.className="expandable-controls-placeholder",d.style.display="none",i.parentNode.insertBefore(d,i),t.placeholder&&t.placeholder.parentNode&&t.placeholder.parentNode.removeChild(t.placeholder),t.placeholder=d,r.parentNode===e?(e.insertBefore(i,r),e.removeChild(r)):e.appendChild(i)}}}),g.observe(document.body,{childList:!0,subtree:!0}))}function W(){g&&(g.disconnect(),g=null)}const a=document.createElement("button");if(a.className="expandable-toggle",a.innerHTML="⤢",a.title="Expand",a.style.top=`${-E[1]}px`,a.style.right=`${-E[0]}px`,typeof f=="function"&&(f=f()),typeof f=="string"){const n=document.createElement("div");n.innerHTML=f,f=n.firstElementChild||n}l.appendChild(f),l.appendChild(a),c.appendChild(l),L&&L(f,S,M,!1);let H=null;function D(){!p&&c.isConnected&&(H=c.offsetHeight)}requestAnimationFrame(()=>{D()});function F(n,e){q=n,T=e,L&&L(f,n,e,p)}function $(){p=!1,x&&(x.expanded=!1),c.classList.remove("expandable-expanded"),a.innerHTML="⤢",a.title="Expand",a.style.top=`${-E[1]}px`,a.style.right=`${-E[0]}px`,u.parentNode&&u.remove(),W(),o&&(o.classList.remove("expandable-expanded"),o.style.display="none",B()),c.style.height="",l.style.position="relative",l.style.display="inline-block",l.style.top="",l.style.left="",l.style.transform="",l.style.width="",l.style.height="",l.style.overflow="",l.style.boxShadow="",l.classList.remove("expanded"),l.style.padding="",l.style.borderRadius="",l.style.zIndex="1";const n=l.querySelector("figure");n&&(n.style.margin=n._savedMargin??""),F(S,M),requestAnimationFrame(()=>{D()})}function X(){if(!p)return;const n=window.innerWidth,e=window.innerHeight,[t,i]=Array.isArray(C)?C:[C,C],[r,d]=Array.isArray(N)?N:[N,N],I=n-t*2-r*2,R=e-i*2-d*2,G=I+r*2,J=R+d*2;l.style.position="fixed",l.style.display="block",l.style.width=`${G}px`,l.style.height=`${J}px`,l.style.overflow="hidden",l.style.zIndex="9999",t===0&&i===0?(l.style.top="0",l.style.left="0",l.style.transform="none",l.style.borderRadius="0",l.style.boxShadow="none"):(l.style.top=`${i}px`,l.style.left=`${t}px`,l.style.transform="none",l.style.borderRadius="8px",l.style.boxShadow="0 8px 32px rgba(0,0,0,0.3)"),l.classList.add("expanded"),l.style.padding=`${d}px ${r}px`;const b=l.querySelector("figure");b&&(b._savedMargin=b._savedMargin??b.style.margin,b.style.margin="0"),F(I,R)}function Y(){if(p=!0,x&&(x.expanded=!0),c.classList.add("expandable-expanded"),a.innerHTML="✕",a.title="Collapse",a.style.top="8px",a.style.right="8px",u.parentNode||document.body.appendChild(u),u.style.opacity="1",u.style.pointerEvents="auto",H?c.style.height=`${H}px`:c.style.height=`${c.offsetHeight}px`,P.length>0&&o){const n=o.querySelector(".expandable-controls-content");if(n)for(const e of P){const t=typeof e=="string"?document.querySelector(e):e;if(!t||!t.parentNode)continue;const i=document.createElement("div");i.className="expandable-controls-placeholder",i.style.height=`${t.offsetHeight}px`,i.style.display="block",h.push({element:t,selector:typeof e=="string"?e:null,originalParent:t.parentNode,originalNextSibling:t.nextSibling,placeholder:i}),t.parentNode.insertBefore(i,t),n.appendChild(t)}if(h.length>0){o.parentNode||document.body.appendChild(o),o.classList.add("expandable-expanded"),o.style.display="",o.style.left=`${s.x}px`,o.style.top=`${s.y}px`,v=!(window.innerWidth<640);const t=o.querySelector(".expandable-controls-content"),i=o.querySelector(".expandable-controls-toggle");v?(t&&(t.style.display="flex"),i&&(i.innerHTML="▼",i.title="Collapse controls")):(t&&(t.style.display="none"),i&&(i.innerHTML="▶",i.title="Expand controls"))}}X(),K()}a.addEventListener("click",n=>{n.stopPropagation(),p?$():Y()});const O=()=>{p&&X()};window.addEventListener("resize",O);const _=n=>{n.key==="Escape"&&p&&$()};document.addEventListener("keydown",_);const z=new MutationObserver(()=>{document.contains(c)||(document.removeEventListener("keydown",_),window.removeEventListener("resize",O),W(),u.parentNode&&u.remove(),B(),o&&o.parentNode&&o.remove(),z.disconnect())});return z.observe(document.body,{childList:!0,subtree:!0}),Object.defineProperty(c,"expandedDimensions",{get:()=>({width:q,height:T,expanded:p})}),x?.expanded&&requestAnimationFrame(()=>{Y()}),c}export{U as expandable};
