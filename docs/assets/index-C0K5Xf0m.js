const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pipeline-DxPxPhdA.js","assets/fft-DMDJR3Su.js"])))=>i.map(i=>d[i]);
import{d as c,_ as ie}from"./index-ByB2dbry.js";c({root:document.getElementById("cell-2"),expanded:[],variables:[]},{id:2,body:(e,n)=>{navigator.gpu||e(n`<div style="color: red; padding: 20px; border: 1px solid red; background: #fff0f0; border-radius: 4px;">
    <strong>WebGPU is not available</strong><br>
    Please use a browser that supports WebGPU (Chrome 113+, Edge 113+, or Firefox with flags enabled).
  </div>`)},inputs:["display","html"],outputs:[],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-3"),expanded:[],variables:[]},{id:3,body:async()=>{const[{createWebGPUContext:e,isWebGPUAvailable:n},{createTuringPipelines:s},{executeFFT2D:a,createVec4FFTPipelines:i,executeVec4FFT2D:t},{createElementStack:o},{createZoomableAxes:f},{expandable:l}]=await Promise.all([ie(()=>import("./webgpu-context-DeTOoImp.js"),[]).then(r=>{if(!("createWebGPUContext"in r))throw new SyntaxError("export 'createWebGPUContext' not found");if(!("isWebGPUAvailable"in r))throw new SyntaxError("export 'isWebGPUAvailable' not found");return r}),ie(()=>import("./pipeline-DxPxPhdA.js"),__vite__mapDeps([0,1])).then(r=>{if(!("createTuringPipelines"in r))throw new SyntaxError("export 'createTuringPipelines' not found");return r}),ie(()=>import("./fft-DMDJR3Su.js"),[]).then(r=>{if(!("executeFFT2D"in r))throw new SyntaxError("export 'executeFFT2D' not found");if(!("createVec4FFTPipelines"in r))throw new SyntaxError("export 'createVec4FFTPipelines' not found");if(!("executeVec4FFT2D"in r))throw new SyntaxError("export 'executeVec4FFT2D' not found");return r}),ie(()=>import("./element-stack-BU40TvN2.js"),[]).then(r=>{if(!("createElementStack"in r))throw new SyntaxError("export 'createElementStack' not found");return r}),ie(()=>import("./zoomable-axes-BfGyq1bg.js"),[]).then(r=>{if(!("createZoomableAxes"in r))throw new SyntaxError("export 'createZoomableAxes' not found");return r}),ie(()=>import("./expandable-dZkDG0zz.js"),[]).then(r=>{if(!("expandable"in r))throw new SyntaxError("export 'expandable' not found");return r})]);return{createWebGPUContext:e,isWebGPUAvailable:n,createTuringPipelines:s,executeFFT2D:a,createVec4FFTPipelines:i,executeVec4FFT2D:t,createElementStack:o,createZoomableAxes:f,expandable:l}},inputs:[],outputs:["createWebGPUContext","isWebGPUAvailable","createTuringPipelines","executeFFT2D","createVec4FFTPipelines","executeVec4FFT2D","createElementStack","createZoomableAxes","expandable"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-4"),expanded:[],variables:[]},{id:4,body:async(e,n)=>{const s=await e(),a=s.device,i=s.precision,t=navigator.gpu.getPreferredCanvasFormat(),o=i==="f16"?2:4;return n.then(()=>a.destroy()),{context:s,device:a,precision:i,canvasFormat:t,bytesPerFloat:o}},inputs:["createWebGPUContext","invalidation"],outputs:["context","device","precision","canvasFormat","bytesPerFloat"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-5"),expanded:[],variables:[]},{id:5,body:e=>({N:parseInt(e.split("×")[0])}),inputs:["NString"],outputs:["N"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-6"),expanded:[],variables:[]},{id:6,body:()=>({gridSizeState:{N:512}}),inputs:[],outputs:["gridSizeState"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-7"),expanded:[],variables:[]},{id:7,body:()=>({expandableState:{expanded:!1}}),inputs:[],outputs:["expandableState"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-8"),expanded:[],variables:[]},{id:8,body:(e,n)=>{n.N=e},inputs:["N","gridSizeState"],outputs:[],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-9"),expanded:[],variables:[]},{id:9,body:(e,n,s,a)=>{const i=e.range([1,8],{value:4,step:1,label:"Number of scales"}),t=n(i);return s(a`<div id="turing-num-scales">${i}</div>`),{numScalesInput:i,numScalesValue:t}},inputs:["Inputs","view","display","html"],outputs:["numScalesInput","numScalesValue"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-10"),expanded:[],variables:[]},{id:10,body:e=>({numScales:Math.round(e??1)}),inputs:["numScalesValue"],outputs:["numScales"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-11"),expanded:[],variables:[]},{id:11,body:(e,n,s,a,i)=>{function t(d,y,w){const F=Math.floor(d*6),z=d*6-F,P=w*(1-y),G=w*(1-z*y),x=w*(1-(1-z)*y),V=F%6,B=[w,G,P,P,x,w][V],X=[x,w,w,G,P,P][V],K=[P,P,x,w,w,G][V];return[B,X,K]}function o(){return t(Math.random(),Math.random(),1)}const f=Array.from({length:10},o);function l(d,y,w=[]){const F=document.createElement("div");F.className="scale-params-container symmetry-hidden";const z=document.createElement("style");z.textContent=`
    .scale-params-container .label-full { display: inline; }
    .scale-params-container .label-short { display: none; }
    .expandable-expanded .scale-params-container .label-full { display: none; }
    .expandable-expanded .scale-params-container .label-short { display: inline; }
    .expandable-expanded .scale-params-container .input-activator { width: 40px !important; }
    .expandable-expanded .scale-params-container .input-inhibitor-ratio { width: 40px !important; }
    .expandable-expanded .scale-params-container .input-symmetry { width: 32px !important; }
    .scale-params-container.symmetry-hidden .symmetry-col { display: none; }
  `,F.appendChild(z);const P=document.createElement("table");P.style.cssText="border-collapse: collapse; width: 100%; font-size: 11px; margin: 4px 0;";const G=document.createElement("thead");G.innerHTML=`
    <tr style="text-align: left;">
      <th style="padding: 2px 4px;"><span class="label-short">A</span><span class="label-full">Activator</span></th>
      <th style="padding: 2px 4px;"><span class="label-short">I/A</span><span class="label-full">Inh/Act</span></th>
      <th style="padding: 2px 4px;"><span class="label-short">K</span><span class="label-full">Kernel</span></th>
      <th style="padding: 2px 4px;"><span class="label-short">Δ</span><span class="label-full">Amount</span></th>
      <th style="padding: 2px 4px;"><span class="label-short">W</span><span class="label-full">Weight</span></th>
      <th class="symmetry-col" style="padding: 2px 4px;"><span class="label-short">S</span><span class="label-full">Symmetry</span></th>
      <th style="padding: 2px 4px;"></th>
    </tr>
  `,P.appendChild(G);const x=document.createElement("tbody"),V=[];function B(){F.value=V.map(p=>({activatorRadius:parseFloat(p.activator.value)||2,inhibitorRatio:parseFloat(p.inhibitorRatio.value)||2,kernelType:p.kernel.value==="circular"?1:0,amount:parseFloat(p.amount.value)||.05,weight:parseFloat(p.weight.value)||1,symmetry:parseInt(p.symmetry.value)||1,color:X(p.color.value)})),F.dispatchEvent(new CustomEvent("input"))}function X(p){const g=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(p);return g?[parseInt(g[1],16)/255,parseInt(g[2],16)/255,parseInt(g[3],16)/255]:[.5,.5,.5]}function K(p){const g=Math.round(p[0]*255),h=Math.round(p[1]*255),O=Math.round(p[2]*255);return"#"+[g,h,O].map(T=>T.toString(16).padStart(2,"0")).join("")}function oe(p){const h=n.N/8,O=d>1?p/(d-1):0,T=3*Math.pow(h/3,O),C=.7+Math.random()*.6;return Math.round(T*C)}function te(p){const g=[1,1,2,3,4,6,8];return{activatorRadius:oe(p),inhibitorRatio:(1.5+Math.random()*2.5).toFixed(1),kernelType:Math.random()>.5?1:0,amount:(.003+.1*Math.pow(Math.random(),2)).toFixed(3),weight:(.1+Math.random()*.9).toFixed(2),symmetry:g[Math.floor(Math.random()*g.length)],color:o()}}for(let p=0;p<d;p++){const h=w[p]||te(p),O=document.createElement("tr"),T=document.createElement("input");T.type="number",T.className="input-activator",T.value=h.activatorRadius,T.min=1,T.max=200,T.step=1,T.style.cssText="width: 50px; padding: 2px;",T.oninput=B;const C=document.createElement("input");C.type="number",C.className="input-inhibitor-ratio",C.value=h.inhibitorRatio,C.min=1,C.max=10,C.step=.1,C.style.cssText="width: 50px; padding: 2px;",C.oninput=B;const I=document.createElement("button");I.type="button",I.value=h.kernelType===1?"circular":"gaussian",I.style.cssText=`
      width: 24px; height: 22px; padding: 0; border: 1px solid #ccc;
      border-radius: 4px; background: #fff; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
    `;const Z=document.createElement("div");Z.style.cssText=`
      width: 12px; height: 12px; border-radius: 50%; background: #333;
      filter: ${I.value==="gaussian"?"blur(3px)":"none"};
      transition: filter 0.15s ease;
    `,I.appendChild(Z),I._dot=Z,I.title=I.value==="gaussian"?"Gaussian (click for circular)":"Circular (click for gaussian)",I.onclick=()=>{I.value=I.value==="gaussian"?"circular":"gaussian",Z.style.filter=I.value==="gaussian"?"blur(3px)":"none",I.title=I.value==="gaussian"?"Gaussian (click for circular)":"Circular (click for gaussian)",B()};const q=document.createElement("input");q.type="number",q.value=h.amount,q.min=.001,q.max=1,q.step=.001,q.style.cssText="width: 55px; padding: 2px;",q.oninput=B;const W=document.createElement("input");W.type="number",W.value=h.weight,W.min=0,W.max=1,W.step=.01,W.style.cssText="width: 50px; padding: 2px;",W.oninput=B;const _=document.createElement("input");_.type="number",_.className="input-symmetry",_.value=h.symmetry??1,_.min=1,_.max=8,_.step=1,_.style.cssText="width: 40px; padding: 2px;",_.oninput=B;const H=document.createElement("input");H.type="color",H.value=K(h.color),H.style.cssText="width: 36px; height: 22px; padding: 0; border: 1px solid #ccc;",H.oninput=B,[T,C,I,q,W,_,H].forEach((re,ue)=>{const ne=document.createElement("td");ne.style.padding="1px 2px",ue===5&&(ne.className="symmetry-col"),ne.appendChild(re),O.appendChild(ne)}),x.appendChild(O),V.push({activator:T,inhibitorRatio:C,kernel:I,amount:q,weight:W,symmetry:_,color:H})}return P.appendChild(x),F.appendChild(P),F.randomize=()=>{for(let p=0;p<V.length;p++){const g=V[p],h=te(p);g.activator.value=h.activatorRadius,g.inhibitorRatio.value=h.inhibitorRatio,g.kernel.value=h.kernelType===1?"circular":"gaussian",g.kernel._dot.style.filter=h.kernelType===1?"none":"blur(3px)",g.amount.value=h.amount,g.weight.value=h.weight,g.symmetry.value=h.symmetry,g.color.value=K(h.color)}B()},B(),F}const r=[],u=l(e,n.N,r),b=s(u);return a(i`<div id="turing-scale-params">${u}</div>`),{hsvToRgb:t,randomColor:o,defaultColors:f,createScaleParamsInput:l,existingScaleParams:r,scaleParamsInput:u,scaleParamsValue:b}},inputs:["numScales","gridSizeState","view","display","html"],outputs:["hsvToRgb","randomColor","defaultColors","createScaleParamsInput","existingScaleParams","scaleParamsInput","scaleParamsValue"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-12"),expanded:[],variables:[]},{id:12,body:e=>({scaleParams:e??[{activatorRadius:2,inhibitorRatio:2,kernelType:0,amount:.05,weight:1,symmetry:1,color:[.33,.53,.8]}]}),inputs:["scaleParamsValue"],outputs:["scaleParams"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-13"),expanded:[],variables:[]},{id:13,body:(e,n,s,a,i)=>{const t=document.createElement("button");t.textContent="Randomize",t.style.cssText="padding: 4px 8px; cursor: pointer; font-size: 12px;",t.onclick=()=>{const l=document.querySelector("#turing-scale-params .scale-params-container");l?.randomize&&l.randomize()};const o=document.createElement("button");return o.id="turing-download-btn",o.textContent="Download PNG",o.style.cssText="padding: 4px 8px; cursor: pointer; font-size: 12px;",o.onclick=()=>{o._download&&o._download()},e.style.cssText="padding: 4px 8px; cursor: pointer; font-size: 12px;",n(s`<div id="turing-button-row" style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
  ${t}
  ${e}
  ${o}
  ${a}
  ${i}
</div>`),{randomizeBtn:t,downloadBtn:o,downloadButton:o}},inputs:["restartButton","display","html","simulateInput","symmetryInput"],outputs:["randomizeBtn","downloadBtn","downloadButton"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-14"),expanded:[],variables:[]},{id:14,body:e=>{const n=document.querySelector("#turing-scale-params .scale-params-container");return n&&n.classList.toggle("symmetry-hidden",!e),{container:n}},inputs:["symmetryEnabled"],outputs:["container"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-15"),expanded:[],variables:[]},{id:15,body:(e,n,s,a,i,t,o,f,l,r)=>{const u=s`<figure style="margin: 0;">${e.element}</figure>`;return a(i(u,{width:Math.min(t,640),height:Math.min(t,640),toggleOffset:[-15,-16],controls:["#turing-num-scales","#turing-scale-params","#turing-button-row","#turing-sim-controls","#turing-display-controls"],state:o,onResize(b,d,y){e.resize(d,y),n.updateScales(f.scaleLinear().domain([0,l.N]).range([0,d]),f.scaleLinear().domain([0,l.N]).range([y,0])),r.dirty=!0}})),{figure:u}},inputs:["stack","axes","html","display","expandable","width","expandableState","d3","gridSizeState","simState"],outputs:["figure"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-16"),expanded:[],variables:[]},{id:16,body:(e,n)=>{const s=e`<div id="turing-status" style="font-family: monospace; font-size: 12px; color: #666;">Initializing...</div>`;return n(s),{statusEl:s}},inputs:["html","display"],outputs:["statusEl"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-17"),expanded:[],variables:[]},{id:17,body:(e,n,s)=>{const a=e.limits.maxComputeWorkgroupSizeX,i=[256,512,1024,2048,4096],t=i.filter(u=>{if(u<=a)return!0;const d=u/a;return Number.isInteger(d)&&(d&d-1)===0}),o=t.map(u=>`${u}×${u}`),f=512,l=n.select(o,{value:`${f}×${f}`,label:"Grid size"}),r=s(l);return{maxWorkgroupSize:a,allSizes:i,validSizes:t,gridSizeOptions:o,defaultN:f,NInput:l,NString:r}},inputs:["device","Inputs","view"],outputs:["maxWorkgroupSize","allSizes","validSizes","gridSizeOptions","defaultN","NInput","NString"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-18"),expanded:[],variables:[]},{id:18,body:e=>{const n=document.createElement("label");n.style.cssText="display: flex; align-items: center; gap: 4px; cursor: pointer; font-size: 12px;";const s=document.createElement("input");s.type="checkbox",s.checked=!0,n.appendChild(s),n.appendChild(document.createTextNode("Simulate")),n.value=!0,s.onchange=()=>{n.value=s.checked,n.dispatchEvent(new CustomEvent("input"))};const a=e(n),i=document.createElement("label");i.style.cssText="display: flex; align-items: center; gap: 4px; cursor: pointer; font-size: 12px;";const t=document.createElement("input");t.type="checkbox",t.checked=!1,i.appendChild(t),i.appendChild(document.createTextNode("Symmetry")),i.value=!1,t.onchange=()=>{i.value=t.checked,i.dispatchEvent(new CustomEvent("input"))};const o=e(i);return{simulateContainer:n,simulateCheckbox:s,simulateValue:a,symmetryContainer:i,symmetryCheckbox:t,symmetryEnabledValue:o,simulateInput:n,symmetryInput:i}},inputs:["view"],outputs:["simulateContainer","simulateCheckbox","simulateValue","symmetryContainer","symmetryCheckbox","symmetryEnabledValue","simulateInput","symmetryInput"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-19"),expanded:[],variables:[]},{id:19,body:()=>({symmetryState:{enabled:!1}}),inputs:[],outputs:["symmetryState"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-20"),expanded:[],variables:[]},{id:20,body:(e,n,s)=>{const a=e??!0,i=n??!1;return s.enabled=i,{simulate:a,symmetryEnabled:i}},inputs:["simulateValue","symmetryEnabledValue","symmetryState"],outputs:["simulate","symmetryEnabled"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-21"),expanded:[],variables:[]},{id:21,body:(e,n)=>{n.dirty=!0},inputs:["symmetryEnabled","simState"],outputs:[],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-22"),expanded:[],variables:[]},{id:22,body:(e,n,s,a,i)=>{const t=document.createElement("button");t.textContent="Restart",t.style.cssText="padding: 4px 12px; cursor: pointer; font-size: 12px;";let o=0;t.value=o,t.onclick=()=>{t.value=++o,t.dispatchEvent(new CustomEvent("input"))};const f=e(t),l=n.range([.01,1],{value:.2,step:.01,label:"Step size"}),r=e(l),u=n.range([.001,.1],{value:.02,step:.001,label:"Color rate"}),b=e(u),d=n.range([1,20],{value:4,step:1,label:"Steps per frame"}),y=e(d);return s(a`<div id="turing-sim-controls">
  <details class="sim-config-details" open>
    <summary style="cursor: pointer; font-size: 12px;">Simulation config</summary>
    <div style="padding-left: 8px;">
      <div id="turing-grid-size">${i}</div>
      ${l}
      ${u}
      ${d}
    </div>
  </details>
</div>`),{restartBtn:t,restartCount:o,restart:f,stepSizeInput:l,stepSizeValue:r,colorRateInput:u,colorRateValue:b,stepsPerFrameInput:d,stepsPerFrameValue:y,restartButton:t}},inputs:["view","Inputs","display","html","NInput"],outputs:["restartBtn","restartCount","restart","stepSizeInput","stepSizeValue","colorRateInput","colorRateValue","stepsPerFrameInput","stepsPerFrameValue","restartButton"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-23"),expanded:[],variables:[]},{id:23,body:(e,n,s)=>{const a=e??.02,i=n??.01,t=Math.round(s??5);return{stepSize:a,colorRate:i,stepsPerFrame:t}},inputs:["stepSizeValue","colorRateValue","stepsPerFrameValue"],outputs:["stepSize","colorRate","stepsPerFrame"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-24"),expanded:[],variables:[]},{id:24,body:(e,n,s,a)=>{const i=e.range([0,.99],{value:.7,step:.01,label:"Contrast"}),t=n(i),o=e.range([-2,2],{value:-1,step:.1,label:"Brightness"}),f=n(o),l=e.range([.2,3],{value:1,step:.1,label:"Gamma"}),r=n(l),u=e.range([0,1],{value:1,step:.1,label:"Color strength"}),b=n(u),d=e.toggle({label:"Invert",value:!1}),y=n(d);return s(a`<div id="turing-display-controls">
  <details class="display-config-details">
    <summary style="cursor: pointer; font-size: 12px; margin-bottom: 8px;">Display config</summary>
    <div style="padding-left: 8px;">
      ${i}
      ${o}
      ${l}
      ${u}
      ${d}
    </div>
  </details>
</div>`),{contrastInput:i,contrastValue:t,brightnessInput:o,brightnessValue:f,gammaInput:l,gammaValue:r,colorStrengthInput:u,colorStrengthValue:b,invertInput:d,invertValue:y}},inputs:["Inputs","view","display","html"],outputs:["contrastInput","contrastValue","brightnessInput","brightnessValue","gammaInput","gammaValue","colorStrengthInput","colorStrengthValue","invertInput","invertValue"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-25"),expanded:[],variables:[]},{id:25,body:(e,n,s,a,i)=>({contrast:e??.5,brightness:n??0,gamma:s??1,colorStrength:a??.5,invert:i??!1}),inputs:["contrastValue","brightnessValue","gammaValue","colorStrengthValue","invertValue"],outputs:["contrast","brightness","gamma","colorStrength","invert"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-26"),expanded:[],variables:[]},{id:26,body:(e,n,s,a,i,t,o,f,l)=>{const r=e*e*4*i,u=e*e*2*i,b=t.STORAGE|t.COPY_SRC|t.COPY_DST,d=[o.createBuffer({label:"Solution 0",size:r,usage:b}),o.createBuffer({label:"Solution 1",size:r,usage:b})],y=o.createBuffer({label:"fhat",size:u,usage:b}),w=o.createBuffer({label:"fhat_freq",size:u,usage:b}),F=[o.createBuffer({label:"FFT temp 0",size:u,usage:b}),o.createBuffer({label:"FFT temp 1",size:u,usage:b})],z=e*e*4*i,P=o.createBuffer({label:"Vec4 FFT work",size:z,usage:b|t.COPY_DST|t.COPY_SRC}),G=[o.createBuffer({label:"Vec4 FFT temp 0",size:z,usage:b}),o.createBuffer({label:"Vec4 FFT temp 1",size:z,usage:b})],x=f(o,e,o.limits.maxComputeWorkgroupSizeX,l),V=Math.ceil(n/2),B=V*e*e*4*i,X=o.createBuffer({label:"Activator/Inhibitor",size:B,usage:b}),K=o.createBuffer({label:"Init params",size:16,usage:t.UNIFORM|t.COPY_DST}),oe=o.createBuffer({label:"Extract params",size:16,usage:t.UNIFORM|t.COPY_DST}),te=o.createBuffer({label:"Convolve params",size:48,usage:t.UNIFORM|t.COPY_DST}),p=o.createBuffer({label:"Update params",size:32,usage:t.UNIFORM|t.COPY_DST}),g=o.createBuffer({label:"Scale params",size:n*32,usage:t.STORAGE|t.COPY_DST}),h=o.createBuffer({label:"Visualize params",size:40,usage:t.UNIFORM|t.COPY_DST}),O=o.createBuffer({label:"View inverse",size:64,usage:t.UNIFORM|t.COPY_DST});return{solutionSize:r,complexSize:u,bufferUsage:b,solution:d,fhat:y,fhatFreq:w,fftTemp:F,vec4Size:z,vec4FftWork:P,vec4FftTemp:G,vec4FftPipelines:x,numScalePairs:V,aiSize:B,activatorInhibitor:X,initParamsBuffer:K,extractParamsBuffer:oe,convolveParamsBuffer:te,updateParamsBuffer:p,scaleParamsBuffer:g,visualizeParamsBuffer:h,viewInverseBuffer:O}},inputs:["N","numScales","restart","scaleParams","bytesPerFloat","GPUBufferUsage","device","createVec4FFTPipelines","precision"],outputs:["solutionSize","complexSize","bufferUsage","solution","fhat","fhatFreq","fftTemp","vec4Size","vec4FftWork","vec4FftTemp","vec4FftPipelines","numScalePairs","aiSize","activatorInhibitor","initParamsBuffer","extractParamsBuffer","convolveParamsBuffer","updateParamsBuffer","scaleParamsBuffer","visualizeParamsBuffer","viewInverseBuffer"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-27"),expanded:[],variables:[]},{id:27,body:async(e,n,s,a,i)=>({pipelines:await s(a,i,e,n)}),inputs:["N","precision","createTuringPipelines","device","canvasFormat"],outputs:["pipelines"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-28"),expanded:[],variables:[]},{id:28,body:(e,n,s,a,i,t,o)=>{const f=window.devicePixelRatio||1;function l(b,d){const y=Math.round(b*f),w=Math.round(d*f);(e.width!==y||e.height!==w)&&(e.width=y,e.height=w,n.configure({device:a,format:i,alphaMode:"opaque"})),e.style.width=`${b}px`,e.style.height=`${d}px`}const r=Math.min(t,640);l(r,r);const u=o({width:r,height:r,layers:[{id:"canvas",element:({current:b,width:d,height:y})=>(l(d,y),e)}]});return{dpr:f,resizeCanvas:l,initialSize:r,stack:u}},inputs:["canvas","ctx","N","device","canvasFormat","width","createElementStack"],outputs:["dpr","resizeCanvas","initialSize","stack"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-29"),expanded:[],variables:[]},{id:29,body:(e,n,s)=>{const a=document.createElement("canvas");a.id="turing-canvas";const i=a.getContext("webgpu");return a.width=1,a.height=1,i.configure({device:n,format:s,alphaMode:"opaque"}),{canvas:a,ctx:i}},inputs:["N","device","canvasFormat"],outputs:["canvas","ctx"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-30"),expanded:[],variables:[]},{id:30,body:(e,n,s,a,i,t)=>{const o=Math.floor(Math.random()*4294967295),f=new Uint32Array([e,e,o,0]);t.queue.writeBuffer(a,0,f);const l=t.createBindGroup({label:"Initialize bind group",layout:i.bindGroupLayouts.initialize,entries:[{binding:0,resource:{buffer:s[0]}},{binding:1,resource:{buffer:a}}]}),r=t.createCommandEncoder({label:"Initialize encoder"}),u=r.beginComputePass({label:"Initialize pass"});u.setPipeline(i.initialize),u.setBindGroup(0,l),u.dispatchWorkgroups(Math.ceil(e/16),Math.ceil(e/16),1),u.end(),t.queue.submit([r.finish()]);const b=t.createBindGroup({label:"Initialize bind group 2",layout:i.bindGroupLayouts.initialize,entries:[{binding:0,resource:{buffer:s[1]}},{binding:1,resource:{buffer:a}}]}),d=t.createCommandEncoder({label:"Initialize encoder 2"}),y=d.beginComputePass({label:"Initialize pass 2"});return y.setPipeline(i.initialize),y.setBindGroup(0,b),y.dispatchWorkgroups(Math.ceil(e/16),Math.ceil(e/16),1),y.end(),t.queue.submit([d.finish()]),{randomSeed:o,initParams:f,initBindGroup:l,initEncoder:r,initPass:u,init2BindGroup:b,init2Encoder:d,init2Pass:y}},inputs:["N","restart","solution","initParamsBuffer","pipelines","device"],outputs:["randomSeed","initParams","initBindGroup","initEncoder","initPass","init2BindGroup","init2Encoder","init2Pass"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-31"),expanded:[],variables:[]},{id:31,body:()=>({simState:{dirty:!0,solutionIndex:0,iteration:0}}),inputs:[],outputs:["simState"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-32"),expanded:[],variables:[]},{id:32,body:(e,n,s)=>{s.dirty=!0,s.solutionIndex=0,s.iteration=0},inputs:["restart","scaleParams","simState"],outputs:[],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-33"),expanded:[],variables:[]},{id:33,body:(e,n,s,a,i)=>{const t=s({d3:a,element:e.element,xScale:a.scaleLinear().domain([0,n]).range([0,e.width]),yScale:a.scaleLinear().domain([0,n]).range([e.height,0]),aspectRatio:1,onChange:()=>{i.dirty=!0}});return e.addEventListener("update",()=>{i.dirty=!0}),{axes:t}},inputs:["stack","N","createZoomableAxes","d3","simState"],outputs:["axes"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-34"),expanded:[],variables:[]},{id:34,body:(e,n,s,a,i,t,o,f,l,r,u,b,d,y,w,F,z,P,G,x,V,B,X,K,oe,te,p,g,h,O,T,C,I,Z,q,W,_,H,re,ue,ne,ve)=>{x.dirty=!0;const J=Math.ceil(a/16),me=new Uint32Array([a,a,0,0]);e.queue.writeBuffer(b,0,me);const le=[e.createBindGroup({label:"Visualize bind group 0",layout:t.bindGroupLayouts.visualize,entries:[{binding:0,resource:{buffer:o[0]}},{binding:1,resource:{buffer:F}},{binding:2,resource:{buffer:z}}]}),e.createBindGroup({label:"Visualize bind group 1",layout:t.bindGroupLayouts.visualize,entries:[{binding:0,resource:{buffer:o[1]}},{binding:1,resource:{buffer:F}},{binding:2,resource:{buffer:z}}]})],fe=[e.createBindGroup({label:"Update bind group 0->1",layout:t.bindGroupLayouts.update,entries:[{binding:0,resource:{buffer:o[0]}},{binding:1,resource:{buffer:u}},{binding:2,resource:{buffer:o[1]}},{binding:3,resource:{buffer:y}},{binding:4,resource:{buffer:w}}]}),e.createBindGroup({label:"Update bind group 1->0",layout:t.bindGroupLayouts.update,entries:[{binding:0,resource:{buffer:o[1]}},{binding:1,resource:{buffer:u}},{binding:2,resource:{buffer:o[0]}},{binding:3,resource:{buffer:y}},{binding:4,resource:{buffer:w}}]})];function be(){const m=new Float32Array(i*8);for(let S=0;S<i;S++){const E=P[S],$=S*8;m[$+0]=E.weight,m[$+1]=E.amount,m[$+2]=B.enabled?E.symmetry:1,m[$+3]=0,m[$+4]=E.color[0],m[$+5]=E.color[1],m[$+6]=E.color[2],m[$+7]=0}e.queue.writeBuffer(w,0,m);const v=new Float32Array(8),A=new Uint32Array(v.buffer);A[0]=a,A[1]=a,A[2]=i,v[3]=X,v[4]=K,e.queue.writeBuffer(y,0,v);const k=new Float32Array(10),M=new Uint32Array(k.buffer);M[0]=a,M[1]=a,k[2]=p,k[3]=g,k[4]=O,k[5]=h,M[6]=T?1:0,k[8]=a,k[9]=a,e.queue.writeBuffer(F,0,k),e.queue.writeBuffer(z,0,G.viewInverse)}function ye(){const m=e.createCommandEncoder({label:`Simulation step ${x.iteration}`}),v=e.createBindGroup({layout:t.bindGroupLayouts.extract,entries:[{binding:0,resource:{buffer:o[x.solutionIndex]}},{binding:1,resource:{buffer:f}},{binding:2,resource:{buffer:b}}]}),A=m.beginComputePass({label:"Extract pass"});A.setPipeline(t.extract),A.setBindGroup(0,v),A.dispatchWorkgroups(J,J,1),A.end(),e.queue.submit([m.finish()]),C({device:e,pipelines:t.fft,input:f,output:l,temp:r,N:a,forward:!0,splitNormalization:!0});const k=Math.ceil(i/2);for(let E=0;E<k;E++){const $=E*2,se=Math.min(E*2+1,i-1),U=P[$],D=P[se],L=new Float32Array(12),j=new Uint32Array(L.buffer);j[0]=a,j[1]=a,L[4]=U.activatorRadius,L[5]=U.activatorRadius*U.inhibitorRatio,L[6]=D.activatorRadius,L[7]=D.activatorRadius*D.inhibitorRatio,j[8]=U.kernelType,j[9]=U.kernelType,j[10]=D.kernelType,j[11]=D.kernelType,e.queue.writeBuffer(d,0,L);const R=a*a*4*I,Q=E*R,ee=e.createCommandEncoder({label:`Convolve pair ${E}`}),ae=e.createBindGroup({layout:t.bindGroupLayouts.convolve,entries:[{binding:0,resource:{buffer:l}},{binding:1,resource:{buffer:u,offset:Q,size:R}},{binding:2,resource:{buffer:d}}]}),N=ee.beginComputePass({label:`Convolve pass ${E}`});N.setPipeline(t.convolve),N.setBindGroup(0,ae),N.dispatchWorkgroups(J,J,1),N.end(),e.queue.submit([ee.finish()]);const Y=e.createCommandEncoder({label:`Copy to vec4 work ${E}`});Y.copyBufferToBuffer(u,Q,Z,0,R),e.queue.submit([Y.finish()]),q({device:e,pipelines:W,input:Z,output:Z,temp:_,N:a,forward:!1,splitNormalization:!0});const xe=e.createCommandEncoder({label:`Copy from vec4 work ${E}`});xe.copyBufferToBuffer(Z,0,u,Q,R),e.queue.submit([xe.finish()])}const M=e.createCommandEncoder({label:`Update ${x.iteration}`}),S=M.beginComputePass({label:"Update pass"});S.setPipeline(t.update),S.setBindGroup(0,fe[x.solutionIndex]),S.dispatchWorkgroups(J,J,1),S.end(),e.queue.submit([M.finish()]),x.solutionIndex=1-x.solutionIndex,x.iteration++}function ge(){const m=e.createCommandEncoder({label:"Render"}),v=m.beginRenderPass({colorAttachments:[{view:n.getCurrentTexture().createView(),loadOp:"clear",storeOp:"store",clearValue:{r:0,g:0,b:0,a:1}}]});v.setPipeline(t.visualize),v.setBindGroup(0,le[x.solutionIndex]),v.draw(3,1,0,0),v.end(),e.queue.submit([m.finish()])}let de;async function he(){const m=a,v=a,A=Math.ceil(m*4/256)*256,k=e.createTexture({size:[m,v],format:H,usage:re.RENDER_ATTACHMENT|re.COPY_SRC}),M=e.createBuffer({size:A*v,usage:ue.MAP_READ|ue.COPY_DST}),S=new Float32Array(10),E=new Uint32Array(S.buffer);E[0]=m,E[1]=v,S[2]=p,S[3]=g,S[4]=O,S[5]=h,E[6]=T?1:0,S[8]=m,S[9]=v,e.queue.writeBuffer(F,0,S);const $=new Float32Array([m/2,0,0,0,0,v/2,0,0,0,0,1,0,m/2,v/2,0,1]);e.queue.writeBuffer(z,0,$);const se=e.createCommandEncoder({label:"Download render"}),U=se.beginRenderPass({colorAttachments:[{view:k.createView(),loadOp:"clear",storeOp:"store",clearValue:{r:0,g:0,b:0,a:1}}]});U.setPipeline(t.visualize),U.setBindGroup(0,le[x.solutionIndex]),U.draw(3,1,0,0),U.end(),se.copyTextureToBuffer({texture:k},{buffer:M,bytesPerRow:A},[m,v]),e.queue.submit([se.finish()]),await M.mapAsync(ne.READ);const D=new Uint8Array(M.getMappedRange()),L=document.createElement("canvas");L.width=m,L.height=v;const j=L.getContext("2d"),R=j.createImageData(m,v);for(let ee=0;ee<v;ee++)for(let ae=0;ae<m;ae++){const N=ee*A+ae*4,Y=(ee*m+ae)*4;H==="bgra8unorm"?(R.data[Y+0]=D[N+2],R.data[Y+1]=D[N+1],R.data[Y+2]=D[N+0],R.data[Y+3]=255):(R.data[Y+0]=D[N+0],R.data[Y+1]=D[N+1],R.data[Y+2]=D[N+2],R.data[Y+3]=255)}j.putImageData(R,0,0),M.unmap(),M.destroy(),k.destroy(),e.queue.writeBuffer(z,0,G.viewInverse),x.dirty=!0;const Q=document.createElement("a");Q.download=`turing-pattern-${a}x${a}-${Date.now()}.png`,Q.href=L.toDataURL("image/png"),Q.click()}const ce=document.querySelector("#turing-download-btn");ce&&(ce._download=he);function pe(){if(be(),te){for(let m=0;m<oe;m++)ye();x.dirty=!0}x.dirty&&(ge(),x.dirty=!1),V.textContent=`Grid: ${a}×${a} | Scales: ${i} | Iteration: ${x.iteration}`,de=requestAnimationFrame(pe)}return pe(),ve.then(()=>{cancelAnimationFrame(de)}),{workgroups:J,extractParams:me,visualizeBindGroups:le,updateBindGroups:fe,updateParams:be,simulationStep:ye,render:ge,animationId:de,downloadPNG:he,downloadBtnEl:ce,animate:pe}},inputs:["device","ctx","canvas","N","numScales","pipelines","solution","fhat","fhatFreq","fftTemp","activatorInhibitor","extractParamsBuffer","convolveParamsBuffer","updateParamsBuffer","scaleParamsBuffer","visualizeParamsBuffer","viewInverseBuffer","scaleParams","axes","simState","statusEl","symmetryState","stepSize","colorRate","stepsPerFrame","simulate","contrast","brightness","gamma","colorStrength","invert","executeFFT2D","bytesPerFloat","vec4FftWork","executeVec4FFT2D","vec4FftPipelines","vec4FftTemp","canvasFormat","GPUTextureUsage","GPUBufferUsage","GPUMapMode","invalidation"],outputs:["workgroups","extractParams","visualizeBindGroups","updateBindGroups","updateParams","simulationStep","render","animationId","downloadPNG","downloadBtnEl","animate"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-36"),expanded:[],variables:[]},{id:36,body:(e,n)=>e`## Algorithm

Multiscale Turing patterns are a reaction-diffusion system where multiple scales of activator-inhibitor dynamics compete. At each point:

1. Convolve the field with Gaussian or circular kernels at different radii to compute activator and inhibitor values
2. Find the scale with minimum variation (smallest |activator - inhibitor|)
3. Step the field in the direction indicated by that scale (positive if activator > inhibitor)
4. Mix the color toward the dominant scale's color

### Implementation

This implementation uses several techniques to maximize throughput on the GPU:

**Packed FFTs**: We compute four real-valued FFTs in a single pass by packing data into complex pairs. The real solution field ${n`u`} is stored as a vec4 treating it as two identical complex numbers:

${n.block`(u + 0i,\; u + 0i)`}

Similarly, four convolution kernels (two activator-inhibitor pairs for scales ${n`n`} and ${n`n+1`}) are packed into two complex numbers:

${n.block`(\hat{A}_n + i\hat{I}_n,\; \hat{A}_{n+1} + i\hat{I}_{n+1})`}

where ${n`\hat{A}`} and ${n`\hat{I}`} are the frequency-domain activator and inhibitor kernels. After a single forward FFT, we multiply by two sets of frequency-domain kernels and perform one inverse FFT to recover all four convolved outputs.

**Analytical frequency-domain kernels**: Rather than storing precomputed kernel textures, we evaluate kernels analytically in the shader. The Fourier transform of a Gaussian with standard deviation ${n`\sigma`} is another Gaussian:

${n.block`\mathcal{F}\left[e^{-x^2/2\sigma^2}\right] = e^{-2\pi^2\sigma^2 f^2}`}

The Fourier transform of a circular disc of radius ${n`R`} is a Bessel function of the first kind:

${n.block`\mathcal{F}\left[\Pi(r/R)\right] = \frac{J_1(2\pi R f)}{\pi R f}`}

This eliminates kernel memory bandwidth entirely and allows arbitrary kernel parameters without regenerating textures.

**Float16 precision**: All computation uses 16-bit floating point for storage buffers, halving memory bandwidth compared to float32. The reduced precision is sufficient for the visual nature of the simulation while enabling larger grid sizes and faster execution.`,inputs:["md","tex"],outputs:[],output:void 0,assets:void 0,autodisplay:!0,autoview:!1,automutable:void 0});
