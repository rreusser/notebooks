async function h(r){const t=r.createShaderModule({label:"FFT Stockham shader",code:await fetch("./shaders/fft_stockham.wgsl").then(i=>i.text())}),o=r.createShaderModule({label:"Transpose shader",code:await fetch("./shaders/transpose.wgsl").then(i=>i.text())}),p=r.createBindGroupLayout({label:"FFT bind group layout",entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}}]}),l=r.createBindGroupLayout({label:"Transpose bind group layout",entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}}]}),n=r.createPipelineLayout({label:"FFT pipeline layout",bindGroupLayouts:[p]}),a=r.createPipelineLayout({label:"Transpose pipeline layout",bindGroupLayouts:[l]}),d=r.createComputePipeline({label:"FFT horizontal pipeline",layout:n,compute:{module:t,entryPoint:"fft_horizontal"}}),b=r.createComputePipeline({label:"FFT vertical pipeline",layout:n,compute:{module:t,entryPoint:"fft_vertical"}}),s=r.createComputePipeline({label:"Transpose pipeline",layout:a,compute:{module:o,entryPoint:"transpose"}});return{fftHorizontal:d,fftVertical:b,transpose:s,bindGroupLayouts:{fft:p,transpose:l}}}function G(r){const{device:t,pipelines:o,input:p,output:l,temp:n,N:a,forward:d,splitNormalization:b}=r,s=t.createBuffer({label:"FFT params uniform",size:16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),i=new Uint32Array([a,a,d?1:0,b?1:0]);t.queue.writeBuffer(s,0,i);const f=t.createBuffer({label:"Transpose params uniform",size:16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),c=new Uint32Array([a]);t.queue.writeBuffer(f,0,c);const g=t.createBindGroup({label:"FFT horizontal bind group",layout:o.bindGroupLayouts.fft,entries:[{binding:0,resource:{buffer:p}},{binding:1,resource:{buffer:n[0]}},{binding:2,resource:{buffer:s}}]}),y=t.createBindGroup({label:"Transpose 1 bind group",layout:o.bindGroupLayouts.transpose,entries:[{binding:0,resource:{buffer:n[0]}},{binding:1,resource:{buffer:n[1]}},{binding:2,resource:{buffer:f}}]}),P=t.createBindGroup({label:"FFT vertical bind group",layout:o.bindGroupLayouts.fft,entries:[{binding:0,resource:{buffer:n[1]}},{binding:1,resource:{buffer:n[0]}},{binding:2,resource:{buffer:s}}]}),m=t.createBindGroup({label:"Transpose 2 bind group",layout:o.bindGroupLayouts.transpose,entries:[{binding:0,resource:{buffer:n[0]}},{binding:1,resource:{buffer:l}},{binding:2,resource:{buffer:f}}]}),u=t.createCommandEncoder({label:"FFT 2D command encoder"});{const e=u.beginComputePass({label:"FFT horizontal pass"});e.setPipeline(o.fftHorizontal),e.setBindGroup(0,g),e.dispatchWorkgroups(a,1,1),e.end()}{const e=u.beginComputePass({label:"Transpose 1 pass"});e.setPipeline(o.transpose),e.setBindGroup(0,y),e.dispatchWorkgroups(Math.ceil(a/16),Math.ceil(a/16),1),e.end()}{const e=u.beginComputePass({label:"FFT vertical pass"});e.setPipeline(o.fftVertical),e.setBindGroup(0,P),e.dispatchWorkgroups(a,1,1),e.end()}{const e=u.beginComputePass({label:"Transpose 2 pass"});e.setPipeline(o.transpose),e.setBindGroup(0,m),e.dispatchWorkgroups(Math.ceil(a/16),Math.ceil(a/16),1),e.end()}t.queue.submit([u.finish()]),s.destroy(),f.destroy()}export{h as c,G as e};
