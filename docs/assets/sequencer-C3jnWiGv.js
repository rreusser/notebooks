function C(e){return e<.5?4*e*e*e:.5*Math.pow(2*e-2,3)+1}function I(e){return e}function o(e,n,r){return(1-r)*e+r*n}function P(e,n,r,s){return e[0]=o(n[0],r[0],s),e[1]=o(n[1],r[1],s),e[2]=o(n[2],r[2],s),e}function j(e,n,r,s){return e[0]=o(n[0],r[0],s),e[1]=o(n[1],r[1],s),e[2]=o(n[2],r[2],s),e[3]=o(n[3],r[3],s),e}function q(e,n,r){if(typeof e=="number")return o(e,n,r);if(Array.isArray(e))switch(e.length){case 2:return[o(e[0],n[0],r),o(e[1],n[1],r)];case 3:return P([],e,n,r);case 4:return j([],e,n,r);default:return e.map((s,a)=>o(s,n[a],r))}return e}function L(e,n){const r=Object.keys(e),s={},a={};let d=0;function k(t){let f=!1;for(let u=0;u<r.length;u++){const h=r[u],c=e[h],p=Array.isArray(c)?c:c.steps,y=c.interpolate||q;a[h]=!1;let i=p[0],l=p[0];for(let A=0;A<p.length&&(l=p[A],!(t<l.t));A++)i=l;let g;if(i===l||t<=i.t)g=i.value;else if(t>=l.t)g=l.value;else{const A=l.ease||C,w=(t-i.t)/(l.t-i.t);g=y(i.value,l.value,A(w))}m(g,s[h])||(a[h]=!0,f=!0,s[h]=g)}return f}function m(t,f){if(t===f)return!0;if(typeof t!=typeof f)return!1;if(Array.isArray(t)&&Array.isArray(f)){if(t.length!==f.length)return!1;for(let u=0;u<t.length;u++)if(t[u]!==f[u])return!1;return!0}return!1}return k(0),{setPosition(t){return d=t,k(t)&&n&&n(s,a),this},getPosition(){return d},getState(){return s},getChanged(){return a},addKeyframe(t,f,u,h={}){e[t]||(e[t]=[],r.push(t));const c=Array.isArray(e[t])?e[t]:e[t].steps,p={t:f,value:u,...h};let y=!1;for(let i=0;i<c.length;i++)if(c[i].t===f){c[i]=p,y=!0;break}else if(c[i].t>f){c.splice(i,0,p),y=!0;break}return y||c.push(p),k(d),this}}}export{L as createSequencer,I as linear};
