const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pipeline-C4F5G6Rp.js","assets/fft-Chkx7JT6.js"])))=>i.map(i=>d[i]);
import{d as c,_ as ie}from"./index-ByB2dbry.js";c({root:document.getElementById("cell-2"),expanded:[],variables:[]},{id:2,body:(e,t)=>{navigator.gpu||e(t`<div style="color: red; padding: 20px; border: 1px solid red; background: #fff0f0; border-radius: 4px;">
    <strong>WebGPU is not available</strong><br>
    Please use a browser that supports WebGPU (Chrome 113+, Edge 113+, or Firefox with flags enabled).
  </div>`)},inputs:["display","html"],outputs:[],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-3"),expanded:[],variables:[]},{id:3,body:async()=>{const[{createWebGPUContext:e,isWebGPUAvailable:t},{createTuringPipelines:s},{executeFFT2D:n,createVec4FFTPipelines:i,executeVec4FFT2D:o},{createElementStack:a},{createZoomableAxes:u},{expandable:p}]=await Promise.all([ie(()=>import("./webgpu-context-DeTOoImp.js"),[]).then(r=>{if(!("createWebGPUContext"in r))throw new SyntaxError("export 'createWebGPUContext' not found");if(!("isWebGPUAvailable"in r))throw new SyntaxError("export 'isWebGPUAvailable' not found");return r}),ie(()=>import("./pipeline-C4F5G6Rp.js"),__vite__mapDeps([0,1])).then(r=>{if(!("createTuringPipelines"in r))throw new SyntaxError("export 'createTuringPipelines' not found");return r}),ie(()=>import("./fft-Chkx7JT6.js"),[]).then(r=>{if(!("executeFFT2D"in r))throw new SyntaxError("export 'executeFFT2D' not found");if(!("createVec4FFTPipelines"in r))throw new SyntaxError("export 'createVec4FFTPipelines' not found");if(!("executeVec4FFT2D"in r))throw new SyntaxError("export 'executeVec4FFT2D' not found");return r}),ie(()=>import("./element-stack-BU40TvN2.js"),[]).then(r=>{if(!("createElementStack"in r))throw new SyntaxError("export 'createElementStack' not found");return r}),ie(()=>import("./zoomable-axes-BfGyq1bg.js"),[]).then(r=>{if(!("createZoomableAxes"in r))throw new SyntaxError("export 'createZoomableAxes' not found");return r}),ie(()=>import("./expandable-dZkDG0zz.js"),[]).then(r=>{if(!("expandable"in r))throw new SyntaxError("export 'expandable' not found");return r})]);return{createWebGPUContext:e,isWebGPUAvailable:t,createTuringPipelines:s,executeFFT2D:n,createVec4FFTPipelines:i,executeVec4FFT2D:o,createElementStack:a,createZoomableAxes:u,expandable:p}},inputs:[],outputs:["createWebGPUContext","isWebGPUAvailable","createTuringPipelines","executeFFT2D","createVec4FFTPipelines","executeVec4FFT2D","createElementStack","createZoomableAxes","expandable"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-4"),expanded:[],variables:[]},{id:4,body:async(e,t)=>{const s=await e(),n=s.device,i=s.precision,o=navigator.gpu.getPreferredCanvasFormat();return t.then(()=>n.destroy()),{context:s,device:n,detectedPrecision:i,canvasFormat:o}},inputs:["createWebGPUContext","invalidation"],outputs:["context","device","detectedPrecision","canvasFormat"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-5"),expanded:[],variables:[]},{id:5,body:(e,t,s)=>{const n=e==="f16"?["f16","f32"]:["f32"],i=t.radio(n,{label:"Precision",value:e}),o=s(i);return{precisionOptions:n,precisionInput:i,precisionValue:o}},inputs:["detectedPrecision","Inputs","view"],outputs:["precisionOptions","precisionInput","precisionValue"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-6"),expanded:[],variables:[]},{id:6,body:(e,t)=>{const s=e??t;return{precision:s,bytesPerFloat:s==="f16"?2:4}},inputs:["precisionValue","detectedPrecision"],outputs:["precision","bytesPerFloat"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-7"),expanded:[],variables:[]},{id:7,body:e=>({N:parseInt(e.split("×")[0])}),inputs:["NString"],outputs:["N"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-8"),expanded:[],variables:[]},{id:8,body:()=>({gridSizeState:{N:512}}),inputs:[],outputs:["gridSizeState"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-9"),expanded:[],variables:[]},{id:9,body:()=>({expandableState:{expanded:!1}}),inputs:[],outputs:["expandableState"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-10"),expanded:[],variables:[]},{id:10,body:(e,t)=>{t.N=e},inputs:["N","gridSizeState"],outputs:[],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-11"),expanded:[],variables:[]},{id:11,body:(e,t,s,n)=>{const i=e.range([1,8],{value:4,step:1,label:"Number of scales"}),o=t(i);return s(n`<div id="turing-num-scales">${i}</div>`),{numScalesInput:i,numScalesValue:o}},inputs:["Inputs","view","display","html"],outputs:["numScalesInput","numScalesValue"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-12"),expanded:[],variables:[]},{id:12,body:e=>({numScales:Math.round(e??1)}),inputs:["numScalesValue"],outputs:["numScales"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-13"),expanded:[],variables:[]},{id:13,body:(e,t,s,n,i)=>{function o(d,b,v){const B=Math.floor(d*6),V=d*6-B,I=v*(1-b),O=v*(1-V*b),x=v*(1-(1-V)*b),_=B%6,C=[v,O,I,I,x,v][_],Z=[x,v,v,O,I,I][_],K=[I,I,x,v,v,O][_];return[C,Z,K]}function a(){return o(Math.random(),Math.random(),1)}const u=Array.from({length:10},a);function p(d,b,v=[]){const B=document.createElement("div");B.className="scale-params-container symmetry-hidden";const V=document.createElement("style");V.textContent=`
    .scale-params-container .label-full { display: inline; }
    .scale-params-container .label-short { display: none; }
    .expandable-expanded .scale-params-container .label-full { display: none; }
    .expandable-expanded .scale-params-container .label-short { display: inline; }
    .expandable-expanded .scale-params-container .input-activator { width: 40px !important; }
    .expandable-expanded .scale-params-container .input-inhibitor-ratio { width: 40px !important; }
    .expandable-expanded .scale-params-container .input-symmetry { width: 32px !important; }
    .scale-params-container.symmetry-hidden .symmetry-col { display: none; }
  `,B.appendChild(V);const I=document.createElement("table");I.style.cssText="border-collapse: collapse; width: 100%; font-size: 11px; margin: 4px 0;";const O=document.createElement("thead");O.innerHTML=`
    <tr style="text-align: left;">
      <th style="padding: 2px 4px;"><span class="label-short">A</span><span class="label-full">Activator</span></th>
      <th style="padding: 2px 4px;"><span class="label-short">I/A</span><span class="label-full">Inh/Act</span></th>
      <th style="padding: 2px 4px;"><span class="label-short">K</span><span class="label-full">Kernel</span></th>
      <th style="padding: 2px 4px;"><span class="label-short">Δ</span><span class="label-full">Amount</span></th>
      <th style="padding: 2px 4px;"><span class="label-short">W</span><span class="label-full">Weight</span></th>
      <th class="symmetry-col" style="padding: 2px 4px;"><span class="label-short">S</span><span class="label-full">Symmetry</span></th>
      <th style="padding: 2px 4px;"></th>
    </tr>
  `,I.appendChild(O);const x=document.createElement("tbody"),_=[];function C(){B.value=_.map(m=>({activatorRadius:parseFloat(m.activator.value)||2,inhibitorRatio:parseFloat(m.inhibitorRatio.value)||2,kernelType:m.kernel.value==="circular"?1:0,amount:parseFloat(m.amount.value)||.05,weight:parseFloat(m.weight.value)||1,symmetry:parseInt(m.symmetry.value)||1,color:Z(m.color.value)})),B.dispatchEvent(new CustomEvent("input"))}function Z(m){const h=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(m);return h?[parseInt(h[1],16)/255,parseInt(h[2],16)/255,parseInt(h[3],16)/255]:[.5,.5,.5]}function K(m){const h=Math.round(m[0]*255),g=Math.round(m[1]*255),q=Math.round(m[2]*255);return"#"+[h,g,q].map(F=>F.toString(16).padStart(2,"0")).join("")}function oe(m){const g=t.N/8,q=d>1?m/(d-1):0,F=3*Math.pow(g/3,q),T=.7+Math.random()*.6;return Math.round(F*T)}function ne(m){const h=[1,1,2,3,4,6,8];return{activatorRadius:oe(m),inhibitorRatio:(1.5+Math.random()*2.5).toFixed(1),kernelType:Math.random()>.5?1:0,amount:(.003+.1*Math.pow(Math.random(),2)).toFixed(3),weight:(.1+Math.random()*.9).toFixed(2),symmetry:h[Math.floor(Math.random()*h.length)],color:a()}}for(let m=0;m<d;m++){const g=v[m]||ne(m),q=document.createElement("tr"),F=document.createElement("input");F.type="number",F.className="input-activator",F.value=g.activatorRadius,F.min=1,F.max=200,F.step=1,F.style.cssText="width: 50px; padding: 2px;",F.oninput=C;const T=document.createElement("input");T.type="number",T.className="input-inhibitor-ratio",T.value=g.inhibitorRatio,T.min=1,T.max=10,T.step=.1,T.style.cssText="width: 50px; padding: 2px;",T.oninput=C;const S=document.createElement("button");S.type="button",S.value=g.kernelType===1?"circular":"gaussian",S.style.cssText=`
      width: 24px; height: 22px; padding: 0; border: 1px solid #ccc;
      border-radius: 4px; background: #fff; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
    `;const j=document.createElement("div");j.style.cssText=`
      width: 12px; height: 12px; border-radius: 50%; background: #333;
      filter: ${S.value==="gaussian"?"blur(3px)":"none"};
      transition: filter 0.15s ease;
    `,S.appendChild(j),S._dot=j,S.title=S.value==="gaussian"?"Gaussian (click for circular)":"Circular (click for gaussian)",S.onclick=()=>{S.value=S.value==="gaussian"?"circular":"gaussian",j.style.filter=S.value==="gaussian"?"blur(3px)":"none",S.title=S.value==="gaussian"?"Gaussian (click for circular)":"Circular (click for gaussian)",C()};const w=document.createElement("input");w.type="number",w.value=g.amount,w.min=.001,w.max=1,w.step=.001,w.style.cssText="width: 55px; padding: 2px;",w.oninput=C;const W=document.createElement("input");W.type="number",W.value=g.weight,W.min=0,W.max=1,W.step=.01,W.style.cssText="width: 50px; padding: 2px;",W.oninput=C;const A=document.createElement("input");A.type="number",A.className="input-symmetry",A.value=g.symmetry??1,A.min=1,A.max=8,A.step=1,A.style.cssText="width: 40px; padding: 2px;",A.oninput=C;const X=document.createElement("input");X.type="color",X.value=K(g.color),X.style.cssText="width: 36px; height: 22px; padding: 0; border: 1px solid #ccc;",X.oninput=C,[F,T,S,w,W,A,X].forEach((re,ue)=>{const J=document.createElement("td");J.style.padding="1px 2px",ue===5&&(J.className="symmetry-col"),J.appendChild(re),q.appendChild(J)}),x.appendChild(q),_.push({activator:F,inhibitorRatio:T,kernel:S,amount:w,weight:W,symmetry:A,color:X})}return I.appendChild(x),B.appendChild(I),B.randomize=()=>{for(let m=0;m<_.length;m++){const h=_[m],g=ne(m);h.activator.value=g.activatorRadius,h.inhibitorRatio.value=g.inhibitorRatio,h.kernel.value=g.kernelType===1?"circular":"gaussian",h.kernel._dot.style.filter=g.kernelType===1?"none":"blur(3px)",h.amount.value=g.amount,h.weight.value=g.weight,h.symmetry.value=g.symmetry,h.color.value=K(g.color)}C()},C(),B}const r=[],l=p(e,t.N,r),f=s(l);return n(i`<div id="turing-scale-params">${l}</div>`),{hsvToRgb:o,randomColor:a,defaultColors:u,createScaleParamsInput:p,existingScaleParams:r,scaleParamsInput:l,scaleParamsValue:f}},inputs:["numScales","gridSizeState","view","display","html"],outputs:["hsvToRgb","randomColor","defaultColors","createScaleParamsInput","existingScaleParams","scaleParamsInput","scaleParamsValue"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-14"),expanded:[],variables:[]},{id:14,body:e=>({scaleParams:e??[{activatorRadius:2,inhibitorRatio:2,kernelType:0,amount:.05,weight:1,symmetry:1,color:[.33,.53,.8]}]}),inputs:["scaleParamsValue"],outputs:["scaleParams"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-15"),expanded:[],variables:[]},{id:15,body:(e,t,s,n,i)=>{const o=document.createElement("button");o.textContent="Randomize",o.style.cssText="padding: 4px 8px; cursor: pointer; font-size: 12px;",o.onclick=()=>{const p=document.querySelector("#turing-scale-params .scale-params-container");p?.randomize&&p.randomize()};const a=document.createElement("button");return a.id="turing-download-btn",a.textContent="Download PNG",a.style.cssText="padding: 4px 8px; cursor: pointer; font-size: 12px;",a.onclick=()=>{a._download&&a._download()},e.style.cssText="padding: 4px 8px; cursor: pointer; font-size: 12px;",t(s`<div id="turing-button-row" style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
  ${o}
  ${e}
  ${a}
  ${n}
  ${i}
</div>`),{randomizeBtn:o,downloadBtn:a,downloadButton:a}},inputs:["restartButton","display","html","simulateInput","symmetryInput"],outputs:["randomizeBtn","downloadBtn","downloadButton"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-16"),expanded:[],variables:[]},{id:16,body:e=>{const t=document.querySelector("#turing-scale-params .scale-params-container");return t&&t.classList.toggle("symmetry-hidden",!e),{container:t}},inputs:["symmetryEnabled"],outputs:["container"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-17"),expanded:[],variables:[]},{id:17,body:(e,t,s,n,i,o,a,u,p,r)=>{const l=s`<figure style="margin: 0;">${e.element}</figure>`;return n(i(l,{width:Math.min(o,640),height:Math.min(o,640),toggleOffset:[-15,-16],controls:["#turing-num-scales","#turing-scale-params","#turing-button-row","#turing-sim-controls","#turing-display-controls"],state:a,onResize(f,d,b){e.resize(d,b),t.updateScales(u.scaleLinear().domain([0,p.N]).range([0,d]),u.scaleLinear().domain([0,p.N]).range([b,0])),r.dirty=!0}})),{figure:l}},inputs:["stack","axes","html","display","expandable","width","expandableState","d3","gridSizeState","simState"],outputs:["figure"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-18"),expanded:[],variables:[]},{id:18,body:(e,t)=>{const s=e`<div id="turing-status" style="font-family: monospace; font-size: 12px; color: #666;">Initializing...</div>`;return t(s),{statusEl:s}},inputs:["html","display"],outputs:["statusEl"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-19"),expanded:[],variables:[]},{id:19,body:(e,t,s)=>{const n=e.limits.maxComputeWorkgroupSizeX,i=[256,512,1024,2048,4096],o=i.filter(l=>{if(l<=n)return!0;const d=l/n;return Number.isInteger(d)&&(d&d-1)===0}),a=o.map(l=>`${l}×${l}`),u=512,p=t.select(a,{value:`${u}×${u}`,label:"Grid size"}),r=s(p);return{maxWorkgroupSize:n,allSizes:i,validSizes:o,gridSizeOptions:a,defaultN:u,NInput:p,NString:r}},inputs:["device","Inputs","view"],outputs:["maxWorkgroupSize","allSizes","validSizes","gridSizeOptions","defaultN","NInput","NString"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-20"),expanded:[],variables:[]},{id:20,body:e=>{const t=document.createElement("label");t.style.cssText="display: flex; align-items: center; gap: 4px; cursor: pointer; font-size: 12px;";const s=document.createElement("input");s.type="checkbox",s.checked=!0,t.appendChild(s),t.appendChild(document.createTextNode("Simulate")),t.value=!0,s.onchange=()=>{t.value=s.checked,t.dispatchEvent(new CustomEvent("input"))};const n=e(t),i=document.createElement("label");i.style.cssText="display: flex; align-items: center; gap: 4px; cursor: pointer; font-size: 12px;";const o=document.createElement("input");o.type="checkbox",o.checked=!1,i.appendChild(o),i.appendChild(document.createTextNode("Symmetry")),i.value=!1,o.onchange=()=>{i.value=o.checked,i.dispatchEvent(new CustomEvent("input"))};const a=e(i);return{simulateContainer:t,simulateCheckbox:s,simulateValue:n,symmetryContainer:i,symmetryCheckbox:o,symmetryEnabledValue:a,simulateInput:t,symmetryInput:i}},inputs:["view"],outputs:["simulateContainer","simulateCheckbox","simulateValue","symmetryContainer","symmetryCheckbox","symmetryEnabledValue","simulateInput","symmetryInput"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-21"),expanded:[],variables:[]},{id:21,body:()=>({symmetryState:{enabled:!1}}),inputs:[],outputs:["symmetryState"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-22"),expanded:[],variables:[]},{id:22,body:(e,t,s)=>{const n=e??!0,i=t??!1;return s.enabled=i,{simulate:n,symmetryEnabled:i}},inputs:["simulateValue","symmetryEnabledValue","symmetryState"],outputs:["simulate","symmetryEnabled"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-23"),expanded:[],variables:[]},{id:23,body:(e,t)=>{t.dirty=!0},inputs:["symmetryEnabled","simState"],outputs:[],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-24"),expanded:[],variables:[]},{id:24,body:(e,t,s,n,i,o)=>{const a=document.createElement("button");a.textContent="Restart",a.style.cssText="padding: 4px 12px; cursor: pointer; font-size: 12px;";let u=0;a.value=u,a.onclick=()=>{a.value=++u,a.dispatchEvent(new CustomEvent("input"))};const p=e(a),r=t.range([.01,1],{value:.2,step:.01,label:"Step size"}),l=e(r),f=t.range([.001,.1],{value:.02,step:.001,label:"Color rate"}),d=e(f),b=t.range([1,20],{value:4,step:1,label:"Steps per frame"}),v=e(b);return s(n`<div id="turing-sim-controls">
  <details class="sim-config-details" open>
    <summary style="cursor: pointer; font-size: 12px;">Simulation config</summary>
    <div style="padding-left: 8px;">
      <div id="turing-grid-size">${i}</div>
      <div id="turing-precision">${o}</div>
      ${r}
      ${f}
      ${b}
    </div>
  </details>
</div>`),{restartBtn:a,restartCount:u,restart:p,stepSizeInput:r,stepSizeValue:l,colorRateInput:f,colorRateValue:d,stepsPerFrameInput:b,stepsPerFrameValue:v,restartButton:a}},inputs:["view","Inputs","display","html","NInput","precisionInput"],outputs:["restartBtn","restartCount","restart","stepSizeInput","stepSizeValue","colorRateInput","colorRateValue","stepsPerFrameInput","stepsPerFrameValue","restartButton"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-25"),expanded:[],variables:[]},{id:25,body:(e,t,s)=>{const n=e??.02,i=t??.01,o=Math.round(s??5);return{stepSize:n,colorRate:i,stepsPerFrame:o}},inputs:["stepSizeValue","colorRateValue","stepsPerFrameValue"],outputs:["stepSize","colorRate","stepsPerFrame"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-26"),expanded:[],variables:[]},{id:26,body:(e,t,s,n)=>{const i=e.range([0,.99],{value:.7,step:.01,label:"Contrast"}),o=t(i),a=e.range([-2,2],{value:-1,step:.1,label:"Brightness"}),u=t(a),p=e.range([.2,3],{value:1,step:.1,label:"Gamma"}),r=t(p),l=e.range([0,1],{value:1,step:.1,label:"Color strength"}),f=t(l),d=e.toggle({label:"Invert",value:!1}),b=t(d);return s(n`<div id="turing-display-controls">
  <details class="display-config-details">
    <summary style="cursor: pointer; font-size: 12px; margin-bottom: 8px;">Display config</summary>
    <div style="padding-left: 8px;">
      ${i}
      ${a}
      ${p}
      ${l}
      ${d}
    </div>
  </details>
</div>`),{contrastInput:i,contrastValue:o,brightnessInput:a,brightnessValue:u,gammaInput:p,gammaValue:r,colorStrengthInput:l,colorStrengthValue:f,invertInput:d,invertValue:b}},inputs:["Inputs","view","display","html"],outputs:["contrastInput","contrastValue","brightnessInput","brightnessValue","gammaInput","gammaValue","colorStrengthInput","colorStrengthValue","invertInput","invertValue"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-27"),expanded:[],variables:[]},{id:27,body:(e,t,s,n,i)=>({contrast:e??.5,brightness:t??0,gamma:s??1,colorStrength:n??.5,invert:i??!1}),inputs:["contrastValue","brightnessValue","gammaValue","colorStrengthValue","invertValue"],outputs:["contrast","brightness","gamma","colorStrength","invert"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-28"),expanded:[],variables:[]},{id:28,body:(e,t,s,n,i,o,a,u,p)=>{const r=e*e*4*i,l=e*e*2*i,f=a.STORAGE|a.COPY_SRC|a.COPY_DST;let d=0;const b=[u.createBuffer({label:"Solution 0",size:r,usage:f}),u.createBuffer({label:"Solution 1",size:r,usage:f})];d+=r*2;const v=u.createBuffer({label:"fhat",size:l,usage:f}),B=u.createBuffer({label:"fhat_freq",size:l,usage:f});d+=l*2;const V=[u.createBuffer({label:"FFT temp 0",size:l,usage:f}),u.createBuffer({label:"FFT temp 1",size:l,usage:f})];d+=l*2;const I=e*e*4*i,O=u.createBuffer({label:"Vec4 FFT work",size:I,usage:f|a.COPY_DST|a.COPY_SRC}),x=[u.createBuffer({label:"Vec4 FFT temp 0",size:I,usage:f}),u.createBuffer({label:"Vec4 FFT temp 1",size:I,usage:f})];d+=I*3;const _=p(u,e,u.limits.maxComputeWorkgroupSizeX,o),C=Math.ceil(t/2),Z=C*e*e*4*i,K=u.createBuffer({label:"Activator/Inhibitor",size:Z,usage:f});d+=Z;const oe=u.createBuffer({label:"Init params",size:16,usage:a.UNIFORM|a.COPY_DST}),ne=u.createBuffer({label:"Extract params",size:16,usage:a.UNIFORM|a.COPY_DST}),m=u.createBuffer({label:"Convolve params",size:48,usage:a.UNIFORM|a.COPY_DST}),h=u.createBuffer({label:"Update params",size:32,usage:a.UNIFORM|a.COPY_DST}),g=t*32,q=u.createBuffer({label:"Scale params",size:g,usage:a.STORAGE|a.COPY_DST});d+=g;const F=u.createBuffer({label:"Visualize params",size:40,usage:a.UNIFORM|a.COPY_DST});d+=40;const T=u.createBuffer({label:"View inverse",size:64,usage:a.UNIFORM|a.COPY_DST});d+=64,d+=112;const S=w=>w>=1024*1024*1024?(w/(1024*1024*1024)).toFixed(2)+" GB":w>=1024*1024?(w/(1024*1024)).toFixed(2)+" MB":w>=1024?(w/1024).toFixed(2)+" KB":w+" B",j={total:d,formatted:S(d),precision:o};return{solutionSize:r,complexSize:l,bufferUsage:f,totalGPUMemory:d,solution:b,fhat:v,fhatFreq:B,fftTemp:V,vec4Size:I,vec4FftWork:O,vec4FftTemp:x,vec4FftPipelines:_,numScalePairs:C,aiSize:Z,activatorInhibitor:K,initParamsBuffer:oe,extractParamsBuffer:ne,convolveParamsBuffer:m,updateParamsBuffer:h,scaleParamsSize:g,scaleParamsBuffer:q,visualizeParamsBuffer:F,viewInverseBuffer:T,formatBytes:S,memoryInfo:j}},inputs:["N","numScales","restart","scaleParams","bytesPerFloat","precision","GPUBufferUsage","device","createVec4FFTPipelines"],outputs:["solutionSize","complexSize","bufferUsage","totalGPUMemory","solution","fhat","fhatFreq","fftTemp","vec4Size","vec4FftWork","vec4FftTemp","vec4FftPipelines","numScalePairs","aiSize","activatorInhibitor","initParamsBuffer","extractParamsBuffer","convolveParamsBuffer","updateParamsBuffer","scaleParamsSize","scaleParamsBuffer","visualizeParamsBuffer","viewInverseBuffer","formatBytes","memoryInfo"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-29"),expanded:[],variables:[]},{id:29,body:async(e,t,s,n,i)=>({pipelines:await s(n,i,e,t)}),inputs:["N","precision","createTuringPipelines","device","canvasFormat"],outputs:["pipelines"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-30"),expanded:[],variables:[]},{id:30,body:(e,t,s,n,i,o,a)=>{const u=window.devicePixelRatio||1;function p(f,d){const b=Math.round(f*u),v=Math.round(d*u);(e.width!==b||e.height!==v)&&(e.width=b,e.height=v,t.configure({device:n,format:i,alphaMode:"opaque"})),e.style.width=`${f}px`,e.style.height=`${d}px`}const r=Math.min(o,640);p(r,r);const l=a({width:r,height:r,layers:[{id:"canvas",element:({current:f,width:d,height:b})=>(p(d,b),e)}]});return{dpr:u,resizeCanvas:p,initialSize:r,stack:l}},inputs:["canvas","ctx","N","device","canvasFormat","width","createElementStack"],outputs:["dpr","resizeCanvas","initialSize","stack"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-31"),expanded:[],variables:[]},{id:31,body:(e,t,s)=>{const n=document.createElement("canvas");n.id="turing-canvas";const i=n.getContext("webgpu");return n.width=1,n.height=1,i.configure({device:t,format:s,alphaMode:"opaque"}),{canvas:n,ctx:i}},inputs:["N","device","canvasFormat"],outputs:["canvas","ctx"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-32"),expanded:[],variables:[]},{id:32,body:(e,t,s,n,i,o)=>{const a=Math.floor(Math.random()*4294967295),u=new Uint32Array([e,e,a,0]);o.queue.writeBuffer(n,0,u);const p=o.createBindGroup({label:"Initialize bind group",layout:i.bindGroupLayouts.initialize,entries:[{binding:0,resource:{buffer:s[0]}},{binding:1,resource:{buffer:n}}]}),r=o.createCommandEncoder({label:"Initialize encoder"}),l=r.beginComputePass({label:"Initialize pass"});l.setPipeline(i.initialize),l.setBindGroup(0,p),l.dispatchWorkgroups(Math.ceil(e/16),Math.ceil(e/16),1),l.end(),o.queue.submit([r.finish()]);const f=o.createBindGroup({label:"Initialize bind group 2",layout:i.bindGroupLayouts.initialize,entries:[{binding:0,resource:{buffer:s[1]}},{binding:1,resource:{buffer:n}}]}),d=o.createCommandEncoder({label:"Initialize encoder 2"}),b=d.beginComputePass({label:"Initialize pass 2"});return b.setPipeline(i.initialize),b.setBindGroup(0,f),b.dispatchWorkgroups(Math.ceil(e/16),Math.ceil(e/16),1),b.end(),o.queue.submit([d.finish()]),{randomSeed:a,initParams:u,initBindGroup:p,initEncoder:r,initPass:l,init2BindGroup:f,init2Encoder:d,init2Pass:b}},inputs:["N","restart","solution","initParamsBuffer","pipelines","device"],outputs:["randomSeed","initParams","initBindGroup","initEncoder","initPass","init2BindGroup","init2Encoder","init2Pass"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-33"),expanded:[],variables:[]},{id:33,body:()=>({simState:{dirty:!0,solutionIndex:0,iteration:0}}),inputs:[],outputs:["simState"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-34"),expanded:[],variables:[]},{id:34,body:(e,t,s)=>{s.dirty=!0,s.solutionIndex=0,s.iteration=0},inputs:["restart","scaleParams","simState"],outputs:[],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-35"),expanded:[],variables:[]},{id:35,body:(e,t,s,n,i)=>{const o=s({d3:n,element:e.element,xScale:n.scaleLinear().domain([0,t]).range([0,e.width]),yScale:n.scaleLinear().domain([0,t]).range([e.height,0]),aspectRatio:1,onChange:()=>{i.dirty=!0}});return e.addEventListener("update",()=>{i.dirty=!0}),{axes:o}},inputs:["stack","N","createZoomableAxes","d3","simState"],outputs:["axes"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-36"),expanded:[],variables:[]},{id:36,body:(e,t,s,n,i,o,a,u,p,r,l,f,d,b,v,B,V,I,O,x,_,C,Z,K,oe,ne,m,h,g,q,F,T,S,j,w,W,A,X,re,ue,J,ve,we)=>{x.dirty=!0;const Q=Math.ceil(n/16),me=new Uint32Array([n,n,0,0]);e.queue.writeBuffer(f,0,me);const de=[e.createBindGroup({label:"Visualize bind group 0",layout:o.bindGroupLayouts.visualize,entries:[{binding:0,resource:{buffer:a[0]}},{binding:1,resource:{buffer:B}},{binding:2,resource:{buffer:V}}]}),e.createBindGroup({label:"Visualize bind group 1",layout:o.bindGroupLayouts.visualize,entries:[{binding:0,resource:{buffer:a[1]}},{binding:1,resource:{buffer:B}},{binding:2,resource:{buffer:V}}]})],fe=[e.createBindGroup({label:"Update bind group 0->1",layout:o.bindGroupLayouts.update,entries:[{binding:0,resource:{buffer:a[0]}},{binding:1,resource:{buffer:l}},{binding:2,resource:{buffer:a[1]}},{binding:3,resource:{buffer:b}},{binding:4,resource:{buffer:v}}]}),e.createBindGroup({label:"Update bind group 1->0",layout:o.bindGroupLayouts.update,entries:[{binding:0,resource:{buffer:a[1]}},{binding:1,resource:{buffer:l}},{binding:2,resource:{buffer:a[0]}},{binding:3,resource:{buffer:b}},{binding:4,resource:{buffer:v}}]})];function be(){const y=new Float32Array(i*8);for(let z=0;z<i;z++){const P=I[z],D=z*8;y[D+0]=P.weight,y[D+1]=P.amount,y[D+2]=C.enabled?P.symmetry:1,y[D+3]=0,y[D+4]=P.color[0],y[D+5]=P.color[1],y[D+6]=P.color[2],y[D+7]=0}e.queue.writeBuffer(v,0,y);const E=new Float32Array(8),M=new Uint32Array(E.buffer);M[0]=n,M[1]=n,M[2]=i,E[3]=Z,E[4]=K,e.queue.writeBuffer(b,0,E);const k=new Float32Array(10),$=new Uint32Array(k.buffer);$[0]=n,$[1]=n,k[2]=m,k[3]=h,k[4]=q,k[5]=g,$[6]=F?1:0,k[8]=n,k[9]=n,e.queue.writeBuffer(B,0,k),e.queue.writeBuffer(V,0,O.viewInverse)}function ye(){const y=e.createCommandEncoder({label:`Simulation step ${x.iteration}`}),E=e.createBindGroup({layout:o.bindGroupLayouts.extract,entries:[{binding:0,resource:{buffer:a[x.solutionIndex]}},{binding:1,resource:{buffer:u}},{binding:2,resource:{buffer:f}}]}),M=y.beginComputePass({label:"Extract pass"});M.setPipeline(o.extract),M.setBindGroup(0,E),M.dispatchWorkgroups(Q,Q,1),M.end(),e.queue.submit([y.finish()]),S({device:e,pipelines:o.fft,input:u,output:p,temp:r,N:n,forward:!0,splitNormalization:!0});const k=Math.ceil(i/2);for(let P=0;P<k;P++){const D=P*2,se=Math.min(P*2+1,i-1),U=I[D],G=I[se],L=new Float32Array(12),H=new Uint32Array(L.buffer);H[0]=n,H[1]=n,L[4]=U.activatorRadius,L[5]=U.activatorRadius*U.inhibitorRatio,L[6]=G.activatorRadius,L[7]=G.activatorRadius*G.inhibitorRatio,H[8]=U.kernelType,H[9]=U.kernelType,H[10]=G.kernelType,H[11]=G.kernelType,e.queue.writeBuffer(d,0,L);const R=n*n*4*j,ee=P*R,te=e.createCommandEncoder({label:`Convolve pair ${P}`}),ae=e.createBindGroup({layout:o.bindGroupLayouts.convolve,entries:[{binding:0,resource:{buffer:p}},{binding:1,resource:{buffer:l,offset:ee,size:R}},{binding:2,resource:{buffer:d}}]}),N=te.beginComputePass({label:`Convolve pass ${P}`});N.setPipeline(o.convolve),N.setBindGroup(0,ae),N.dispatchWorkgroups(Q,Q,1),N.end(),e.queue.submit([te.finish()]);const Y=e.createCommandEncoder({label:`Copy to vec4 work ${P}`});Y.copyBufferToBuffer(l,ee,w,0,R),e.queue.submit([Y.finish()]),W({device:e,pipelines:A,input:w,output:w,temp:X,N:n,forward:!1,splitNormalization:!0});const xe=e.createCommandEncoder({label:`Copy from vec4 work ${P}`});xe.copyBufferToBuffer(w,0,l,ee,R),e.queue.submit([xe.finish()])}const $=e.createCommandEncoder({label:`Update ${x.iteration}`}),z=$.beginComputePass({label:"Update pass"});z.setPipeline(o.update),z.setBindGroup(0,fe[x.solutionIndex]),z.dispatchWorkgroups(Q,Q,1),z.end(),e.queue.submit([$.finish()]),x.solutionIndex=1-x.solutionIndex,x.iteration++}function ge(){const y=e.createCommandEncoder({label:"Render"}),E=y.beginRenderPass({colorAttachments:[{view:t.getCurrentTexture().createView(),loadOp:"clear",storeOp:"store",clearValue:{r:0,g:0,b:0,a:1}}]});E.setPipeline(o.visualize),E.setBindGroup(0,de[x.solutionIndex]),E.draw(3,1,0,0),E.end(),e.queue.submit([y.finish()])}let le;async function he(){const y=n,E=n,M=Math.ceil(y*4/256)*256,k=e.createTexture({size:[y,E],format:re,usage:ue.RENDER_ATTACHMENT|ue.COPY_SRC}),$=e.createBuffer({size:M*E,usage:J.MAP_READ|J.COPY_DST}),z=new Float32Array(10),P=new Uint32Array(z.buffer);P[0]=y,P[1]=E,z[2]=m,z[3]=h,z[4]=q,z[5]=g,P[6]=F?1:0,z[8]=y,z[9]=E,e.queue.writeBuffer(B,0,z);const D=new Float32Array([y/2,0,0,0,0,E/2,0,0,0,0,1,0,y/2,E/2,0,1]);e.queue.writeBuffer(V,0,D);const se=e.createCommandEncoder({label:"Download render"}),U=se.beginRenderPass({colorAttachments:[{view:k.createView(),loadOp:"clear",storeOp:"store",clearValue:{r:0,g:0,b:0,a:1}}]});U.setPipeline(o.visualize),U.setBindGroup(0,de[x.solutionIndex]),U.draw(3,1,0,0),U.end(),se.copyTextureToBuffer({texture:k},{buffer:$,bytesPerRow:M},[y,E]),e.queue.submit([se.finish()]),await $.mapAsync(ve.READ);const G=new Uint8Array($.getMappedRange()),L=document.createElement("canvas");L.width=y,L.height=E;const H=L.getContext("2d"),R=H.createImageData(y,E);for(let te=0;te<E;te++)for(let ae=0;ae<y;ae++){const N=te*M+ae*4,Y=(te*y+ae)*4;re==="bgra8unorm"?(R.data[Y+0]=G[N+2],R.data[Y+1]=G[N+1],R.data[Y+2]=G[N+0],R.data[Y+3]=255):(R.data[Y+0]=G[N+0],R.data[Y+1]=G[N+1],R.data[Y+2]=G[N+2],R.data[Y+3]=255)}H.putImageData(R,0,0),$.unmap(),$.destroy(),k.destroy(),e.queue.writeBuffer(V,0,O.viewInverse),x.dirty=!0;const ee=document.createElement("a");ee.download=`turing-pattern-${n}x${n}-${Date.now()}.png`,ee.href=L.toDataURL("image/png"),ee.click()}const ce=document.querySelector("#turing-download-btn");ce&&(ce._download=he);function pe(){if(be(),ne){for(let y=0;y<oe;y++)ye();x.dirty=!0}x.dirty&&(ge(),x.dirty=!1),_.textContent=`Grid: ${n}×${n} | Scales: ${i} | ${T.precision} | Memory: ${T.formatted} | Iteration: ${x.iteration}`,le=requestAnimationFrame(pe)}return pe(),we.then(()=>{cancelAnimationFrame(le)}),{workgroups:Q,extractParams:me,visualizeBindGroups:de,updateBindGroups:fe,updateParams:be,simulationStep:ye,render:ge,animationId:le,downloadPNG:he,downloadBtnEl:ce,animate:pe}},inputs:["device","ctx","canvas","N","numScales","pipelines","solution","fhat","fhatFreq","fftTemp","activatorInhibitor","extractParamsBuffer","convolveParamsBuffer","updateParamsBuffer","scaleParamsBuffer","visualizeParamsBuffer","viewInverseBuffer","scaleParams","axes","simState","statusEl","symmetryState","stepSize","colorRate","stepsPerFrame","simulate","contrast","brightness","gamma","colorStrength","invert","memoryInfo","executeFFT2D","bytesPerFloat","vec4FftWork","executeVec4FFT2D","vec4FftPipelines","vec4FftTemp","canvasFormat","GPUTextureUsage","GPUBufferUsage","GPUMapMode","invalidation"],outputs:["workgroups","extractParams","visualizeBindGroups","updateBindGroups","updateParams","simulationStep","render","animationId","downloadPNG","downloadBtnEl","animate"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});c({root:document.getElementById("cell-38"),expanded:[],variables:[]},{id:38,body:(e,t)=>e`## Algorithm

Multiscale Turing patterns are a reaction-diffusion system where multiple scales of activator-inhibitor dynamics compete. At each point:

1. Convolve the field with Gaussian or circular kernels at different radii to compute activator and inhibitor values
2. Find the scale with minimum variation (smallest |activator - inhibitor|)
3. Step the field in the direction indicated by that scale (positive if activator > inhibitor)
4. Mix the color toward the dominant scale's color

### Implementation

This implementation uses several techniques to maximize throughput on the GPU:

**Packed FFTs**: We compute four real-valued FFTs in a single pass by packing data into complex pairs. The real solution field ${t`u`} is stored as a vec4 treating it as two identical complex numbers:

${t.block`(u + 0i,\; u + 0i)`}

Similarly, four convolution kernels (two activator-inhibitor pairs for scales ${t`n`} and ${t`n+1`}) are packed into two complex numbers:

${t.block`(\hat{A}_n + i\hat{I}_n,\; \hat{A}_{n+1} + i\hat{I}_{n+1})`}

where ${t`\hat{A}`} and ${t`\hat{I}`} are the frequency-domain activator and inhibitor kernels. After a single forward FFT, we multiply by two sets of frequency-domain kernels and perform one inverse FFT to recover all four convolved outputs.

**Analytical frequency-domain kernels**: Rather than storing precomputed kernel textures, we evaluate kernels analytically in the shader. The Fourier transform of a Gaussian with standard deviation ${t`\sigma`} is another Gaussian:

${t.block`\mathcal{F}\left[e^{-x^2/2\sigma^2}\right] = e^{-2\pi^2\sigma^2 f^2}`}

The Fourier transform of a circular disc of radius ${t`R`} is a Bessel function of the first kind:

${t.block`\mathcal{F}\left[\Pi(r/R)\right] = \frac{J_1(2\pi R f)}{\pi R f}`}

This eliminates kernel memory bandwidth entirely and allows arbitrary kernel parameters without regenerating textures.

**Float16 precision**: All computation uses 16-bit floating point for storage buffers, halving memory bandwidth compared to float32. The reduced precision is sufficient for the visual nature of the simulation while enabling larger grid sizes and faster execution.`,inputs:["md","tex"],outputs:[],output:void 0,assets:void 0,autodisplay:!0,autoview:!1,automutable:void 0});
