function $(E,n={}){const t={view:new Float32Array(16),projection:new Float32Array(16),center:new Float32Array(n.center||[0,0,0]),theta:n.theta||0,phi:n.phi||0,distance:Math.log(n.distance||10),eye:new Float32Array(3),up:new Float32Array(n.up||[0,1,0]),fovy:n.fovy||Math.PI/4,near:n.near!==void 0?n.near:.01,far:n.far!==void 0?n.far:1e3,noScroll:n.noScroll!==void 0?n.noScroll:!1,flipY:!!n.flipY,dtheta:0,dphi:0,rotationSpeed:n.rotationSpeed!==void 0?n.rotationSpeed:1,zoomSpeed:n.zoomSpeed!==void 0?n.zoomSpeed:1,dirty:!0},U=n.damping!==void 0?n.damping:.9,_=Math.log(n.minDistance||.1),B=Math.log(n.maxDistance||1e3);let x=0,M=0,S=0;const c=n.element||E._gl.canvas;function F(){return c.offsetWidth||window.innerWidth}function Y(){return c.offsetHeight||window.innerHeight}n.mouse!==!1&&(c.addEventListener("mousedown",X),c.addEventListener("touchstart",W,{passive:!1}),n.wheel&&c.addEventListener("wheel",I,{passive:!t.noScroll}));let j=!1;function X(e){j=!0,M=e.clientX,S=e.clientY,window.addEventListener("mousemove",D),window.addEventListener("mouseup",A)}function D(e){if(!j)return;const i=(e.clientX-M)/F(),o=(e.clientY-S)/Y();t.dtheta+=t.rotationSpeed*4*i,t.dphi+=t.rotationSpeed*4*o,t.dirty=!0,M=e.clientX,S=e.clientY}function A(){j=!1,window.removeEventListener("mousemove",D),window.removeEventListener("mouseup",A)}function W(e){e.touches.length===1&&(e.preventDefault(),M=e.touches[0].clientX,S=e.touches[0].clientY,c.addEventListener("touchmove",C,{passive:!1}),c.addEventListener("touchend",H))}function C(e){if(e.touches.length===1){e.preventDefault();const i=(e.touches[0].clientX-M)/F(),o=(e.touches[0].clientY-S)/Y();t.dtheta+=t.rotationSpeed*4*i,t.dphi+=t.rotationSpeed*4*o,t.dirty=!0,M=e.touches[0].clientX,S=e.touches[0].clientY}}function H(){c.removeEventListener("touchmove",C),c.removeEventListener("touchend",H)}function I(e){t.noScroll&&e.preventDefault(),x+=e.deltaY/Y()*t.zoomSpeed,t.dirty=!0}function z(e){const i=e*U;return Math.abs(i)<1e-4?0:(t.dirty=!0,i)}function P(e,i,o){return Math.min(Math.max(e,i),o)}function T(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function G(e,i,o,s){const r=i[0],d=i[1],l=i[2],p=s[0],g=s[1],h=s[2],R=o[0],V=o[1],Z=o[2];let f=r-R,v=d-V,m=l-Z,a=f*f+v*v+m*m;a>0&&(a=1/Math.sqrt(a),f*=a,v*=a,m*=a);let w=g*m-h*v,u=h*f-p*m,y=p*v-g*f;a=w*w+u*u+y*y,a>0&&(a=1/Math.sqrt(a),w*=a,u*=a,y*=a);const q=v*y-m*u,b=m*w-f*y,k=f*u-v*w;return e[0]=w,e[1]=q,e[2]=f,e[3]=0,e[4]=u,e[5]=b,e[6]=v,e[7]=0,e[8]=y,e[9]=k,e[10]=m,e[11]=0,e[12]=-(w*r+u*d+y*l),e[13]=-(q*r+b*d+k*l),e[14]=-(f*r+v*d+m*l),e[15]=1,e}function J(e,i,o,s,r){const d=1/Math.tan(i/2),l=1/(s-r);return e[0]=d/o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=d,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(r+s)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*r*s*l,e[15]=0,e}const K=new Float32Array([1,0,0]),N=new Float32Array([0,0,1]);function O(){const{center:e,eye:i,up:o}=t;t.theta+=t.dtheta,t.phi=P(t.phi+t.dphi,-Math.PI/2,Math.PI/2),t.distance=P(t.distance+x,_,B),t.dtheta=z(t.dtheta),t.dphi=z(t.dphi),x=z(x);const s=t.theta,r=t.phi,d=Math.exp(t.distance),l=d*Math.sin(s)*Math.cos(r),p=d*Math.cos(s)*Math.cos(r),g=d*Math.sin(r);for(let h=0;h<3;h++)i[h]=e[h]+l*N[h]+p*K[h]+g*o[h];G(t.view,i,e,o)}T(t.view),T(t.projection);const Q=E({context:{view:()=>t.view,projection:e=>(J(t.projection,t.fovy,e.viewportWidth/e.viewportHeight,t.near,t.far),t.flipY&&(t.projection[5]*=-1),t.projection),eye:()=>t.eye,dirty:()=>t.dirty},uniforms:{view:E.context("view"),projection:E.context("projection"),eye:E.context("eye")}});function L(e){O(),Q(e),t.dirty=!1}return L.taint=function(){t.dirty=!0},L.state=t,L.element=c,L.destroy=function(){c.removeEventListener("mousedown",X),c.removeEventListener("touchstart",W),c.removeEventListener("wheel",I),window.removeEventListener("mousemove",D),window.removeEventListener("mouseup",A)},L}export{$ as createCamera};
