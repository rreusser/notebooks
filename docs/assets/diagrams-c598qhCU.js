function S(C){const b=parseInt(C.slice(1),16);return[(b>>16)/255,(b>>8&255)/255,(b&255)/255]}function q(C,b,r){return`rgb(${Math.round(C*255)},${Math.round(b*255)},${Math.round(r*255)})`}const h=["#3b82f6","#8b5cf6","#06b6d4","#10b981","#f59e0b"],K=[.05,.275,.5,.725,.95],I=219;function Q(C,b){const r=C,n=h.length,u=K.map(c=>.5+(c-.5)*b),t=u.map(c=>r*Math.max(.01,3e3*Math.pow(1-c,3))),z=Math.max(...t),L=t.reduce((c,B)=>c+B,0),W=h.map(S);let A=0,k=0,x=0,E=0;for(let c=0;c<n;c++){const[B,F,D]=W[c],O=t[c];A+=B*r*O,k+=F*r*O,x+=D*r*O,E+=r*O}let $=1;for(let c=0;c<n;c++)$*=1-r;const X=Math.max(E,1e-4),T=Math.min(1,A/X*(1-$)+$),R=Math.min(1,k/X*(1-$)+$),_=Math.min(1,x/X*(1-$)+$),o=20,H=34,M=26,G=16,a=Array.from({length:n},(c,B)=>G+o/2+B*H),P=M+o/2,g=M+o+6,s=68,l=8,p=g+s+14+o/2,d=p+o+8,m=8,v=a[n-1]+H/2+m+o/2,Y=I,e=v+o/2+8;let i="";i+=`<text x="${M-4}" y="${a[0]+4}" font-size="9" fill="#666" text-anchor="end">Near</text>`,i+=`<text x="${M-4}" y="${a[n-1]+4}" font-size="9" fill="#666" text-anchor="end">Far</text>`,i+=`<text x="${g+s/2}" y="10" font-size="8" fill="#666" text-anchor="middle">w(z)</text>`,i+=`<text x="${p}" y="10" font-size="8" fill="#555" text-anchor="middle">Blend</text>`,i+=`<text x="${d}" y="10" font-size="8" font-weight="600" fill="#555" text-anchor="middle">Result</text>`;const f=g+s+8;i+=`<line x1="${f}" y1="${G}" x2="${f}" y2="${a[n-1]+o/2}" stroke="#ddd" stroke-width="0.5"/>`;for(let c=0;c<n;c++){const B=a[c],F=P-o/2,D=B-o/2;i+=`<rect x="${F}" y="${D}" width="${o}" height="${o}" rx="3" fill="${h[c]}" opacity="${Math.max(r,.08)}" stroke="#ccc" stroke-width="1"/>`;const O=z>0?t[c]/z*s:0;i+=`<rect x="${g}" y="${B-l/2}" width="${O}" height="${l}" rx="2" fill="${h[c]}" opacity="0.7"/>`,i+=`<text x="${g}" y="${B+l/2+8}" font-size="6.5" fill="#666">w(${u[c].toFixed(2)}) = ${t[c].toFixed(0)}</text>`;const j=L>0?t[c]/L:1/n,N=Math.max(.08,Math.min(1,j*n));i+=`<rect x="${p-o/2}" y="${D}" width="${o}" height="${o}" rx="3" fill="${h[c]}" opacity="${N}" stroke="#aaa" stroke-width="0.5"/>`;const J=Math.max(.08,Math.min(1,N*(1-$)));i+=`<rect x="${d-o/2}" y="${D}" width="${o}" height="${o}" rx="3" fill="${h[c]}" opacity="${J}" stroke="#aaa" stroke-width="0.5"/>`}const y=a[n-1]+o/2+m/2;i+=`<line x1="${d-o/2-2}" y1="${y}" x2="${d+o/2+2}" y2="${y}" stroke="#555" stroke-width="1"/>`,i+=`<rect x="${d-o/2}" y="${v-o/2}" width="${o}" height="${o}" rx="3" fill="${q(T,R,_)}" stroke="#333" stroke-width="1.5"/>`;const w=document.createElement("div");return w.id="oit-diagram-fig",w.style.cssText="padding: 16px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px;",w.innerHTML=`<svg viewBox="0 0 ${Y} ${e}" width="100%" style="display: block; font-family: var(--sans-serif);">${i}</svg>`,w}function U(C,b){const r=C,n=h.length,u=Math.min(b,n),t=20,z=30,L=30,W=28,A=16,k=Array.from({length:n},(s,l)=>W+t/2+l*z),x=Array.from({length:n},(s,l)=>A+t/2+l*L),$=k[n-1]+z/2+18+t/2,X=8,T=x[n-1]+L/2+X+t/2,R=I,_=T+t/2+8;let o="";o+=`<text x="${W-4}" y="${x[0]+4}" font-size="9" fill="#999" text-anchor="end">Near</text>`,o+=`<text x="${W-4}" y="${x[n-1]+4}" font-size="9" fill="#999" text-anchor="end">Far</text>`;for(let s=0;s<n;s++){const l=s<u;o+=`<text x="${k[s]}" y="10" font-size="8" fill="${l?"#666":"#ccc"}" text-anchor="middle">Pass ${s+1}</text>`}o+=`<text x="${$}" y="10" font-size="8" font-weight="600" fill="#555" text-anchor="middle">Blend</text>`;const H=(k[n-1]+z/2+$-t/2)/2;o+=`<line x1="${H}" y1="${A}" x2="${H}" y2="${x[n-1]+t/2}" stroke="#ddd" stroke-width="0.5"/>`;for(let s=0;s<n;s++)for(let l=0;l<n;l++){const p=k[l],d=x[s],m=p-t/2,v=d-t/2;l>=u?o+=`<rect x="${m}" y="${v}" width="${t}" height="${t}" rx="3" fill="${h[s]}" opacity="0.1" stroke="#eee" stroke-width="0.5"/>`:s<l?o+=`<rect x="${m}" y="${v}" width="${t}" height="${t}" rx="3" fill="none" stroke="${h[s]}" stroke-width="1" stroke-dasharray="3,2" opacity="0.3"/>`:s===l?o+=`<rect x="${m}" y="${v}" width="${t}" height="${t}" rx="3" fill="${h[s]}" opacity="${Math.max(r,.08)}" stroke="#222" stroke-width="2"/>`:o+=`<rect x="${m}" y="${v}" width="${t}" height="${t}" rx="3" fill="${h[s]}" opacity="${Math.max(r,.08)}" stroke="#ccc" stroke-width="1"/>`}for(let s=0;s<u;s++){const l=k[s]+t/2+2,p=$-t/2-2,d=x[s];o+=`<line x1="${l}" y1="${d}" x2="${p-4}" y2="${d}" stroke="${h[s]}" stroke-width="1" opacity="0.3"/>`,o+=`<path d="M${p-5},${d-3} L${p-1},${d} L${p-5},${d+3}" fill="none" stroke="${h[s]}" stroke-width="1.2" stroke-linecap="round" opacity="0.5"/>`}for(let s=0;s<n;s++){const l=$-t/2,p=x[s]-t/2;if(s<u){const d=r*Math.pow(1-r,s),m=Math.max(.08,d);o+=`<rect x="${l}" y="${p}" width="${t}" height="${t}" rx="3" fill="${h[s]}" opacity="${m}" stroke="#aaa" stroke-width="0.5"/>`}else o+=`<rect x="${l}" y="${p}" width="${t}" height="${t}" rx="3" fill="none" stroke="#ddd" stroke-width="0.5" stroke-dasharray="2,2"/>`}const M=x[n-1]+t/2+X/2;o+=`<line x1="${$-t/2-2}" y1="${M}" x2="${$+t/2+2}" y2="${M}" stroke="#555" stroke-width="1"/>`;let G=1,a=1,P=1;for(let s=u-1;s>=0;s--){const[l,p,d]=S(h[s]);G=l*r+G*(1-r),a=p*r+a*(1-r),P=d*r+P*(1-r)}o+=`<rect x="${$-t/2}" y="${T-t/2}" width="${t}" height="${t}" rx="3" fill="${q(G,a,P)}" stroke="#333" stroke-width="1.5"/>`;const g=document.createElement("div");return g.id="peel-diagram-fig",g.style.cssText="padding: 16px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px;",g.innerHTML=`<svg viewBox="0 0 ${R} ${_}" width="100%" style="display: block; font-family: var(--sans-serif);">${o}</svg>`,g}function V(C,b){const r=C,n=h.length,u=Math.min(b,n),t=20,z=30,L=30,W=28,A=16,k=Array.from({length:n},(e,i)=>W+t/2+i*z),x=Array.from({length:n},(e,i)=>A+t/2+i*L),$=k[n-1]+z/2+18+t/2,X=8,T=x[n-1]+L/2+X+t/2,R=I,_=T+t/2+8,o=new Array(n).fill(-1),H=new Set,M=[],G=[];for(let e=0;e<u;e++){const i=[];for(let w=0;w<n;w++)H.has(w)||i.push(w);if(i.length===0)break;const f=i[0],y=i[i.length-1];o[f]=e,H.add(f),M.push(f),f!==y&&(o[y]=e,H.add(y),G.push(y))}let a="";a+=`<text x="${W-4}" y="${x[0]+4}" font-size="9" fill="#999" text-anchor="end">Near</text>`,a+=`<text x="${W-4}" y="${x[n-1]+4}" font-size="9" fill="#999" text-anchor="end">Far</text>`;for(let e=0;e<n;e++){const i=e<u;a+=`<text x="${k[e]}" y="10" font-size="8" fill="${i?"#666":"#ccc"}" text-anchor="middle">Pass ${e+1}</text>`}a+=`<text x="${$}" y="10" font-size="8" font-weight="600" fill="#555" text-anchor="middle">Blend</text>`;const P=(k[n-1]+z/2+$-t/2)/2;a+=`<line x1="${P}" y1="${A}" x2="${P}" y2="${x[n-1]+t/2}" stroke="#ddd" stroke-width="0.5"/>`;for(let e=0;e<n;e++)for(let i=0;i<n;i++){const f=k[i],y=x[e],w=f-t/2,c=y-t/2;i>=u?a+=`<rect x="${w}" y="${c}" width="${t}" height="${t}" rx="3" fill="${h[e]}" opacity="0.1" stroke="#eee" stroke-width="0.5"/>`:o[e]>=0&&o[e]<i?a+=`<rect x="${w}" y="${c}" width="${t}" height="${t}" rx="3" fill="none" stroke="${h[e]}" stroke-width="1" stroke-dasharray="3,2" opacity="0.3"/>`:o[e]===i?a+=`<rect x="${w}" y="${c}" width="${t}" height="${t}" rx="3" fill="${h[e]}" opacity="${Math.max(r,.08)}" stroke="#222" stroke-width="2"/>`:a+=`<rect x="${w}" y="${c}" width="${t}" height="${t}" rx="3" fill="${h[e]}" opacity="${Math.max(r,.08)}" stroke="#ccc" stroke-width="1"/>`}for(let e=0;e<n;e++)if(o[e]>=0){const i=k[o[e]]+t/2+2,f=$-t/2-2,y=x[e];a+=`<line x1="${i}" y1="${y}" x2="${f-4}" y2="${y}" stroke="${h[e]}" stroke-width="1" opacity="0.3"/>`,a+=`<path d="M${f-5},${y-3} L${f-1},${y} L${f-5},${y+3}" fill="none" stroke="${h[e]}" stroke-width="1.2" stroke-linecap="round" opacity="0.5"/>`}const g=[];for(const e of G)g.push(e);for(let e=M.length-1;e>=0;e--)g.push(M[e]);const s=new Array(n).fill(0),l=g.length;for(let e=0;e<l;e++)s[g[e]]=r*Math.pow(1-r,l-1-e);for(let e=0;e<n;e++){const i=$-t/2,f=x[e]-t/2;if(o[e]>=0){const y=Math.max(.08,s[e]);a+=`<rect x="${i}" y="${f}" width="${t}" height="${t}" rx="3" fill="${h[e]}" opacity="${y}" stroke="#aaa" stroke-width="0.5"/>`}else a+=`<rect x="${i}" y="${f}" width="${t}" height="${t}" rx="3" fill="none" stroke="#ddd" stroke-width="0.5" stroke-dasharray="2,2"/>`}const p=x[n-1]+t/2+X/2;a+=`<line x1="${$-t/2-2}" y1="${p}" x2="${$+t/2+2}" y2="${p}" stroke="#555" stroke-width="1"/>`;let d=1,m=1,v=1;for(const e of g){const[i,f,y]=S(h[e]);d=i*r+d*(1-r),m=f*r+m*(1-r),v=y*r+v*(1-r)}a+=`<rect x="${$-t/2}" y="${T-t/2}" width="${t}" height="${t}" rx="3" fill="${q(d,m,v)}" stroke="#333" stroke-width="1.5"/>`;const Y=document.createElement("div");return Y.id="dual-peel-diagram-fig",Y.style.cssText="padding: 16px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px;",Y.innerHTML=`<svg viewBox="0 0 ${R} ${_}" width="100%" style="display: block; font-family: var(--sans-serif);">${a}</svg>`,Y}export{V as createDualPeelDiagram,Q as createOITDiagram,U as createPeelDiagram};
