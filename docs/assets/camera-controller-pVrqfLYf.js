function tt(a,u={}){const n={center:u.center?[...u.center]:[0,0,0],distance:u.distance||10,phi:u.phi||0,theta:u.theta||.3,fov:u.fov||Math.PI/4,near:u.near||.1,far:u.far||1e3},Z=u.rotateSpeed||.01,N=u.zoomSpeed||.001,O=u.panSpeed||1,c=new Float32Array(16),s=new Float32Array(16),z=new Float32Array(16);let M=!0,v=!1,L=null,E=0,X=0,S=0;function Q(t){const{phi:e,theta:o,distance:i,center:r,fov:Y,near:y,far:p}=n,x=r[0]+i*Math.cos(o)*Math.cos(e),D=r[1]+i*Math.sin(o),h=r[2]+i*Math.cos(o)*Math.sin(e);let l=r[0]-x,d=r[1]-D,f=r[2]-h;const q=Math.sqrt(l*l+d*d+f*f);l/=q,d/=q,f/=q;let w=d*0-f*1,m=f*0-l*0,g=l*1-d*0;const F=Math.sqrt(w*w+m*m+g*g);F>1e-4&&(w/=F,m/=F,g/=F);const K=m*f-g*d,U=g*l-w*f,W=w*d-m*l;c[0]=w,c[1]=K,c[2]=-l,c[3]=0,c[4]=m,c[5]=U,c[6]=-d,c[7]=0,c[8]=g,c[9]=W,c[10]=-f,c[11]=0,c[12]=-(w*x+m*D+g*h),c[13]=-(K*x+U*D+W*h),c[14]=l*x+d*D+f*h,c[15]=1;const G=1/Math.tan(Y/2),H=1/(y-p);s[0]=G/t,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=G,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=(y+p)*H,s[11]=-1,s[12]=0,s[13]=0,s[14]=y*p*H*2,s[15]=0;for(let I=0;I<4;I++)for(let b=0;b<4;b++){let J=0;for(let j=0;j<4;j++)J+=s[I+j*4]*c[j+b*4];z[I+b*4]=J}}function A(t,e){const{phi:o,theta:i,distance:r}=n,Y=Math.sin(o),y=-Math.cos(o),p=-Math.sin(i)*Math.cos(o),x=Math.cos(i),D=-Math.sin(i)*Math.sin(o),h=r*O;n.center[0]-=t*Y*h,n.center[0]+=e*p*h,n.center[1]+=e*x*h,n.center[2]-=t*y*h,n.center[2]+=e*D*h}function T(t){t.preventDefault(),E=t.clientX,X=t.clientY,L=t.shiftKey||t.button===2?"pan":"rotate",v=!0,a.style.cursor="grabbing",window.addEventListener("mousemove",C),window.addEventListener("mouseup",P)}function C(t){if(!v)return;const e=t.clientX-E,o=t.clientY-X;if(E=t.clientX,X=t.clientY,L==="rotate")n.phi+=e*Z,n.theta=Math.max(-Math.PI/2+.01,Math.min(Math.PI/2-.01,n.theta+o*Z));else if(L==="pan"){const i=a.getBoundingClientRect();A(e/i.width,o/i.height)}M=!0}function P(){v=!1,L=null,a.style.cursor="grab",window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",P)}function _(t){t.preventDefault();const e=a.getBoundingClientRect(),o=(t.clientX-e.left)/e.width-.5,i=(t.clientY-e.top)/e.height-.5,r=1+t.deltaY*N,Y=n.distance;n.distance=Math.max(n.near*10,Y*r);const p=1-n.distance/Y;A(-o*p,-i*p),M=!0}function B(t){if(t.preventDefault(),t.touches.length===1)v=!0,L="rotate",E=t.touches[0].clientX,X=t.touches[0].clientY;else if(t.touches.length===2){const e=t.touches[1].clientX-t.touches[0].clientX,o=t.touches[1].clientY-t.touches[0].clientY;S=Math.sqrt(e*e+o*o)}}function R(t){if(t.preventDefault(),t.touches.length===1&&v){const e=t.touches[0].clientX-E,o=t.touches[0].clientY-X;E=t.touches[0].clientX,X=t.touches[0].clientY,n.phi-=e*Z,n.theta=Math.max(-Math.PI/2+.01,Math.min(Math.PI/2-.01,n.theta+o*Z)),M=!0}else if(t.touches.length===2){const e=t.touches[1].clientX-t.touches[0].clientX,o=t.touches[1].clientY-t.touches[0].clientY,i=Math.sqrt(e*e+o*o);if(S>0){const r=S/i;n.distance*=r,n.distance=Math.max(n.near*10,n.distance),M=!0}S=i}}function V(){v=!1,L=null,S=0}function k(t){t.preventDefault()}a.style.cursor="grab",a.addEventListener("mousedown",T),a.addEventListener("wheel",_,{passive:!1}),a.addEventListener("touchstart",B,{passive:!1}),a.addEventListener("touchmove",R,{passive:!1}),a.addEventListener("touchend",V),a.addEventListener("contextmenu",k);function $(){a.removeEventListener("mousedown",T),a.removeEventListener("wheel",_),a.removeEventListener("touchstart",B),a.removeEventListener("touchmove",R),a.removeEventListener("touchend",V),a.removeEventListener("contextmenu",k),window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",P)}return{state:n,get dirty(){return M},taint(){M=!0},update(t){Q(t);const e=M;return M=!1,{view:c,projection:s,projectionView:z,dirty:e}},destroy:$}}export{tt as createCameraController,tt as default};
