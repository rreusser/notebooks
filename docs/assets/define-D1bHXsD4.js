import{I as v,m as u,i as E,M as C}from"./index-DLwE0_Ng.js";function T(e,t){const n=document.createElement("div");if(new v(n).fulfilled(e),t)for(const o of t){let r=n;for(const s of o)r=r?.childNodes[s];r?.dispatchEvent(new Event("mouseup"))}return n}function R(e){const t=document.createElement("div");return new v(t).rejected(e),t}function I(e){if(!$(e))return;const t=e.querySelectorAll(".observablehq--expanded");if(t.length)return Array.from(t,n=>j(e,n))}function N(e){return e.nodeType===1}function $(e){return N(e)&&e.classList.contains("observablehq")}function j(e,t){const n=[];for(;t!==e;)n.push(O(t)),t=t.parentNode;return n.reverse()}function O(e){return Array.prototype.indexOf.call(e.parentNode.childNodes,e)}const q=["audio source[src]","audio[src]","img[src]","picture source[src]","video source[src]","video[src]"].join(),L=["img[srcset]","picture source[srcset]"].join(),P=["a[href][download]","link[href]"].join(),M=[[q,"src"],[L,"srcset"],[P,"href"]];function U(e,t){const n=o=>t.get(B(o))??o;for(const[o,r]of M)for(const s of e.querySelectorAll(o)){if(k(s))continue;const a=decodeURI(s.getAttribute(r));r==="srcset"?s.setAttribute(r,F(a,n)):s.setAttribute(r,n(a))}}function k(e){return/(?:^|\s)external(?:\s|$)/i.test(e.getAttribute("rel")??"")}function W(e){const t=e.indexOf("?"),n=e.indexOf("#"),o=t>=0&&n>=0?Math.min(t,n):t>=0?t:n;return o>=0?e.slice(0,o):e}function B(e){const t=W(e);return D(t)?t:`./${t}`}function D(e){return["./","../","/"].some(t=>e.startsWith(t))}function F(e,t){return e.trim().split(/\s*,\s*/).filter(n=>n).map(n=>{const o=n.split(/\s+/),r=t(o[0]);return r&&(o[0]=encodeURI(r)),o.join(" ")}).join(", ")}function b(e,t){const{root:n,expanded:o}=e,r=V(t,n)?t:T(t,o[n.childNodes.length]);_(e,r)}function _(e,t){if(t.nodeType===11){let n;for(;n=t.firstChild;)e.root.appendChild(n)}else e.root.appendChild(t)}function H(e,t){_(e,R(t))}function V(e,t){return(e instanceof Element||e instanceof Text)&&e instanceof e.constructor&&(!e.parentNode||t.contains(e))}function p(e){for(e.expanded=Array.from(e.root.childNodes,I);e.root.lastChild;)e.root.lastChild.remove()}function z(e,{autodisplay:t,assets:n}){return{_error:!1,_node:e.root,pending(){this._error&&(this._error=!1,p(e))},fulfilled(o){t&&(p(e),n&&o instanceof Element&&U(o,n),b(e,o))},rejected(o){console.error(o),this._error=!0,p(e),H(e,o)}}}function J(e,t,n=z){const{id:o,body:r,inputs:s=[],outputs:a=[],output:f,autodisplay:g,autoview:x,automutable:A}=t,h=e.variables,l=u.variable(n(e,t),{shadow:{}}),w=f??(a.length?`cell ${o}`:null);if(s.includes("display")||s.includes("view")){let c=-1;const d=new l.constructor(2,l._module);if(d.define(s.filter(i=>i!=="display"&&i!=="view"),()=>{const i=l._version;return m=>{if(i<c)throw new Error("stale display");if(e.variables[0]!==l)throw new Error("stale display");return i>c&&p(e),c=i,b(e,m),m}}),l._shadow.set("display",d),s.includes("view")){const i=new l.constructor(2,l._module,null,{shadow:{}});i._shadow.set("display",d),i.define(["display"],m=>S=>E(m(S))),l._shadow.set("view",i)}}else g||p(e);if(h.push(l.define(w,s,r)),f!=null){if(x){const c=y(f,"viewof$");h.push(u.define(c,[f],E))}else if(A){const c=y(f,"mutable "),d=`cell ${o}`;l.define(c,[d],([i])=>i),h.push(u.define(f,s,r),u.define(d,[f],C),u.define(`mutable$${c}`,[d],([,i])=>i))}}else for(const c of a)h.push(u.variable(!0).define(c,[w],d=>d[c]))}function y(e,t){if(!e.startsWith(t))throw new Error(`expected ${t}: ${e}`);return e.slice(t.length)}export{J as d};
