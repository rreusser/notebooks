import{d as $,_ as S}from"./index-ByB2dbry.js";$({root:document.getElementById("cell-1"),expanded:[],variables:[]},{id:1,body:async(g,t,s)=>{const[{TerrainMap:O},{TILE_URL_TERRAIN:C,TILE_URL_SENTINEL:x},{createGPULines:h},{default:A},{expandable:_}]=await Promise.all([S(()=>import("./terrain-viewer-CsPYaaUS.js"),[]).then(a=>{if(!("TerrainMap"in a))throw new SyntaxError("export 'TerrainMap' not found");return a}),S(()=>import("./tile-urls-B-E4qz8f.js"),[]).then(a=>{if(!("TILE_URL_TERRAIN"in a))throw new SyntaxError("export 'TILE_URL_TERRAIN' not found");if(!("TILE_URL_SENTINEL"in a))throw new SyntaxError("export 'TILE_URL_SENTINEL' not found");return a}),S(()=>import("https://cdn.jsdelivr.net/npm/webgpu-instanced-lines/+esm"),[]).then(a=>{if(!("createGPULines"in a))throw new SyntaxError("export 'createGPULines' not found");return a}),S(()=>import("https://cdn.jsdelivr.net/npm/simplify-js/+esm"),[]).then(a=>{if(!("default"in a))throw new SyntaxError("export 'default' not found");return a}),S(()=>import("./expandable-BCrxs32f.js"),[]).then(a=>{if(!("expandable"in a))throw new SyntaxError("export 'expandable' not found");return a})]),n=document.createElement("canvas");n.className="terrain";const r=await O.create(n,{sources:{"arctic-dem":{type:"terrain",tiles:[C],minzoom:4,maxzoom:13,bounds:[-152.9,62.2,-148.8,64],attribution:'<a href="https://www.pgc.umn.edu/data/arcticdem/" target="_blank" rel="noopener">ArcticDEM</a> | <a href="https://catalog.data.gov/dataset/srtm30-global-1-km-digital-elevation-model-dem-version-11-land-surface" target="_blank" rel="noopener">SRTM30</a>'},sentinel:{type:"raster",tiles:[x],minzoom:4,maxzoom:11,bounds:[-152.9,62.2,-148.8,64],attribution:'<a href="https://dataspace.copernicus.eu/" target="_blank" rel="noopener">Copernicus Sentinel-2</a>'},peaks:{type:"geojson",data:"osm/peaks.geojson",attribution:'<a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener">OpenStreetMap</a>'},fkt:{type:"geojson",data:"strava/fkt.geojson",simplify:1e-4,attribution:'<a href="https://www.strava.com/activities/9223277277" target="_blank" rel="noopener">Strava</a>'}},camera:{center:[.08005793958567985,.00021365516506647512,.27291423467021114],distance:.0004971889617079275,phi:2.4972122538258654,theta:.13580281526641474},font:{atlas:"./mapviewer/fonts/roboto-regular.png",metadata:"./mapviewer/fonts/roboto-regular.json"},base:[{id:"satellite",source:"sentinel",blend:"source-over"}],features:[{id:"ski-tracks",type:"line",source:"fkt",paint:{"line-color":"#ff8800","line-width":5,"line-border-color":"#331100","line-border-width":2,"atmosphere-opacity":.5}},{id:"peak-circles",type:"circle",source:"peaks",paint:{"circle-radius":3,"circle-color":"#000000","circle-stroke-color":"#ffffff","circle-stroke-width":1.5,"atmosphere-opacity":.5}},{id:"peak-labels",type:"text",source:"peaks",paint:{"text-field":"name","text-size":16,"text-color":"#000000","text-halo-color":"#ffffff","text-halo-width":1.25,"atmosphere-opacity":.5}}],createGPULines:h,simplifyFn:A}),p=g`<div class="slope-legend" style="display: none">
  <div class="slope-legend-title">Slope angle</div>
  <div class="slope-legend-blocks">
    <div style="background: rgb(255, 199, 0)"></div>
    <div style="background: rgb(255, 140, 0)"></div>
    <div style="background: rgb(255, 77, 0)"></div>
    <div style="background: rgb(191, 0, 0)"></div>
    <div style="background: rgb(102, 0, 153)"></div>
    <div style="background: rgb(0, 51, 204)"></div>
    <div style="background: rgb(0, 0, 0)"></div>
  </div>
  <div class="slope-legend-labels">
    <span>26-29°</span>
    <span>30-31°</span>
    <span>32-34°</span>
    <span>35-45°</span>
    <span>46-50°</span>
    <span>51-59°</span>
    <span>60°+</span>
  </div>
</div>`;r._slopeLegend=p;const y=g`<div class="elevation-label"></div>`;n.addEventListener("mousemove",a=>{const c=r.raycast(a.clientX,a.clientY);if(c){const u=r.queryElevationMercator(c.worldPos[0],c.worldPos[2]);if(u!=null){const f=Math.round(u*3.28084);y.textContent=`${f.toLocaleString()} ft`,y.style.opacity="1"}else y.style.opacity="0"}else y.style.opacity="0"}),n.addEventListener("mouseleave",()=>{y.style.opacity="0"});const l=g`<div style="position: relative">`;l.appendChild(n),l.appendChild(y),l.appendChild(p),l.appendChild(r.attribution);const v=g`<button class="compass-rose" title="Orient north">
  <svg viewBox="0 0 28 28" width="24" height="24" style="display:block">
    <path d="M14 4L17.5 14L14 12L10.5 14Z" fill="#D32F2F"/>
    <path d="M14 24L10.5 14L14 16L17.5 14Z" fill="#9E9E9E"/>
  </svg>
</button>`;l.appendChild(v);const E=v.querySelector("svg");function e(){if(!v.isConnected)return;const a=90-r.camera.state.phi*180/Math.PI;E.style.transform=`rotate(${a}deg)`,requestAnimationFrame(e)}return requestAnimationFrame(e),v.addEventListener("click",()=>{const a=Math.PI/2,c=r.camera.state.phi;let u=a-c;u-=Math.round(u/(2*Math.PI))*2*Math.PI;const f=performance.now();function M(T){const m=Math.min(1,(T-f)/300),b=m*m*(3-2*m);r.camera.state.phi=c+u*b,r.camera.taint(),m<1&&requestAnimationFrame(M)}requestAnimationFrame(M)}),t(_(l,{wide:!0,width:640,height:600,toggleOffset:[-12,-12],controls:".terrain-controls",onResize(a,c,u,f){f?(n.style.width=`${c}px`,n.style.height=`${u}px`):(n.style.width="",n.style.height=""),r.camera.taint()}})),s.then(()=>r.destroy()),{TerrainMap:O,TILE_URL_TERRAIN:C,TILE_URL_SENTINEL:x,createGPULines:h,simplify:A,expandable:_,canvas:n,viewer:r,slopeLegend:p,elevationLabel:y,container:l,compassBtn:v,compassSvg:E,updateCompass:e}},inputs:["html","display","invalidation"],outputs:["TerrainMap","TILE_URL_TERRAIN","TILE_URL_SENTINEL","createGPULines","simplify","expandable","canvas","viewer","slopeLegend","elevationLabel","container","compassBtn","compassSvg","updateCompass"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});$({root:document.getElementById("cell-2"),expanded:[],variables:[]},{id:2,body:async(g,t,s,O)=>{const{default:C}=await S(()=>import("https://cdn.jsdelivr.net/npm/suncalc/+esm"),[]).then(e=>{if(!("default"in e))throw new SyntaxError("export 'default' not found");return e}),x=g`<div class="terrain-controls"></div>`,h={date:new Date,timeOfDay:14},A=t._location;function _(){const e=h.timeOfDay,a=h.date,c=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate(),Math.floor(e)+8,e%1*60,0)),u=C.getPosition(c,A.lat,A.lon),f=u.altitude,M=u.azimuth;t.settings.sunDirection=[-Math.cos(f)*Math.sin(M),Math.sin(f),Math.cos(f)*Math.cos(M)]}_();function n(e,a,c){e.appendChild(a),a.addEventListener("input",()=>c(a.value))}n(x,s.checkbox(["Imagery","Features","Route"],{value:["Imagery","Features","Route"],label:"Layers"}),e=>{t.settings.showImagery=e.includes("Imagery"),t.settings.showFeatures=e.includes("Features"),t.settings.showRoute=e.includes("Route")});const r=g`<details open><summary style="cursor: pointer;">Analysis</summary><div style="display: flex; flex-direction: column; gap: 4px; margin-top: 4px"></div></details>`,p=r.querySelector("div");x.appendChild(r),n(p,s.range([0,1],{value:t.settings.hillshadeOpacity,step:.01,label:"Hillshade opacity"}),e=>{t.settings.hillshadeOpacity=e}),n(p,s.range([0,1],{value:t.settings.contourOpacity,step:.01,label:"Contour opacity"}),e=>{t.settings.contourOpacity=e}),n(p,s.range([0,1],{value:t.settings.slopeAngleOpacity,step:.01,label:"Slope angle opacity"}),e=>{t.settings.slopeAngleOpacity=e,t._slopeLegend.style.display=e>0?"":"none"}),n(p,s.range([0,1],{value:t.settings.slopeAspectOpacity,step:.01,label:"Slope aspect opacity"}),e=>{t.settings.slopeAspectOpacity=e});{const e="http://www.w3.org/2000/svg",f=["N","NE","E","SE","S","SW","W","NW"],M=[{key:"slopeAspectMaskAbove",rInner:0,rOuter:18},{key:"slopeAspectMaskNear",rInner:18,rOuter:36},{key:"slopeAspectMaskBelow",rInner:36,rOuter:54}],T=68,m={slopeAspectMaskAbove:0,slopeAspectMaskNear:0,slopeAspectMaskBelow:0},b=document.createElementNS(e,"svg");b.setAttribute("viewBox","0 0 160 160"),b.setAttribute("width",160),b.setAttribute("height",160),b.style.display="block",b.style.margin="4px auto 0";for(const o of M)for(let L=0;L<8;L++){const i=(L*45-22.5-90)*Math.PI/180,k=(L*45+22.5-90)*Math.PI/180,d=document.createElementNS(e,"path");let F;if(o.rInner===0){const D=80+o.rOuter*Math.cos(i),P=80+o.rOuter*Math.sin(i),N=80+o.rOuter*Math.cos(k),z=80+o.rOuter*Math.sin(k);F=`M80,80L${D.toFixed(1)},${P.toFixed(1)}L${N.toFixed(1)},${z.toFixed(1)}Z`}else{const D=80+o.rInner*Math.cos(i),P=80+o.rInner*Math.sin(i),N=80+o.rOuter*Math.cos(i),z=80+o.rOuter*Math.sin(i),B=80+o.rInner*Math.cos(k),q=80+o.rInner*Math.sin(k),V=80+o.rOuter*Math.cos(k),j=80+o.rOuter*Math.sin(k);F=`M${D.toFixed(1)},${P.toFixed(1)}L${N.toFixed(1)},${z.toFixed(1)}L${V.toFixed(1)},${j.toFixed(1)}L${B.toFixed(1)},${q.toFixed(1)}Z`}d.setAttribute("d",F),d.setAttribute("fill","#fff"),d.setAttribute("stroke","#333"),d.setAttribute("stroke-width","0.5"),d.style.cursor="pointer",d.style.transition="fill 0.1s";const w=o.key,I=L;d.addEventListener("click",()=>{m[w]^=1<<I,d.setAttribute("fill",m[w]&1<<I?"#59D91A":"#fff"),t.settings[w]=m[w]}),d.addEventListener("mouseenter",()=>{m[w]&1<<I||d.setAttribute("fill","#eee")}),d.addEventListener("mouseleave",()=>{m[w]&1<<I||d.setAttribute("fill","#fff")}),b.appendChild(d)}for(let o=0;o<8;o++){const L=(o*45-90)*Math.PI/180,i=document.createElementNS(e,"text");i.setAttribute("x",(80+T*Math.cos(L)).toFixed(1)),i.setAttribute("y",(80+T*Math.sin(L)).toFixed(1)),i.setAttribute("text-anchor","middle"),i.setAttribute("dominant-baseline","central"),i.setAttribute("font-size","10"),i.setAttribute("font-family","system-ui, sans-serif"),i.setAttribute("fill","#333"),i.setAttribute("pointer-events","none"),i.textContent=f[o],b.appendChild(i)}const R=g`<div class="aspect-rose" style="max-width: 240px;">
    <label style="font-size: 12px; font-weight: 500; font-family: system-ui, sans-serif; color: #333;">Slope aspect</label>
  </div>`;R.appendChild(b);const U=g`<div style="display: flex; justify-content: center; gap: 12px; font-size: 10px; font-family: system-ui, sans-serif; color: #333; margin-top: 2px;">
    <span>Inner: Above</span>
    <span>Middle: Near</span>
    <span>Outer: Below treeline</span>
  </div>`;R.appendChild(U),p.appendChild(R)}n(p,s.range([0,1e4],{value:t.settings.treelineLower,step:50,label:"Lower treeline (ft)"}),e=>{t.settings.treelineLower=e}),n(p,s.range([0,1e4],{value:t.settings.treelineUpper,step:50,label:"Upper treeline (ft)"}),e=>{t.settings.treelineUpper=e});const y=g`<details><summary style="cursor: pointer;">Environment</summary><div style="display: flex; flex-direction: column; gap: 4px; margin-top: 4px"></div></details>`,l=y.querySelector("div");x.appendChild(y),n(l,s.range([0,2],{value:t.settings.verticalExaggeration,step:.01,label:"Vertical exaggeration"}),e=>{t.settings.verticalExaggeration=e}),n(l,s.range([10,90],{value:Math.round(t.camera.state.fov*180/Math.PI),step:1,label:"FOV (degrees)"}),e=>{t.camera.state.fov=e*Math.PI/180,t.camera.taint()}),n(l,s.date({value:h.date,label:"Date"}),e=>{e&&(h.date=e,_())}),n(l,s.range([0,24],{value:h.timeOfDay,step:.01,label:"Time of day (AKDT)"}),e=>{h.timeOfDay=e,_()}),n(l,s.range([.05,1],{value:t.settings.atmosphereDensity,step:.01,label:"Atmosphere density"}),e=>{t.settings.atmosphereDensity=e});const v=g`<details><summary style="cursor: pointer;">Debug</summary><div style="display: flex; flex-direction: column; gap: 4px; margin-top: 4px"></div></details>`,E=v.querySelector("div");return x.appendChild(v),n(E,s.range([1,5],{value:t.settings.densityThreshold,step:.1,label:"Tile scale",transform:Math.log}),e=>{t.settings.densityThreshold=e}),n(E,s.toggle({label:"Show tile borders"}),e=>{t.settings.showTileBorders=e}),n(E,s.toggle({label:"Show wireframe"}),e=>{t.settings.showWireframe=e}),n(E,s.toggle({label:"Freeze coverage"}),e=>{t.settings.freezeCoverage=e}),n(E,s.toggle({label:"Show collision boxes"}),e=>{t.settings.showCollisionBoxes=e}),O(x),{SunCalc:C,controlsContainer:x,sunState:h,location:A,updateSunDirection:_,addControl:n,analysis:r,analysisContent:p,environment:y,envContent:l,debug:v,debugContent:E}},inputs:["html","viewer","Inputs","display"],outputs:["SunCalc","controlsContainer","sunState","location","updateSunDirection","addControl","analysis","analysisContent","environment","envContent","debug","debugContent"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});
