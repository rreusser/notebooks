function nt(c,u={}){const n={center:u.center?[...u.center]:[0,0,0],distance:u.distance||10,phi:u.phi||0,theta:u.theta||.3,fov:u.fov||Math.PI/4,near:u.near||.1,far:u.far||1e3},S=u.rotateSpeed||.01,Q=u.zoomSpeed||.001,$=u.panSpeed||1,s=new Float32Array(16),i=new Float32Array(16),B=new Float32Array(16);let w=!0,y=!1,x=null,v=0,D=0,C=0,b=0,j=0;function tt(t){const{phi:e,theta:o,distance:a,center:r,fov:d,near:g,far:h}=n,m=r[0]+a*Math.cos(o)*Math.cos(e),X=r[1]+a*Math.sin(o),l=r[2]+a*Math.cos(o)*Math.sin(e);let f=r[0]-m,p=r[1]-X,M=r[2]-l;const A=Math.sqrt(f*f+p*p+M*M);f/=A,p/=A,M/=A;let Y=p*0-M*1,L=M*0-f*0,E=f*1-p*0;const Z=Math.sqrt(Y*Y+L*L+E*E);Z>1e-4&&(Y/=Z,L/=Z,E/=Z);const W=L*M-E*p,G=E*f-Y*M,H=Y*p-L*f;s[0]=Y,s[1]=W,s[2]=-f,s[3]=0,s[4]=L,s[5]=G,s[6]=-p,s[7]=0,s[8]=E,s[9]=H,s[10]=-M,s[11]=0,s[12]=-(Y*m+L*X+E*l),s[13]=-(W*m+G*X+H*l),s[14]=f*m+p*X+M*l,s[15]=1;const J=1/Math.tan(d/2),N=1/(g-h);i[0]=J/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=J,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=(g+h)*N,i[11]=-1,i[12]=0,i[13]=0,i[14]=g*h*N*2,i[15]=0;for(let F=0;F<4;F++)for(let I=0;I<4;I++){let O=0;for(let T=0;T<4;T++)O+=i[F+T*4]*s[T+I*4];B[F+I*4]=O}}function P(t,e){const{phi:o,theta:a,distance:r}=n,d=Math.sin(o),g=-Math.cos(o),h=-Math.sin(a)*Math.cos(o),m=Math.cos(a),X=-Math.sin(a)*Math.sin(o),l=r*$;n.center[0]-=t*d*l,n.center[0]+=e*h*l,n.center[1]+=e*m*l,n.center[2]-=t*g*l,n.center[2]+=e*X*l}function R(t){t.preventDefault(),v=t.clientX,D=t.clientY,x=t.shiftKey||t.button===2?"pan":"rotate",y=!0,c.style.cursor="grabbing",window.addEventListener("mousemove",q),window.addEventListener("mouseup",z)}function q(t){if(!y)return;const e=t.clientX-v,o=t.clientY-D;if(v=t.clientX,D=t.clientY,x==="rotate")n.phi+=e*S,n.theta=Math.max(-Math.PI/2+.01,Math.min(Math.PI/2-.01,n.theta+o*S));else if(x==="pan"){const a=c.getBoundingClientRect();P(e/a.width,o/a.height)}w=!0}function z(){y=!1,x=null,c.style.cursor="grab",window.removeEventListener("mousemove",q),window.removeEventListener("mouseup",z)}function _(t){t.preventDefault();const e=c.getBoundingClientRect(),o=(t.clientX-e.left)/e.width-.5,a=(t.clientY-e.top)/e.height-.5,r=1+t.deltaY*Q,d=n.distance;n.distance=Math.max(n.near*10,d*r);const h=1-n.distance/d;P(-o*h,-a*h),w=!0}function V(t){if(t.preventDefault(),t.touches.length===1)y=!0,x="rotate",v=t.touches[0].clientX,D=t.touches[0].clientY;else if(t.touches.length===2){const e=t.touches[1].clientX-t.touches[0].clientX,o=t.touches[1].clientY-t.touches[0].clientY;C=Math.sqrt(e*e+o*o),b=(t.touches[0].clientX+t.touches[1].clientX)/2,j=(t.touches[0].clientY+t.touches[1].clientY)/2}}function k(t){if(t.preventDefault(),t.touches.length===1&&y){const e=t.touches[0].clientX-v,o=t.touches[0].clientY-D;v=t.touches[0].clientX,D=t.touches[0].clientY,n.phi+=e*S,n.theta=Math.max(-Math.PI/2+.01,Math.min(Math.PI/2-.01,n.theta+o*S)),w=!0}else if(t.touches.length===2){const e=t.touches[1].clientX-t.touches[0].clientX,o=t.touches[1].clientY-t.touches[0].clientY,a=Math.sqrt(e*e+o*o),r=(t.touches[0].clientX+t.touches[1].clientX)/2,d=(t.touches[0].clientY+t.touches[1].clientY)/2;if(C>0){const g=C/a;n.distance*=g,n.distance=Math.max(n.near*10,n.distance);const h=c.getBoundingClientRect(),m=(r-b)/h.width,X=(d-j)/h.height;P(m,X),w=!0}C=a,b=r,j=d}}function K(){y=!1,x=null,C=0}function U(t){t.preventDefault()}c.style.cursor="grab",c.addEventListener("mousedown",R),c.addEventListener("wheel",_,{passive:!1}),c.addEventListener("touchstart",V,{passive:!1}),c.addEventListener("touchmove",k,{passive:!1}),c.addEventListener("touchend",K),c.addEventListener("contextmenu",U);function et(){c.removeEventListener("mousedown",R),c.removeEventListener("wheel",_),c.removeEventListener("touchstart",V),c.removeEventListener("touchmove",k),c.removeEventListener("touchend",K),c.removeEventListener("contextmenu",U),window.removeEventListener("mousemove",q),window.removeEventListener("mouseup",z)}return{state:n,get dirty(){return w},taint(){w=!0},update(t){tt(t);const e=w;return w=!1,{view:s,projection:i,projectionView:B,dirty:e}},destroy:et}}export{nt as createCameraController,nt as default};
