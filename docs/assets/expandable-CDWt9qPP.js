function te(f,{width:q,height:L,toggleOffset:C=[8,8],margin:N=0,padding:w=0,onResize:h,controls:M,state:x,wide:S=!1,maxWidth:Q=1200,aspectRatio:k}){let p=x?.expanded??!1,H=q,P=L,b=!1,s={x:16,y:16},o=null,m=!1,y={x:0,y:0};const $=M?Array.isArray(M)?M:[M]:[],g=[];let v=null;const c=document.createElement("div");c.className="expandable-container";const l=document.createElement("div");l.className="expandable-content";const u=document.createElement("div");if(u.className="expandable-overlay",u.addEventListener("click",()=>T()),$.length>0){o=document.createElement("div"),o.className="expandable-controls-panel",o.style.display="none";const n=document.createElement("div");n.className="expandable-controls-header";const e=document.createElement("span");e.textContent="Controls";const t=document.createElement("button");t.className="expandable-controls-toggle",t.innerHTML="▼",t.title="Collapse controls",t.addEventListener("click",r=>{r.stopPropagation(),U()}),n.appendChild(e),n.appendChild(t);const i=document.createElement("div");i.className="expandable-controls-content",o.appendChild(n),o.appendChild(i),n.addEventListener("mousedown",r=>{r.target!==t&&(m=!0,y.x=r.clientX-s.x,y.y=r.clientY-s.y,n.style.cursor="grabbing",r.preventDefault())}),document.addEventListener("mousemove",r=>{m&&(s.x=r.clientX-y.x,s.y=r.clientY-y.y,B(),F())}),document.addEventListener("mouseup",()=>{if(m){m=!1;const r=o?.querySelector(".expandable-controls-header");r&&(r.style.cursor="move")}}),n.addEventListener("touchstart",r=>{if(r.target===t)return;m=!0;const d=r.touches[0];y.x=d.clientX-s.x,y.y=d.clientY-s.y,r.preventDefault()},{passive:!1}),document.addEventListener("touchmove",r=>{if(!m)return;const d=r.touches[0];s.x=d.clientX-y.x,s.y=d.clientY-y.y,B(),F()},{passive:!0}),document.addEventListener("touchend",()=>{m=!1})}function B(){if(!o)return;const n=o.getBoundingClientRect();s.x=Math.max(0,Math.min(s.x,window.innerWidth-n.width)),s.y=Math.max(0,Math.min(s.y,window.innerHeight-n.height))}function F(){o&&p&&(o.style.left=`${s.x}px`,o.style.top=`${s.y}px`)}function U(){if(b=!b,!o)return;const n=o.querySelector(".expandable-controls-content"),e=o.querySelector(".expandable-controls-toggle");b?(n&&(n.style.display="flex"),e&&(e.innerHTML="▼",e.title="Collapse controls")):(n&&(n.style.display="none"),e&&(e.innerHTML="▶",e.title="Expand controls"))}function D(){for(let n=g.length-1;n>=0;n--){const e=g[n];if(e){if(e.placeholder&&e.placeholder.parentNode&&e.placeholder.parentNode.removeChild(e.placeholder),e.selector){const t=document.querySelector(e.selector);if(t&&t!==e.element){e.element.parentNode&&e.element.parentNode.removeChild(e.element);continue}}e.element&&e.originalParent&&(e.originalNextSibling?e.originalParent.insertBefore(e.element,e.originalNextSibling):e.originalParent.appendChild(e.element))}}g.length=0}function V(){v||(v=new MutationObserver(n=>{if(!p||!o)return;const e=o.querySelector(".expandable-controls-content");if(e)for(const t of g){if(!t.selector)continue;const i=document.querySelector(t.selector);if(i&&i!==t.element&&!e.contains(i)){const r=t.element;t.element=i,t.originalParent=i.parentNode,t.originalNextSibling=i.nextSibling;const d=document.createElement("div");d.className="expandable-controls-placeholder",d.style.display="none",i.parentNode.insertBefore(d,i),t.placeholder&&t.placeholder.parentNode&&t.placeholder.parentNode.removeChild(t.placeholder),t.placeholder=d,r.parentNode===e?(e.insertBefore(i,r),e.removeChild(r)):e.appendChild(i)}}}),v.observe(document.body,{childList:!0,subtree:!0}))}function X(){v&&(v.disconnect(),v=null)}const a=document.createElement("button");if(a.className="expandable-toggle",a.innerHTML="⤢",a.title="Expand",a.style.top=`${-C[1]}px`,a.style.right=`${-C[0]}px`,typeof f=="function"&&(f=f()),typeof f=="string"){const n=document.createElement("div");n.innerHTML=f,f=n.firstElementChild||n}l.appendChild(f),l.appendChild(a),c.appendChild(l);function W(){if(!S||p)return;const n=window.innerWidth,e=Math.min(Q,n-40),t=k?Math.round(e/k):L,r=((document.querySelector(".observablehq--cell")?.offsetWidth||640)-e)/2;l.style.width=`${e}px`,l.style.marginLeft=`${r}px`,(e!==H||t!==P)&&(H=e,P=t,h&&h(f,e,t,!1))}S?requestAnimationFrame(W):h&&h(f,q,L,!1);let A=null;function Y(){!p&&c.isConnected&&(A=c.offsetHeight)}requestAnimationFrame(()=>{Y()});function O(n,e){H=n,P=e,h&&h(f,n,e,p)}function T(){p=!1,x&&(x.expanded=!1),c.classList.remove("expandable-expanded"),a.innerHTML="⤢",a.title="Expand",a.style.top=`${-C[1]}px`,a.style.right=`${-C[0]}px`,u.parentNode&&u.remove(),X(),o&&(o.classList.remove("expandable-expanded"),o.style.display="none",D()),c.style.height="",l.style.position="relative",l.style.display="inline-block",l.style.top="",l.style.left="",l.style.transform="",l.style.width="",l.style.height="",l.style.overflow="",l.style.boxShadow="",l.classList.remove("expanded"),l.style.padding="",l.style.borderRadius="",l.style.zIndex="1";const n=l.querySelector("figure");n&&(n.style.margin=n._savedMargin??""),S?requestAnimationFrame(W):O(q,L),requestAnimationFrame(()=>{Y()})}function _(){if(!p)return;const n=window.innerWidth,e=window.innerHeight,[t,i]=Array.isArray(N)?N:[N,N],[r,d]=Array.isArray(w)?w:[w,w],G=n-t*2-r*2,J=e-i*2-d*2,Z=G+r*2,R=J+d*2;l.style.position="fixed",l.style.display="block",l.style.width=`${Z}px`,l.style.height=`${R}px`,l.style.overflow="hidden",l.style.zIndex="9999",l.style.marginLeft="0",t===0&&i===0?(l.style.top="0",l.style.left="0",l.style.transform="none",l.style.borderRadius="0",l.style.boxShadow="none"):(l.style.top=`${i}px`,l.style.left=`${t}px`,l.style.transform="none",l.style.borderRadius="8px",l.style.boxShadow="0 8px 32px rgba(0,0,0,0.3)"),l.classList.add("expanded"),l.style.padding=`${d}px ${r}px`;const E=l.querySelector("figure");E&&(E._savedMargin=E._savedMargin??E.style.margin,E.style.margin="0"),O(G,J)}function I(){if(p=!0,x&&(x.expanded=!0),c.classList.add("expandable-expanded"),a.innerHTML="✕",a.title="Collapse",a.style.top="8px",a.style.right="8px",u.parentNode||document.body.appendChild(u),u.style.opacity="1",u.style.pointerEvents="auto",A?c.style.height=`${A}px`:c.style.height=`${c.offsetHeight}px`,$.length>0&&o){const n=o.querySelector(".expandable-controls-content");if(n)for(const e of $){const t=typeof e=="string"?document.querySelector(e):e;if(!t||!t.parentNode)continue;const i=document.createElement("div");i.className="expandable-controls-placeholder",i.style.height=`${t.offsetHeight}px`,i.style.display="block",g.push({element:t,selector:typeof e=="string"?e:null,originalParent:t.parentNode,originalNextSibling:t.nextSibling,placeholder:i}),t.parentNode.insertBefore(i,t),n.appendChild(t)}if(g.length>0){o.parentNode||document.body.appendChild(o),o.classList.add("expandable-expanded"),o.style.display="",o.style.left=`${s.x}px`,o.style.top=`${s.y}px`,b=!(window.innerWidth<640);const t=o.querySelector(".expandable-controls-content"),i=o.querySelector(".expandable-controls-toggle");b?(t&&(t.style.display="flex"),i&&(i.innerHTML="▼",i.title="Collapse controls")):(t&&(t.style.display="none"),i&&(i.innerHTML="▶",i.title="Expand controls"))}}_(),V()}a.addEventListener("click",n=>{n.stopPropagation(),p?T():I()});const j=()=>{p?_():S&&W()};window.addEventListener("resize",j);const K=n=>{n.key==="Escape"&&p&&T()};document.addEventListener("keydown",K);const z=new MutationObserver(()=>{document.contains(c)||(document.removeEventListener("keydown",K),window.removeEventListener("resize",j),X(),u.parentNode&&u.remove(),D(),o&&o.parentNode&&o.remove(),z.disconnect())});return z.observe(document.body,{childList:!0,subtree:!0}),Object.defineProperty(c,"expandedDimensions",{get:()=>({width:H,height:P,expanded:p})}),x?.expanded&&requestAnimationFrame(()=>{I()}),c}export{te as expandable};
