import{d as y,_ as E}from"./index-ByB2dbry.js";y({root:document.getElementById("cell-3"),expanded:[],variables:[]},{id:3,body:async()=>{const[{default:a},{LRUCache:r},{default:i},{expandable:c}]=await Promise.all([E(()=>import("https://cdn.jsdelivr.net/npm/mapbox-gl@3.7.0/+esm"),[]).then(t=>{if(!("default"in t))throw new SyntaxError("export 'default' not found");return t}),E(()=>import("https://cdn.jsdelivr.net/npm/lru-cache@11/+esm"),[]).then(t=>{if(!("LRUCache"in t))throw new SyntaxError("export 'LRUCache' not found");return t}),E(()=>import("./download-control-CwMAxf1Y.js"),[]).then(t=>{if(!("default"in t))throw new SyntaxError("export 'default' not found");return t}),E(()=>import("./expandable-dZkDG0zz.js"),[]).then(t=>{if(!("expandable"in t))throw new SyntaxError("export 'expandable' not found");return t})]);return{mapboxgl:a,LRUCache:r,SnapshotControl:i,expandable:c}},inputs:[],outputs:["mapboxgl","LRUCache","SnapshotControl","expandable"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});y({root:document.getElementById("cell-4"),expanded:[],variables:[]},{id:4,body:(a,r,i,c)=>{const t=a`<div class="map-wrapper" style="position: relative;">
  <div class="map-container" id="map-container"></div>
  <div id="date-display"></div>
</div>`,e={expanded:!1,resizeMap:null},n=r(t,{width:Math.min(i,900),height:600,controls:".controls-panel",state:e,onResize(d,l,s){const u=d.querySelector("#map-container");u&&(u.style.width=`${l}px`,u.style.height=`${s}px`),e.resizeMap&&e.resizeMap()}});return c(n),{wrapper:t,expandableState:e,container:n}},inputs:["html","expandable","width","display"],outputs:["wrapper","expandableState","container"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});y({root:document.getElementById("cell-5"),expanded:[],variables:[]},{id:5,body:(a,r,i,c)=>{const t=a`<div class="controls-panel"></div>`,e={};function n(g,o){const b=a`<div></div>`;return b.appendChild(g),t.appendChild(b),o&&(e[o]=g),r.input(g)}const d=n(i.toggle({label:"Live",value:!0})),l=n(i.date({label:"Date",value:new Date().toISOString().slice(0,10),disabled:!0}),"date"),s=n(i.range([0,24],{label:"Hour (UTC)",value:new Date().getUTCHours()+new Date().getUTCMinutes()/60,step:.1,disabled:!0}),"hourOfDay"),u=n(i.range([0,1],{label:"Opacity",value:.93,step:.01})),f=n(i.range([0,90],{label:"Dawn altitude (°)",value:6,step:.1})),p=n(i.range([-90,0],{label:"Twilight altitude (°)",value:-6,step:.1})),h=n(i.range([0,1],{label:"Step strength",value:0,step:.01})),m=n(i.select(["globe","mercator","naturalEarth","winkelTripel"],{label:"Projection",value:"mercator"}));return c(t),{controlsContainer:t,inputElements:e,ctrl:n,live:d,date:l,hourOfDay:s,opacity:u,dawnAltitude:f,twilightAltitude:p,stepStrength:h,projection:m}},inputs:["html","Generators","Inputs","display"],outputs:["controlsContainer","inputElements","ctrl","live","date","hourOfDay","opacity","dawnAltitude","twilightAltitude","stepStrength","projection"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});y({root:document.getElementById("cell-6"),expanded:[],variables:[]},{id:6,body:(a,r)=>{for(const i of a.date.querySelectorAll("input"))i.disabled=r;for(const i of a.hourOfDay.querySelectorAll("input"))i.disabled=r;a.date.style.opacity=r?.5:1,a.hourOfDay.style.opacity=r?.5:1},inputs:["inputElements","live"],outputs:[],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});y({root:document.getElementById("cell-7"),expanded:[],variables:[]},{id:7,body:()=>{const a=new Date,r={live:!0,date:a,hourOfDay:a.getUTCHours()+a.getUTCMinutes()/60,opacity:.93,dawnAltitude:6,twilightAltitude:-6,stepStrength:0,projection:"mercator"};return{now:a,params:r}},inputs:[],outputs:["now","params"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});y({root:document.getElementById("cell-8"),expanded:[],variables:[]},{id:8,body:(a,r,i,c,t,e,n,d,l,s)=>{a.live=r,a.date=i,a.hourOfDay=c,a.opacity=t,a.dawnAltitude=e,a.twilightAltitude=n,a.stepStrength=d,a.projection=l,s()},inputs:["params","live","date","hourOfDay","opacity","dawnAltitude","twilightAltitude","stepStrength","projection","updateMap"],outputs:[],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});y({root:document.getElementById("cell-9"),expanded:[],variables:[]},{id:9,body:()=>{const a=Math.PI,r=Math.sin,i=Math.cos,c=Math.atan2,t=a/180,e=t*23.4397;function n(o){return c(r(o)*i(e),i(o))}function d(o){return r(e)*r(o)}function l(o){return t*(357.5291+.98560028*o)}function s(o){const b=t*(1.9148*r(o)+.02*r(2*o)+3e-4*r(3*o)),w=t*102.9372;return o+b+w+a}function u(o){const b=l(o),w=s(b),x=d(w);return{sinDec:x,cosDec:Math.sqrt(Math.max(0,1-x*x)),ra:n(w)}}const f=1e3*60*60*24,p=2440588,h=2451545;function m(o){return o.valueOf()/f-.5+p}function g(o){return m(o)-h}return{PI:a,sin:r,cos:i,atan:c,rad:t,obliquity:e,rightAscension:n,sineDeclination:d,solarMeanAnomaly:l,eclipticLongitude:s,sunCoords:u,dayMs:f,J1970:p,J2000:h,toJulian:m,toDays:g}},inputs:[],outputs:["PI","sin","cos","atan","rad","obliquity","rightAscension","sineDeclination","solarMeanAnomaly","eclipticLongitude","sunCoords","dayMs","J1970","J2000","toJulian","toDays"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});y({root:document.getElementById("cell-10"),expanded:[],variables:[]},{id:10,body:()=>{function a(t,e,n){const d=t.createShader(e);if(t.shaderSource(d,n),t.compileShader(d),!t.getShaderParameter(d,t.COMPILE_STATUS))throw new Error("Shader compile error: "+t.getShaderInfoLog(d));return d}class r{constructor({gl:e,vert:n,frag:d}){this.gl=e;const l=a(e,e.VERTEX_SHADER,n),s=a(e,e.FRAGMENT_SHADER,d);if(this.program=e.createProgram(),e.attachShader(this.program,l),e.attachShader(this.program,s),e.linkProgram(this.program),!e.getProgramParameter(this.program,e.LINK_STATUS))throw new Error("Shader link error")}use(){this.gl.useProgram(this.program)}getUniformLocations(e){const n={};for(const d of e)n[d]=this.gl.getUniformLocation(this.program,d);return n}getAttribLocations(e){const n={};for(const d of e)n[d]=this.gl.getAttribLocation(this.program,d);return n}}class i{constructor({gl:e,width:n,height:d,data:l,format:s,type:u,min:f,mag:p}){this.gl=e;const h=ArrayBuffer.isView(l)||!l;this.format=s??e.RGBA,this.type=u??e.UNSIGNED_BYTE,this.width=h?n:l.width,this.height=h?d:l.height,this.min=f??e.NEAREST,this.mag=p??e.NEAREST,this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),h?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,l||null):e.texImage2D(e.TEXTURE_2D,0,this.format,this.format,this.type,l),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this.min),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,this.mag),this.unbind()}bind(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture)}unbind(){this.gl.bindTexture(this.gl.TEXTURE_2D,null)}subData({data:e,xoffset:n=0,yoffset:d=0,format:l,type:s}){const u=this.gl;this.bind(),u.texSubImage2D(u.TEXTURE_2D,0,n,d,l||this.format,s||this.type,e),this.unbind()}}class c{constructor({gl:e,data:n}){this.gl=e,this.buffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null)}bind(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer)}}return{makeShader:a,Program:r,Texture:i,Buffer:c}},inputs:[],outputs:["makeShader","Program","Texture","Buffer"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});y({root:document.getElementById("cell-11"),expanded:[],variables:[]},{id:11,body:(a,r,i,c,t,e)=>{function n(l,s,u){const f=Math.pow(2,u),p=20037508342789244e-9,h=p*(-1+2*l/f),m=p*(1-2*(s+1)/f),g=p*(-1+2*(l+1)/f),o=p*(1-2*s/f);return[h,m,g,o]}class d{constructor(s){this.canvas=s;const u=s.getContext("webgl",{willReadFrequently:!0,antialias:!1,depth:!1,stencil:!1,preserveDrawingBuffer:!0});this.gl=u,this.tileTex=new a({gl:u,width:s.width,height:s.height}),this.vertexBuffer=new r({gl:u,data:new Float32Array([-4,-4,4,-4,0,4])}),this.program=new i({gl:u,vert:`precision lowp float;
        attribute vec2 xy;
        void main () { gl_Position = vec4(xy, 0, 1); }`,frag:`precision highp float;
        uniform vec2 resolution, fadeRange;
        uniform vec3 sunCoords;
        uniform vec4 aabb;
        uniform float days, siderealTimeOffset, stepping;
        uniform sampler2D texture;

        vec2 toWgs84Rad(vec2 xy) {
          return vec2(xy.x, ${Math.PI/2} - 2.0 * atan(exp(-xy.y)));
        }

        float getSunAltitude(float days, vec2 lngLat, vec3 sunCoords, float siderealTimeOffset) {
          float H = siderealTimeOffset + lngLat.x - sunCoords.z;
          return asin(clamp(sin(lngLat.y) * sunCoords.x + cos(lngLat.y) * sunCoords.y * cos(H), -1.0, 1.0));
        }

        float linearstep(float edge0, float edge1, float value) {
          return clamp((value - edge0) / (edge1 - edge0), 0.0, 1.0);
        }

        float smootherstep(float edge0, float edge1, float value) {
          float x = clamp((value - edge0) / (edge1 - edge0), 0.0, 1.0);
          return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);
        }

        float steppedstep(float x, float d, float fraction) {
          float xd = x / d;
          float param = smootherstep(-1.0, 1.0, 2.0 * (xd - floor(xd - 0.5) - 1.0) / fraction);
          return d * (param + 0.5 + floor(xd - 0.5));
        }

        void main() {
          vec2 uv = gl_FragCoord.xy / resolution;
          vec2 xy = aabb.xw + (aabb.zy - aabb.xw) * uv;
          vec2 lngLatRad = toWgs84Rad(xy);
          float altitude = getSunAltitude(days, lngLatRad, sunCoords, siderealTimeOffset);

          const float step = 6.0;
          float angle = altitude * (180.0 / ${Math.PI});
          float withStep = linearstep(fadeRange.x + step * 0.5, fadeRange.y - step * 0.5, steppedstep(angle, step, 1.0 - stepping));
          float smoothed = smootherstep(fadeRange.x * 2.0, fadeRange.y * 2.0, angle);

          gl_FragColor = texture2D(texture, uv) * mix(smoothed, withStep, stepping);
        }`}),this.attribs=this.program.getAttribLocations(["xy"]),this.vertexBuffer.bind(),u.vertexAttribPointer(this.attribs.xy,2,u.FLOAT,!1,0,0),u.viewport(0,0,s.width,s.height),this.uniforms=this.program.getUniformLocations(["resolution","aabb","sunCoords","days","fadeRange","stepping","texture","siderealTimeOffset"])}render({x:s=0,y:u=0,z:f=0,date:p=Date.now(),fadeRange:h=[0,-18],texture:m=null,stepping:g=0}={}){const o=this.gl,{width:b,height:w}=this.canvas;m&&this.tileTex.subData({data:m}),this.program.use(),o.enableVertexAttribArray(this.attribs.xy);const x=c(p===void 0?Date.now():p),T=t(x),R=Math.PI/180*(280.16+360.9856235*x)%(2*Math.PI),v=n(s,u,f).map(S=>S/6378137);o.uniform4fv(this.uniforms.aabb,v),o.uniform2f(this.uniforms.resolution,b,w),o.uniform3f(this.uniforms.sunCoords,T.sinDec,T.cosDec,T.ra),o.uniform1f(this.uniforms.days,x),o.uniform1f(this.uniforms.siderealTimeOffset,R),o.uniform1f(this.uniforms.stepping,g);const _=.5*(h[0]+h[1]),D=1e-15;o.uniform2f(this.uniforms.fadeRange,Math.max(_+D,h[0]),Math.min(_-D,h[1])),o.activeTexture(o.TEXTURE0),this.tileTex.bind(),o.uniform1i(this.uniforms.texture,0),o.drawArrays(o.TRIANGLES,0,3)}async getImageBitmap(){return await e(this.canvas,{imageOrientation:"flipY"})}}return{tileBounds3857:n,TerminatorTiler:d}},inputs:["Texture","Buffer","Program","toDays","sunCoords","createImageBitmap"],outputs:["tileBounds3857","TerminatorTiler"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});y({root:document.getElementById("cell-12"),expanded:[],variables:[]},{id:12,body:(a,r)=>{class i{constructor({tileSize:t=256,fadeRange:e=[12,-12],is2x:n=devicePixelRatio>1,fetchTileImageBitmap:d,date:l=null,stepping:s=0}={}){this.type="custom",this.tileSize=t;const u=n?512:256,f=document.createElement("canvas");f.width=u,f.height=u,this.tiler=new a(f),this._fadeRange=e,this._date=l??new Date,this._stepping=s??0,this.tileBitmapCache=new r({max:50,fetchMethod:d})}clear(){this.update&&this.update()}set fadeRange(t){this._fadeRange=t,this.clear()}set stepping(t){this._stepping=t,this.clear()}set date(t){this._date=t,this.clear()}async loadTile({x:t,y:e,z:n}){return this.tiler.render({x:t,y:e,z:n,date:this._date,fadeRange:this._fadeRange,stepping:this._stepping,texture:await this.tileBitmapCache.fetch(`${n}/${t}/${e}`)}),await this.tiler.getImageBitmap()}}return{TerminatorSource:i}},inputs:["TerminatorTiler","LRUCache"],outputs:["TerminatorSource"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});y({root:document.getElementById("cell-13"),expanded:[],variables:[]},{id:13,body:async(a,r,i,c,t,e,n,d)=>{a.accessToken="pk.eyJ1IjoicnNyZXVzc2VyIiwiYSI6ImNtYnh6eGdoejFpZXMya3B1azNxcjM4a3gifQ.U3_1xdf6dopJTX3TAuWAiQ";const l=r.querySelector("#map-container"),s=new a.Map({container:l,zoom:1,center:[0,10],style:"mapbox://styles/rreusser/cl9kvd6ip000c15mudn99xvi7?fresh=true",projection:i.projection,hash:!1,preserveDrawingBuffer:!0});c.resizeMap=()=>s.resize();const u=r.querySelector("#date-display"),f={terminatorRenderer:null,ready:!1};await s.once("load");const p=window.devicePixelRatio>1,h=256,m=new t({date:Date.now(),tileSize:h,is2x:p,stepping:i.stepStrength,fadeRange:[i.dawnAltitude,i.twilightAltitude],fetchTileImageBitmap:async function(g){const[o,b,w]=g.split("/"),x=p?"@2x":"",T=s._requestManager._skuToken,R=`https://api.mapbox.com/v4/rsreusser.blackmarble/${o}/${b}/${w}${x}.webp?sku=${T}&access_token=${a.accessToken}`,v=await fetch(R);if(!v.ok)throw new Error(`Tile fetch failed: ${v.status} ${v.statusText}`);return await e(await v.blob())}});return s.addSource("solar-terminator",m),s.addLayer({id:"solar-terminator",source:"solar-terminator",type:"raster",paint:{"raster-fade-duration":0,"raster-opacity":i.opacity}}),f.terminatorRenderer=m,f.ready=!0,s.addControl(new n,"bottom-left"),d.then(()=>s.remove()),{mapContainer:l,map:s,dateDisplay:u,mapState:f,is2x:p,tileSize:h,terminatorRenderer:m}},inputs:["mapboxgl","wrapper","params","expandableState","TerminatorSource","createImageBitmap","SnapshotControl","invalidation"],outputs:["mapContainer","map","dateDisplay","mapState","is2x","tileSize","terminatorRenderer"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});y({root:document.getElementById("cell-14"),expanded:[],variables:[]},{id:14,body:(a,r,i,c)=>{function t(){if(a.live)return new Date;const n=a.date;return new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0)+a.hourOfDay*3600*1e3)}function e(){if(!r.ready||!r.terminatorRenderer)return;const n=r.terminatorRenderer;n.fadeRange=[a.dawnAltitude,a.twilightAltitude],n.stepping=a.stepStrength,n.date=t(),i.setPaintProperty("solar-terminator","raster-opacity",a.opacity),i.setProjection({name:a.projection}),c.textContent=t().toLocaleString()}return{getDateFromParams:t,updateMap:e}},inputs:["params","mapState","map","dateDisplay"],outputs:["getDateFromParams","updateMap"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});y({root:document.getElementById("cell-15"),expanded:[],variables:[]},{id:15,body:(a,r,i)=>{a();let c;return r.live&&(c=setInterval(a,1e3)),i.then(()=>clearInterval(c)),{interval:c}},inputs:["updateMap","params","invalidation"],outputs:["interval"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});
