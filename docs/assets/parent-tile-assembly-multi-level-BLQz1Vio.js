function A(r,s){const{x:f,y:x,z:y}=r;if(s>=0)throw new Error("deltaZ must be negative (parent zoom levels)");const e=y+s;if(e<0)throw new Error(`Parent zoom level ${e} is invalid (must be >= 0)`);const c=Math.abs(s),o=Math.pow(2,c),t=Math.floor(f/o),n=Math.floor(x/o),l=Math.floor((f/o-t)*2),p=Math.floor((x/o-n)*2),a=[];a.push({x:t,y:n,z:e,role:"parent-base"});const u=Math.pow(2,e)-1;return l===0&&t>0?a.push({x:t-1,y:n,z:e,role:"parent-west"}):l===1&&t<u&&a.push({x:t+1,y:n,z:e,role:"parent-east"}),p===0&&n>0?a.push({x:t,y:n-1,z:e,role:"parent-north"}):p===1&&n<u&&a.push({x:t,y:n+1,z:e,role:"parent-south"}),l===0&&p===0&&t>0&&n>0?a.push({x:t-1,y:n-1,z:e,role:"parent-nw"}):l===1&&p===0&&t<u&&n>0?a.push({x:t+1,y:n-1,z:e,role:"parent-ne"}):l===0&&p===1&&t>0&&n<u?a.push({x:t-1,y:n+1,z:e,role:"parent-sw"}):l===1&&p===1&&t<u&&n<u&&a.push({x:t+1,y:n+1,z:e,role:"parent-se"}),a}function $({targetTile:r,parentTiles:s,deltaZ:f,tileSize:x=512}){if(f>=0)throw new Error("deltaZ must be negative");const y=Math.abs(f),e=Math.pow(2,y),c=1024,o=new Float32Array(c*c),t=Math.floor(x*(1+Math.pow(2,f))),n=new Map(s.map(i=>[i.role,i])),{x:l,y:p,z:a}=r,u=Math.floor(l/e),m=Math.floor(p/e),v=Math.floor((l/e-u)*2),Y=Math.floor((p/e-m)*2),M=[["nw","ne"],["sw","se"]][Y][v],g=L(M);for(const[i,h]of Object.entries(g)){const d=n.get(i);d&&O(d,o,h,c)}const b=I(M,w),z=new Float32Array(t*t);for(let i=0;i<t;i++)for(let h=0;h<t;h++){const d=h+b.x,X=(i+b.y)*c+d,E=i*t+h;z[E]=o[X]}const w=x/e,q=[Math.floor((t-w)/2),Math.floor((t-w)/2)];return{buffer:z,size:t,targetOffset:q,scale:e,targetSizeAtParent:w}}function L(r){switch(r){case"nw":return{"parent-nw":{x:0,y:0},"parent-north":{x:512,y:0},"parent-west":{x:0,y:512},"parent-base":{x:512,y:512}};case"ne":return{"parent-north":{x:0,y:0},"parent-ne":{x:512,y:0},"parent-base":{x:0,y:512},"parent-east":{x:512,y:512}};case"sw":return{"parent-west":{x:0,y:0},"parent-base":{x:512,y:0},"parent-sw":{x:0,y:512},"parent-south":{x:512,y:512}};case"se":return{"parent-base":{x:0,y:0},"parent-east":{x:512,y:0},"parent-south":{x:0,y:512},"parent-se":{x:512,y:512}};default:throw new Error(`Unknown quadrant: ${r}`)}}function O(r,s,f,x){const y=r.tileSize,e=1;for(let c=0;c<y;c++)for(let o=0;o<y;o++){const t=o+e,l=(c+e)*r.width+t,p=f.x+o,u=(f.y+c)*x+p;s[u]=r.data[l]}}function I(r,s){switch(r){case"nw":return{x:256,y:256};case"ne":return{x:256-s,y:256};case"sw":return{x:256,y:256-s};case"se":return{x:256-s,y:256-s};default:throw new Error(`Unknown quadrant: ${r}`)}}export{$ as assembleParentTileBufferMultiLevel,A as getParentTilesAtLevel};
