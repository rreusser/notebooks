function $(c,f){var t=0;return Math.abs(c)>Math.abs(f)?(t=f/c,Math.abs(c)*Math.sqrt(1+t*t)):f!==0?(t=c/f,Math.abs(f)*Math.sqrt(1+t*t)):0}function d(c,f,t,i){var l,s,v,o,r,a,n,e;for(r=0;r<c;r++)t[r]=i[c-1][r];for(o=c-1;o>0;o--){for(e=0,v=0,a=0;a<o;a++)e=e+Math.abs(t[a]);if(e===0)for(f[o]=t[o-1],r=0;r<o;r++)t[r]=i[o-1][r],i[o][r]=0,i[r][o]=0;else{for(a=0;a<o;a++)t[a]/=e,v+=t[a]*t[a];for(l=t[o-1],s=Math.sqrt(v),l>0&&(s=-s),f[o]=e*s,v=v-l*s,t[o-1]=l-s,r=0;r<o;r++)f[r]=0;for(r=0;r<o;r++){for(l=t[r],i[r][o]=l,s=f[r]+i[r][r]*l,a=r+1;a<=o-1;a++)s+=i[a][r]*t[a],f[a]+=i[a][r]*l;f[r]=s}for(l=0,r=0;r<o;r++)f[r]/=v,l+=f[r]*t[r];for(n=l/(v+v),r=0;r<o;r++)f[r]-=n*t[r];for(r=0;r<o;r++){for(l=t[r],s=f[r],a=r;a<=o-1;a++)i[a][r]-=l*f[a]+s*t[a];t[r]=i[o-1][r],i[o][r]=0}}t[o]=v}for(o=0;o<c-1;o++){if(i[c-1][o]=i[o][o],i[o][o]=1,v=t[o+1],v!==0){for(a=0;a<=o;a++)t[a]=i[a][o+1]/v;for(r=0;r<=o;r++){for(s=0,a=0;a<=o;a++)s+=i[a][o+1]*i[a][r];for(a=0;a<=o;a++)i[a][r]-=s*t[a]}}for(a=0;a<=o;a++)i[a][o+1]=0}for(r=0;r<c;r++)t[r]=i[c-1][r],i[c-1][r]=0;i[c-1][c-1]=1,f[0]=0}function rr(c,f,t,i){var l,s,v,o,r,a,n,e,M,b,u,m,x,w,h,U;for(v=1;v<c;v++)f[v-1]=f[v];f[c-1]=0;var X=0,A=0,Y=Number.EPSILON;for(a=0;a<c;a++){for(A=Math.max(A,Math.abs(t[a])+Math.abs(f[a])),n=a;n<c&&!(Math.abs(f[n])<=Y*A);)n++;if(n>a)do{for(l=t[a],e=(t[a+1]-l)/(2*f[a]),M=$(e,1),e<0&&(M=-M),t[a]=f[a]/(e+M),t[a+1]=f[a]*(e+M),b=t[a+1],s=l-t[a],v=a+2;v<c;v++)t[v]-=s;for(X=X+s,e=t[n],u=1,m=u,x=u,w=f[a+1],h=0,U=0,v=n-1;v>=a;v--)for(x=m,m=u,U=h,l=u*f[v],s=u*e,M=$(e,f[v]),f[v+1]=h*M,h=f[v]/M,u=e/M,e=u*t[v]-h*l,t[v+1]=s+h*(u*l+h*t[v]),r=0;r<c;r++)s=i[r][v+1],i[r][v+1]=h*i[r][v]+u*s,i[r][v]=u*i[r][v]-h*s;e=-h*U*x*w*f[a]/b,f[a]=h*e,t[a]=u*e}while(Math.abs(f[a])>Y*A);t[a]=t[a]+X,f[a]=0}for(v=0;v<c-1;v++){for(r=v,e=t[v],o=v+1;o<c;o++)t[o]<e&&(r=o,e=t[o]);if(r!==v)for(t[r]=t[v],t[v]=e,o=0;o<c;o++)e=i[o][v],i[o][v]=i[o][r],i[o][r]=e}}function ar(c){var f,t,i,l,s,v;for(i=c.length,l=new Array(i),f=0;f<i;f++)for(l[f]=new Array(i),t=0;t<i;t++)l[f][t]=0;for(s=new Array(i),v=new Array(i),f=0;f<i;f++)for(t=0;t<i;t++)l[f][t]=c[f][t];return d(i,v,s,l),rr(i,v,s,l),[s,v,l]}function tr(c,{vec3:f}){c=Array.isArray(c)?c:[c];for(var t,i,l,s,v,o,r,a,n,e,M,b,u,m,x,w,h,U,X,A,Y,p,E=0,F=0,L=0,O=0,D=0,G=0,H=0,I=0,J=0,k=0,K=0,Q=0,R=0,N=0;N<c.length;N++)for(var P=c[N],S=P.faces,Z=P.vertices,y=P.count,j=0;j<y;j++){var z=j*3;t=S[z]*3,i=S[z+1]*3,l=S[z+2]*3,s=Z[t],v=Z[t+1],o=Z[t+2],r=Z[i],a=Z[i+1],n=Z[i+2],e=Z[l],M=Z[l+1],b=Z[l+2],u=r-s,m=a-v,x=n-o,w=e-s,h=M-v,U=b-o,X=.5*(m*U-x*h),A=.5*(x*w-u*U),Y=.5*(u*h-m*w),p=Math.sqrt(X*X+A*A+Y*Y),k+=p,K+=p*(s+r+e)/3,Q+=p*(v+a+M)/3,R+=p*(o+n+b)/3,H+=X,I+=A,J+=Y,E+=X*X,F+=X*A,L+=X*Y,O+=A*A,D+=A*Y,G+=Y*Y}var V=[[E,0,0],[F,O,0],[L,D,G]],T=ar(V),B=T[0],W=T[2],g=f.fromValues(W[0][0],W[1][0],W[2][0]),q=f.fromValues(W[0][1],W[1][1],W[2][1]),_=f.fromValues(H,I,J);f.dot(_,g)<0&&f.scale(g,g,-1),f.dot(_,q)<0&&f.scale(q,q,-1);var C=f.cross(f.create(),g,q);return f.normalize(C,C),{matrix:new Float32Array([g[0],g[1],g[2],0,q[0],q[1],q[2],0,C[0],C[1],C[2],0,0,0,0,1]),strengths:[Math.sqrt(1/B[0]),Math.sqrt(1/B[1]),Math.sqrt(1/B[2])],centroid:f.fromValues(K/k,Q/k,R/k),surfaceArea:k}}export{tr as calculatePrincipalAxesAndCentroid};
