const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vortex-panel-solver-B-e-yMWK.js","assets/compute-winding-2zH5-t52.js"])))=>i.map(i=>d[i]);
import{d as E,_ as K}from"./index-ByB2dbry.js";E({root:document.getElementById("cell-2"),expanded:[],variables:[]},{id:2,body:(e,t,i,p,d,n,l)=>{const o=e`<figure id="panel-solver-figure">
  ${t.element}
  <figcaption>Pressure field around a NACA 4-digit airfoil. Drag to pan, scroll to zoom.</figcaption>
</figure>`;return i(p(o,{width:Math.min(d,800),height:Math.min(500,d*.625),toggleOffset:[-14,-82],controls:".panel-solver-controls",onResize(h,u,m){t.resize(u,m),n.updateScales(t.elements.plot.scale("x"),t.elements.plot.scale("y")),l.dirty=!0,l.render&&l.render()}})),{figure:o}},inputs:["html","stack","display","expandable","width","axes","renderState"],outputs:["figure"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-3"),expanded:[],variables:[]},{id:3,body:(e,t,i,p)=>{const d=e`<div class="panel-solver-controls"></div>`;function n(C){return d.appendChild(C),t.input(C)}const l=n(i.range([-20,20],{label:"Angle of attack",value:7,step:.1})),o=n(i.range([10,200],{label:"Panel count",value:40,step:1})),h=n(i.range([-.2,.2],{label:"Camber (m)",value:.04,step:.001})),u=n(i.range([.2,.8],{label:"Camber location (p)",value:.4,step:.01})),m=n(i.range([.01,.5],{label:"Thickness (t)",value:.12,step:.01})),j=n(i.toggle({label:"Kutta condition",value:!0})),b=!0,a=.05,c=1,k=1,x=3,y=.9,v=.15,_=5,P=n(i.range([0,1],{label:"Shading opacity",value:.15,step:.01})),r=n(i.range([0,2e3],{label:"Streamline count",value:500,step:1})),$=n(i.range([0,1],{label:"Streamline opacity",value:.3,step:.01})),s=n(i.range([5,40],{label:"Streamline length",value:20,step:1})),M=n(i.toggle({label:"Force at quarter-chord (AC)",value:!0})),D=n(i.toggle({label:"Show pressure distribution",value:!0})),L=n(i.range([.01,.1],{label:"Pressure scale",value:.01,step:.005})),w=n(i.range([0,50],{label:"Pressure offset (Cp)",value:10,step:.1}));return p(d),{controlsContainer:d,ctrl:n,alpha:l,panelCount:o,camber:h,camberLoc:u,thickness:m,kuttaCondition:j,clustering:b,contourOpacity:a,fillOpacity:c,edgeOpacity:k,edgeWidth:x,vertexOpacity:y,forceArrowScale:v,pointSize:_,shadingOpacity:P,streamlineCount:r,streamlineOpacity:$,streamlineLength:s,forceAtQuarterChord:M,showPressureDist:D,pressureScale:L,pressureOffset:w}},inputs:["html","Generators","Inputs","display"],outputs:["controlsContainer","ctrl","alpha","panelCount","camber","camberLoc","thickness","kuttaCondition","clustering","contourOpacity","fillOpacity","edgeOpacity","edgeWidth","vertexOpacity","forceArrowScale","pointSize","shadingOpacity","streamlineCount","streamlineOpacity","streamlineLength","forceAtQuarterChord","showPressureDist","pressureScale","pressureOffset"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-4"),expanded:[],variables:[]},{id:4,body:(e,t,i)=>{e(t`<div style="font-family: var(--sans-serif); margin-top: 0.5em;">
  <strong>Lift coefficient:</strong> ${i.toFixed(4)}
</div>`)},inputs:["display","html","liftCoeff"],outputs:[],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-55"),expanded:[],variables:[]},{id:55,body:(e,t,i)=>{const d={left:30,right:30,top:25,bottom:25},n=400-d.left-d.right,l=[-.05,1.05],o=[-.12,.12],h=l[1]-l[0],u=o[1]-o[0],m=n*u/h,j=m+d.top+d.bottom,b=e.create("svg").attr("width",400).attr("height",j).attr("viewBox",`0 0 400 ${j}`).style("max-width","100%").style("display","block").style("margin","1em auto"),a=.02,c=.4,k=.12,x=11,y=[];for(let r=0;r<x;r++){const $=Math.PI*r/(x-1),s=.5*(1-Math.cos($));let M,D;s<c?(M=a/(c*c)*(2*c*s-s*s),D=2*a/(c*c)*(c-s)):(M=a/((1-c)*(1-c))*(1-2*c+2*c*s-s*s),D=2*a/((1-c)*(1-c))*(c-s));const L=5*k*(.2969*Math.sqrt(s)-.126*s-.3516*s*s+.2843*s*s*s-.1015*s*s*s*s),w=Math.atan(D),C=s-L*Math.sin(w),S=M+L*Math.cos(w),f=s+L*Math.sin(w),g=M-L*Math.cos(w);r===0?y.push([C,S]):r===x-1?y.push([C,S]):(y.unshift([f,g]),y.push([C,S]))}const v=e.scaleLinear().domain(l).range([d.left,d.left+n]),_=e.scaleLinear().domain(o).range([d.top+m,d.top]),P=y.map((r,$)=>`${$===0?"M":"L"} ${v(r[0])} ${_(r[1])}`).join(" ")+" Z";b.append("path").attr("d",P).attr("fill","#ddd").attr("stroke","none");for(let r=0;r<y.length;r++){const $=y[r],s=y[(r+1)%y.length];b.append("line").attr("x1",v($[0])).attr("y1",_($[1])).attr("x2",v(s[0])).attr("y2",_(s[1])).attr("stroke","#333").attr("stroke-width",2)}for(const r of y)b.append("circle").attr("cx",v(r[0])).attr("cy",_(r[1])).attr("r",4).attr("fill","#333");return t(i`<figure style="margin: 1em auto; max-width: 420px;">
  ${b.node()}
  <figcaption style="text-align: center; font-size: 14px; margin-top: 8px;">
    A NACA 2412 airfoil discretized into panels.
  </figcaption>
</figure>`),{w:400,margin:d,plotW:n,xDomain:l,yDomain:o,xRange:h,yRange:u,plotH:m,h:j,svg:b,m:a,p:c,t:k,nPoints:x,points:y,xScale:v,yScale:_,pathData:P}},inputs:["d3","display","html"],outputs:["w","margin","plotW","xDomain","yDomain","xRange","yRange","plotH","h","svg","m","p","t","nPoints","points","xScale","yScale","pathData"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-6"),expanded:[],variables:[]},{id:6,body:e=>{function t(d,n,l,o,h,u,m,j){const b=d-l,a=n-o,c=d-h,k=n-u,x=b*b+a*a,y=c*c+k*k;if(x<1e-10||y<1e-10)return{vx:0,vy:0};const v=h-l,_=u-o,P=Math.sqrt(v*v+_*_),r=v/P,$=_/P,s=-$,M=r,D=.5*Math.log(y/x),L=b*k-c*a,w=b*c+a*k,C=Math.atan2(L,w),S=.5/Math.PI,f=S*(m*(-D*r+C*s)+j*(C*r+D*s)),g=S*(m*(-D*$+C*M)+j*(C*$+D*M));return{vx:f,vy:g}}function i(d,n,l,o,h,u,m,j,b,a,c){const k=[];let x=d,y=n;function v(_,P){const{vx:r,vy:$}=t(_,P,l,o,h,u,m,j),s=Math.sqrt(r*r+$*$);return s<1e-10?{dx:0,dy:0,valid:!1}:{dx:r/s,dy:$/s,valid:!0}}for(let _=0;_<a&&!(x<c.xmin||x>c.xmax||y<c.ymin||y>c.ymax);_++){k.push([x,y]);const P=v(x,y);if(!P.valid)break;const r=v(x+.5*b*P.dx,y+.5*b*P.dy);if(!r.valid)break;const $=v(x+.5*b*r.dx,y+.5*b*r.dy);if(!$.valid)break;const s=v(x+b*$.dx,y+b*$.dy);if(!s.valid)break;x+=b/6*(P.dx+2*r.dx+2*$.dx+s.dx),y+=b/6*(P.dy+2*r.dy+2*$.dy+s.dy)}return k}function p(d,n,l,o=!1){const m={top:35,right:25,bottom:25,left:25},j=380-m.left-m.right,b=300-m.top-m.bottom,a=-.5,c=0,k=.5,x=0,y={xmin:-1.5,xmax:1.5,ymin:-1.2,ymax:1.2},v=e.scaleLinear().domain([y.xmin,y.xmax]).range([0,j]),_=e.scaleLinear().domain([y.ymin,y.ymax]).range([b,0]),P=e.create("svg").attr("width",380).attr("height",300).attr("viewBox","0 0 380 300").style("max-width","100%").style("background","transparent").style("border-radius","4px");P.append("text").attr("x",380/2).attr("y",22).attr("text-anchor","middle").attr("font-family","var(--sans-serif)").attr("font-size","15px").attr("font-weight","600").text(d);const r=P.append("g").attr("transform",`translate(${m.left},${m.top})`),$=[];if(o)for(let f=.15;f<=1.1;f+=.18)$.push([0,f]);else{for(let f=-6;f<=6;f+=2)Math.abs(f)>=1&&($.push([-1.4,f*.15]),$.push([1.4,f*.15]));for(let f=-4;f<=4;f+=2)$.push([f*.25,1.1]),$.push([f*.25,-1.1])}const s=e.line().x(f=>v(f[0])).y(f=>_(f[1])),M=[];for(const[f,g]of $){const A=i(f,g,a,c,k,x,n,l,.03,200,y),R=[...i(f,g,a,c,k,x,n,l,-.03,200,y).reverse(),...A.slice(1)];R.length>3&&M.push(R)}for(const f of M)r.append("path").attr("d",s(f)).attr("fill","none").attr("stroke","#4a90d9").attr("stroke-width",2).attr("stroke-opacity",.75);const D=[],L=.28,w=7;function C(f,g){for(const[A,I]of D)if(Math.sqrt((f-A)**2+(g-I)**2)<L)return!1;return!0}for(const f of M)for(let g=2;g<f.length-2;g+=3){const[A,I]=f[g];if(C(A,I)){D.push([A,I]);const[R,Q]=f[g-1],[O,V]=f[g+1],H=Math.atan2(V-Q,O-R),z=v(A),G=_(I),T=Math.cos(H),B=-Math.sin(H),X=z+w*T,q=G+w*B,F=z-w*.5*T-w*.5*-B,Y=G-w*.5*B-w*.5*T,N=z-w*.5*T+w*.5*-B,W=G-w*.5*B+w*.5*T;r.append("path").attr("d",`M${X},${q} L${F},${Y} L${N},${W} Z`).attr("fill","#4a90d9").attr("stroke","none")}}r.append("line").attr("x1",v(a)).attr("y1",_(c)).attr("x2",v(k)).attr("y2",_(x)).attr("stroke","#333").attr("stroke-width",4).attr("stroke-linecap","round"),r.append("circle").attr("cx",v(a)).attr("cy",_(c)).attr("r",4).attr("fill","#e74c3c"),r.append("circle").attr("cx",v(k)).attr("cy",_(x)).attr("r",4).attr("fill","#e74c3c");function S(f,g,A,I){r.append("text").attr("x",f).attr("y",g).attr("text-anchor",A).attr("font-family","var(--serif)").attr("font-size","14px").attr("font-style","italic").attr("fill","white").attr("stroke","white").attr("stroke-width",3).attr("stroke-linejoin","round").text(I),r.append("text").attr("x",f).attr("y",g).attr("text-anchor",A).attr("font-family","var(--serif)").attr("font-size","14px").attr("font-style","italic").attr("fill","#333").text(I)}return S(v(a)-10,_(c)+5,"end","(xⱼ, yⱼ)"),S(v(k)+10,_(x)+5,"start","(xⱼ₊₁, yⱼ₊₁)"),P.node()}return{panelVelocity:t,traceStreamline:i,createPanelDiagram:p}},inputs:["d3"],outputs:["panelVelocity","traceStreamline","createPanelDiagram"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-7"),expanded:[],variables:[]},{id:7,body:(e,t,i)=>{const p=e("Source Panel (σ = 1)",1,0,!1);return t(i`<figure style="margin: 1em auto; max-width: 400px;">
  ${p}
  <figcaption style="text-align: center; font-size: 14px; margin-top: 8px;">
    A source panel creates flow emanating perpendicular to the surface.
  </figcaption>
</figure>`),{sourceDiagram:p}},inputs:["createPanelDiagram","display","html"],outputs:["sourceDiagram"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-8"),expanded:[],variables:[]},{id:8,body:(e,t,i)=>{const p=e("Vortex Panel (γ = 1)",0,1,!0);return t(i`<figure style="margin: 1em auto; max-width: 400px;">
  ${p}
  <figcaption style="text-align: center; font-size: 14px; margin-top: 8px;">
    A vortex panel creates circulation around the panel.
  </figcaption>
</figure>`),{vortexDiagram:p}},inputs:["createPanelDiagram","display","html"],outputs:["vortexDiagram"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-58"),expanded:[],variables:[]},{id:58,body:async(e,t,i,p,d,n,l)=>{const{createInteractivePanelDiagram:o}=await K(()=>import("./interactive-panel-diagram-p_Wa_YyJ.js"),[]).then(m=>{if(!("createInteractivePanelDiagram"in m))throw new SyntaxError("export 'createInteractivePanelDiagram' not found");return m}),{controls:h,figure:u}=o({d3:e,html:t,Inputs:i,device:p,canvasFormat:d,width:n,devicePixelRatio});return l(h),l(u),{createInteractivePanelDiagram:o,controls:h,interactiveFigure:u}},inputs:["d3","html","Inputs","device","canvasFormat","width","display"],outputs:["createInteractivePanelDiagram","controls","interactiveFigure"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-57"),expanded:[],variables:[]},{id:57,body:(e,t,i)=>{const n=e.create("svg").attr("width",280).attr("height",140).attr("viewBox","0 0 280 140").style("max-width","100%").style("display","block").style("margin","1em auto"),l=-15*Math.PI/180,o=280/2,h=140/2+10,u=160,m=Math.cos(l),j=Math.sin(l),b=o-u/2*m,a=h-u/2*j,c=o+u/2*m,k=h+u/2*j,x=30,y=-j,v=m;n.append("path").attr("d",`M ${b} ${a}
              L ${c} ${k}
              L ${c+x*y} ${k+x*v}
              L ${b+x*y} ${a+x*v} Z`).attr("fill","#ddd").attr("stroke","none"),n.append("line").attr("x1",b).attr("y1",a).attr("x2",c).attr("y2",k).attr("stroke","#333").attr("stroke-width",2);const _="#4a90d9";n.append("defs").append("marker").attr("id","nonpen-arrowhead").attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerWidth",5).attr("markerHeight",5).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 Z").attr("fill",_);const P=12,r=100,$=o-r/2*m-P*y,s=h-r/2*j-P*v,M=o+r/2*m-P*y,D=h+r/2*j-P*v;return n.append("line").attr("x1",$).attr("y1",s).attr("x2",M).attr("y2",D).attr("stroke",_).attr("stroke-width",2.5).attr("marker-end","url(#nonpen-arrowhead)"),n.append("text").attr("x",M+8).attr("y",D-8).attr("font-family","var(--serif)").attr("font-size","14px").attr("font-style","italic").attr("fill",_).text("v"),t(i`<figure style="margin: 1em auto; max-width: 300px;">
  ${n.node()}
  <figcaption style="text-align: center; font-size: 14px; margin-top: 8px;">
    Flow velocity is tangent to the panel surface.
  </figcaption>
</figure>`),{w:280,h:140,svg:n,angle:l,cx:o,cy:h,panelLen:u,cos:m,sin:j,x1:b,y1:a,x2:c,y2:k,shadeDepth:x,nx:y,ny:v,arrowColor:_,arrowOffset:P,arrowLen:r,ax1:$,ay1:s,ax2:M,ay2:D}},inputs:["d3","display","html"],outputs:["w","h","svg","angle","cx","cy","panelLen","cos","sin","x1","y1","x2","y2","shadeDepth","nx","ny","arrowColor","arrowOffset","arrowLen","ax1","ay1","ax2","ay2"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-48"),expanded:[],variables:[]},{id:48,body:(e,t,i)=>{const n=e.create("svg").attr("width",320).attr("height",200).attr("viewBox","0 0 320 200").style("max-width","100%").style("display","block").style("margin","1em auto"),l=260,o=100,h=60,u=50;n.append("path").attr("d",`M ${h} ${o-u}
              L ${l} ${o}
              L ${h} ${o+u} Z`).attr("fill","#ddd").attr("stroke","none"),n.append("line").attr("x1",h).attr("y1",o-u).attr("x2",l).attr("y2",o).attr("stroke","#333").attr("stroke-width",2),n.append("line").attr("x1",h).attr("y1",o+u).attr("x2",l).attr("y2",o).attr("stroke","#333").attr("stroke-width",2);const m="#4a90d9",j=2.5;n.append("defs").append("marker").attr("id","kutta-arrowhead").attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerWidth",5).attr("markerHeight",5).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 Z").attr("fill",m);const b=6;return n.append("path").attr("d",`M ${h-20} ${o-u-15}
              Q ${h+60} ${o-u+5},
                ${l-30} ${o-14}
              Q ${l+20} ${o-b},
                ${l+50} ${o-b}`).attr("fill","none").attr("stroke",m).attr("stroke-width",j).attr("marker-end","url(#kutta-arrowhead)"),n.append("path").attr("d",`M ${h-20} ${o+u+15}
              Q ${h+60} ${o+u-5},
                ${l-30} ${o+14}
              Q ${l+20} ${o+b},
                ${l+50} ${o+b}`).attr("fill","none").attr("stroke",m).attr("stroke-width",j).attr("marker-end","url(#kutta-arrowhead)"),n.append("text").attr("x",l+10).attr("y",o+35).attr("text-anchor","middle").attr("font-family","var(--sans-serif)").attr("font-size","13px").attr("fill","#666").text("trailing edge"),t(i`<figure style="margin: 1em auto; max-width: 350px;">
  ${n.node()}
  <figcaption style="text-align: center; font-size: 14px; margin-top: 8px;">
    The Kutta condition requires flow from the upper and lower surfaces to leave the trailing edge smoothly, meeting at the same velocity.
  </figcaption>
</figure>`),{w:320,h:200,svg:n,tipX:l,tipY:o,backX:h,halfHeight:u,arrowColor:m,arrowWidth:j,sep:b}},inputs:["d3","display","html"],outputs:["w","h","svg","tipX","tipY","backX","halfHeight","arrowColor","arrowWidth","sep"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-11"),expanded:[],variables:[]},{id:11,body:(e,t)=>e`### Panel Geometry

We discretize the airfoil surface into ${t`n`} panels connecting ${t`n+1`} vertices. Each panel ${t`j`} has endpoints ${t`(x_j, y_j)`} and ${t`(x_{j+1}, y_{j+1})`}, with the control point placed at the midpoint:

${t.block`
(\xi_i, \eta_i) = \frac{1}{2}\bigl((x_i, y_i) + (x_{i+1}, y_{i+1})\bigr)
`}

The panel angle ${t`\theta_j = \text{atan2}(y_{j+1} - y_j, x_{j+1} - x_j)`} defines the local tangent ${t`\mathbf{t}_j = (\cos\theta_j, \sin\theta_j)`} and outward normal ${t`\mathbf{n}_j = (-\sin\theta_j, \cos\theta_j)`}.`,inputs:["md","tex"],outputs:[],output:void 0,assets:void 0,autodisplay:!0,autoview:!1,automutable:void 0});E({root:document.getElementById("cell-12"),expanded:[],variables:[]},{id:12,body:(e,t)=>e`### Panel Influence Coefficients

The velocity induced at a control point by a panel depends on the geometry relating them. Let ${t`\mathbf{r}_{ij}`} and ${t`\mathbf{r}_{ij+1}`} be the vectors from the endpoints of panel ${t`j`} to control point ${t`i`}:

${t.block`
\begin{aligned}
\mathbf{r}_{ij} &= (\xi_i, \eta_i) - (x_j, y_j) \\
\mathbf{r}_{ij+1} &= (\xi_i, \eta_i) - (x_{j+1}, y_{j+1})
\end{aligned}
`}

The influence coefficients are expressed in terms of two geometric quantities. The first is the angle subtended by panel ${t`j`} as seen from control point ${t`i`}:

${t.block`
\beta_{ij} = \text{atan2}\bigl(\mathbf{r}_{ij} \times \mathbf{r}_{ij+1},\; \mathbf{r}_{ij} \cdot \mathbf{r}_{ij+1}\bigr)
`}

For the self-influence case (${t`i = j`}), the control point lies on the panel itself, and ${t`\beta_{ii} = \pi \cdot w`} where ${t`w = \pm 1`} is the winding direction. The second quantity is the log-ratio of distances from the control point to the panel endpoints:

${t.block`
\lambda_{ij} = \frac{1}{2}\ln\frac{|\mathbf{r}_{ij+1}|^2}{|\mathbf{r}_{ij}|^2} = \ln\frac{|\mathbf{r}_{ij+1}|}{|\mathbf{r}_{ij}|}
`}`,inputs:["md","tex"],outputs:[],output:void 0,assets:void 0,autodisplay:!0,autoview:!1,automutable:void 0});E({root:document.getElementById("cell-13"),expanded:[],variables:[]},{id:13,body:(e,t)=>e`### Velocity Components

The induced velocity at control point ${t`i`} from panel ${t`j`} is most usefully expressed in the local coordinate system of panel ${t`i`}. With ${t`\Delta\theta_{ij} = \theta_i - \theta_j`} denoting the angle difference between panels, the normal component of velocity (positive pointing outward from the body) is

${t.block`
\begin{aligned}
v_{n,ij} = \frac{1}{2\pi}\Bigl[&\sigma_j\bigl(\sin\Delta\theta_{ij}\cdot\lambda_{ij} + \cos\Delta\theta_{ij}\cdot\beta_{ij}\bigr) \\
&+ \gamma\bigl(\cos\Delta\theta_{ij}\cdot\lambda_{ij} - \sin\Delta\theta_{ij}\cdot\beta_{ij}\bigr)\Bigr]
\end{aligned}
`}

and the tangential component (positive in the direction of increasing panel index) is

${t.block`
\begin{aligned}
v_{t,ij} = \frac{1}{2\pi}\Bigl[&\sigma_j\bigl(\sin\Delta\theta_{ij}\cdot\beta_{ij} - \cos\Delta\theta_{ij}\cdot\lambda_{ij}\bigr) \\
&+ \gamma\bigl(\sin\Delta\theta_{ij}\cdot\lambda_{ij} + \cos\Delta\theta_{ij}\cdot\beta_{ij}\bigr)\Bigr].
\end{aligned}
`}

Notice that both the source strength ${t`\sigma_j`} and the vortex strength ${t`\gamma`} contribute to both velocity components. The normal velocities enter the no-penetration condition; the tangential velocities enter the Kutta condition.`,inputs:["md","tex"],outputs:[],output:void 0,assets:void 0,autodisplay:!0,autoview:!1,automutable:void 0});E({root:document.getElementById("cell-14"),expanded:[],variables:[]},{id:14,body:(e,t)=>e`### Boundary Conditions

The no-penetration condition requires that fluid cannot pass through the airfoil surface. At each control point ${t`i`}, the total normal velocity (from all panels plus the freestream) must vanish:

${t.block`
\sum_{j=1}^{n} v_{n,ij} + v_\infty \sin(\theta_i - \alpha) = 0
`}

where ${t`\alpha`} is the angle of attack and ${t`v_\infty \sin(\theta_i - \alpha)`} is the freestream's normal component at panel ${t`i`}. Writing this condition at each of the ${t`n`} control points gives ${t`n`} linear equations in the ${t`n + 1`} unknowns.

The Kutta condition supplies the final equation. It requires that flow leaves the trailing edge smoothly rather than wrapping around at infinite velocity. Physically, this is what allows a real airfoil to generate lift. Mathematically, we enforce that the tangential velocities on the upper and lower surfaces are equal and opposite at the trailing edge:

${t.block`
v_{t,1} + v_{t,n} = 0
`}

where the total tangential velocity at panel ${t`i`} is

${t.block`
v_{t,i} = \sum_{j=1}^{n} v_{t,ij} + v_\infty \cos(\theta_i - \alpha).
`}

With ${t`n`} no-penetration equations and ${t`1`} Kutta condition, we have exactly ${t`n + 1`} equations for ${t`n + 1`} unknowns.`,inputs:["md","tex"],outputs:[],output:void 0,assets:void 0,autodisplay:!0,autoview:!1,automutable:void 0});E({root:document.getElementById("cell-15"),expanded:[],variables:[]},{id:15,body:(e,t)=>e`### Matrix Formulation
Expanding the boundary conditions and collecting coefficients, we obtain the linear system ${t`\mathbf{A}\mathbf{x} = \mathbf{b}`}. The unknown vector contains all ${t`n`} source strengths followed by the vortex strength:

${t.block`
\mathbf{x} = \begin{pmatrix} \sigma_1 \\ \sigma_2 \\ \vdots \\ \sigma_n \\ \gamma \end{pmatrix}
`}

For rows ${t`i = 1, \ldots, n`} (no-penetration):

${t.block`
\begin{aligned}
A_{ij} &= \frac{1}{2\pi}\bigl(\sin\Delta\theta_{ij}\cdot\lambda_{ij} + \cos\Delta\theta_{ij}\cdot\beta_{ij}\bigr) \\
A_{i,n+1} &= \sum_{j=1}^{n} \frac{1}{2\pi}\bigl(\cos\Delta\theta_{ij}\cdot\lambda_{ij} - \sin\Delta\theta_{ij}\cdot\beta_{ij}\bigr) \\
b_i &= v_\infty \sin(\theta_i - \alpha)
\end{aligned}
`}

For row ${t`n+1`} (Kutta condition), summing contributions from panels 1 and ${t`n`}:

${t.block`
\begin{aligned}
A_{n+1,j} &= \frac{1}{2\pi}\bigl(\sin\Delta\theta_{1j}\cdot\beta_{1j} - \cos\Delta\theta_{1j}\cdot\lambda_{1j}\bigr) \\
&\quad + \frac{1}{2\pi}\bigl(\sin\Delta\theta_{nj}\cdot\beta_{nj} - \cos\Delta\theta_{nj}\cdot\lambda_{nj}\bigr) \\[6pt]
A_{n+1,n+1} &= \sum_{j=1}^{n} \frac{1}{2\pi}\bigl(\sin\Delta\theta_{1j}\cdot\lambda_{1j} + \cos\Delta\theta_{1j}\cdot\beta_{1j} \\
&\quad + \sin\Delta\theta_{nj}\cdot\lambda_{nj} + \cos\Delta\theta_{nj}\cdot\beta_{nj}\bigr) \\[6pt]
b_{n+1} &= -v_\infty\bigl(\cos(\theta_1 - \alpha) + \cos(\theta_n - \alpha)\bigr)
\end{aligned}
`}

The result is ${t`n + 1`} equations for ${t`n + 1`} unknowns, which can be solved directly by matrix inversion. In this demo, the system is solved using LUP decomposition with partial pivoting.`,inputs:["md","tex"],outputs:[],output:void 0,assets:void 0,autodisplay:!0,autoview:!1,automutable:void 0});E({root:document.getElementById("cell-16"),expanded:[],variables:[]},{id:16,body:(e,t)=>e`### Lift Coefficient

Once solved, the circulation is ${t`\Gamma = \gamma L`} where ${t`L`} is the total panel perimeter. By the [Kutta-Joukowski theorem](https://en.wikipedia.org/wiki/Kutta%E2%80%93Joukowski_theorem):

${t.block`
C_L = \frac{2\Gamma}{c \cdot v_\infty}
`}

where ${t`c`} is the length of the airfoil cross-section, called the *chord* length.`,inputs:["md","tex"],outputs:[],output:void 0,assets:void 0,autodisplay:!0,autoview:!1,automutable:void 0});E({root:document.getElementById("cell-17"),expanded:[],variables:[]},{id:17,body:async()=>{const[{createElementStack:e},{createWebGPUContext:t,webgpuElement:i,webgpuAxesViewport:p},{createZoomableAxes:d},{expandable:n},{default:l},{default:o},{default:h},{createRenderer:u,quantizeColorscale:m,preparePanelData:j,triangulateAirfoil:b}]=await Promise.all([K(()=>import("./element-stack-BU40TvN2.js"),[]).then(a=>{if(!("createElementStack"in a))throw new SyntaxError("export 'createElementStack' not found");return a}),K(()=>import("./webgpu-canvas-C7AS78hn.js"),[]).then(a=>{if(!("createWebGPUContext"in a))throw new SyntaxError("export 'createWebGPUContext' not found");if(!("webgpuElement"in a))throw new SyntaxError("export 'webgpuElement' not found");if(!("webgpuAxesViewport"in a))throw new SyntaxError("export 'webgpuAxesViewport' not found");return a}),K(()=>import("./zoomable-axes-BfGyq1bg.js"),[]).then(a=>{if(!("createZoomableAxes"in a))throw new SyntaxError("export 'createZoomableAxes' not found");return a}),K(()=>import("./expandable-CDWt9qPP.js"),[]).then(a=>{if(!("expandable"in a))throw new SyntaxError("export 'expandable' not found");return a}),K(()=>import("./airfoil-DFtMgphh.js"),[]).then(a=>{if(!("default"in a))throw new SyntaxError("export 'default' not found");return a}),K(()=>import("./vortex-panel-solver-B-e-yMWK.js"),__vite__mapDeps([0,1])).then(a=>{if(!("default"in a))throw new SyntaxError("export 'default' not found");return a}),K(()=>import("./compute-lift-DKEnuvRt.js"),[]).then(a=>{if(!("default"in a))throw new SyntaxError("export 'default' not found");return a}),K(()=>import("./webgpu-renderer--bijGqEY.js"),[]).then(a=>{if(!("createRenderer"in a))throw new SyntaxError("export 'createRenderer' not found");if(!("quantizeColorscale"in a))throw new SyntaxError("export 'quantizeColorscale' not found");if(!("preparePanelData"in a))throw new SyntaxError("export 'preparePanelData' not found");if(!("triangulateAirfoil"in a))throw new SyntaxError("export 'triangulateAirfoil' not found");return a})]);return{createElementStack:e,createWebGPUContext:t,webgpuElement:i,webgpuAxesViewport:p,createZoomableAxes:d,expandable:n,meshAirfoil:l,solveVortexPanel:o,computeLift:h,createRenderer:u,quantizeColorscale:m,preparePanelData:j,triangulateAirfoil:b}},inputs:[],outputs:["createElementStack","createWebGPUContext","webgpuElement","webgpuAxesViewport","createZoomableAxes","expandable","meshAirfoil","solveVortexPanel","computeLift","createRenderer","quantizeColorscale","preparePanelData","triangulateAirfoil"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-18"),expanded:[],variables:[]},{id:18,body:async(e,t)=>{const{device:i,canvasFormat:p}=await e();return t.then(()=>i.destroy()),{device:i,canvasFormat:p}},inputs:["createWebGPUContext","invalidation"],outputs:["device","canvasFormat"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-19"),expanded:[],variables:[]},{id:19,body:(e,t)=>({colorscale:e(t.interpolateMagma,256)}),inputs:["quantizeColorscale","d3"],outputs:["colorscale"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-20"),expanded:[],variables:[]},{id:20,body:e=>{function t(i,p,d=[-.3,1.3],n=[-.5,.5]){return e.plot({width:i,height:p,marginTop:10,marginRight:10,marginLeft:40,marginBottom:30,style:{backgroundColor:"transparent",maxWidth:"none",position:"absolute"},x:{domain:d,grid:!1,tickSpacing:100},y:{domain:n,grid:!1,tickSpacing:100}})}return{createPlot:t}},inputs:["Plot"],outputs:["createPlot"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-21"),expanded:[],variables:[]},{id:21,body:(e,t,i,p,d,n)=>({stack:e({layers:[{id:"webgpu",element:t(i,p,{alphaMode:"premultiplied"})},{id:"plot",element:({width:o,height:h})=>d(o,h)},{id:"svg",element:({current:o,width:h,height:u})=>(o?n.select(o):n.create("svg")).attr("width",h).attr("height",u).node()}]})}),inputs:["createElementStack","webgpuElement","device","canvasFormat","createPlot","d3"],outputs:["stack"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-22"),expanded:[],variables:[]},{id:22,body:(e,t,i,p,d)=>({axes:e({d3:t,element:i.elements.svg,xScale:i.elements.plot.scale("x"),yScale:i.elements.plot.scale("y"),aspectRatio:1,onChange:({xDomain:l,yDomain:o})=>{p.dirty=!0;const h=d(i.width,i.height,l,o);i.elements.plot.replaceWith(h),i.elements.plot=h,i.dispatchEvent(new CustomEvent("update")),p.render&&p.render()}})}),inputs:["createZoomableAxes","d3","stack","renderState","createPlot"],outputs:["axes"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-23"),expanded:[],variables:[]},{id:23,body:(e,t,i,p,d)=>{const n=e.elements.webgpu._gpuContext,l={dirty:!0},o=t(i,p);return d.then(()=>o.destroy()),{gpuContext:n,renderState:l,renderer:o}},inputs:["stack","createRenderer","device","canvasFormat","invalidation"],outputs:["gpuContext","renderState","renderer"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-24"),expanded:[],variables:[]},{id:24,body:()=>({liftState:{value:0}}),inputs:[],outputs:["liftState"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-25"),expanded:[],variables:[]},{id:25,body:()=>({panelCpState:{data:null}}),inputs:[],outputs:["panelCpState"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-26"),expanded:[],variables:[]},{id:26,body:()=>{function e(t,i,p,d,n){const l=Math.cos(n),o=Math.sin(n),h=t-p,u=i-d;return[p+h*l-u*o,d+h*o+u*l]}return{rotatePoint:e}},inputs:[],outputs:["rotatePoint"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-27"),expanded:[],variables:[]},{id:27,body:(e,t,i,p,d,n,l,o,h,u,m,j,b,a,c,k,x,y,v,_,P,r,$)=>{const s=e.select(t.elements.svg),M=i.x.map((w,C)=>({index:C})),D=s.selectAll("g.vertex-handle").data(M,w=>w.index).join("g").attr("class","vertex-handle").style("cursor","move");D.selectAll("circle.hit-area").data(w=>[w]).join("circle").attr("class","hit-area").attr("r",18).attr("fill","transparent"),D.selectAll("circle.visible").data(w=>[w]).join("circle").attr("class","visible").attr("r",p*.7).attr("fill",`rgba(255, 102, 51, ${d})`).attr("stroke",`rgba(0, 0, 0, ${d*.8})`).attr("stroke-width",2).attr("pointer-events","none");function L(){const w=-n*Math.PI/180,C=.5,S=0;D.attr("transform",f=>{const[g,A]=l(o.x[f.index],o.y[f.index],C,S,w),I=h.xScale(g),R=h.yScale(A);return`translate(${I},${R})`})}return D.call(e.drag().on("start",function(){e.select(this).select("circle.visible").attr("stroke","#000").attr("stroke-width",2)}).on("drag",function(w,C){const S=-n*Math.PI/180,f=.5,g=0,A=h.xScale.invert(w.x),I=h.yScale.invert(w.y),[R,Q]=l(A,I,f,g,-S);o.x[C.index]=R,o.y[C.index]=Q,o.version++,e.select(this).attr("transform",`translate(${w.x},${w.y})`);const O=u({geometry:o,kuttaCondition:m,vInf:j,alpha:n});b.set(a(o,O));const V=c(o);k.vertices=V.vertices,k.indices=V.indices,x.value=y({geometry:o,solution:O,vInf:j}),t.dispatchEvent(new CustomEvent("liftchange")),typeof v=="function"&&(_.data=v(o,O,j,n),typeof P=="function"&&(_.centerOfPressure=P(o,_.data,n))),r.dirty=!0}).on("end",function(){e.select(this).select("circle.visible").attr("stroke",`rgba(0, 0, 0, ${d*.8})`).attr("stroke-width",2)})),L(),t.addEventListener("update",L),$.then(()=>t.removeEventListener("update",L)),{svgLayer:s,vertexData:M,handleGroups:D,updateHandlePositions:L}},inputs:["d3","stack","geometry","pointSize","vertexOpacity","alpha","rotatePoint","geometryState","axes","solveVortexPanel","kuttaCondition","vInf","panelData","preparePanelData","triangulateAirfoil","airfoilMesh","liftState","computeLift","computePanelCp","panelCpState","computeCenterOfPressure","renderState","invalidation"],outputs:["svgLayer","vertexData","handleGroups","updateHandlePositions"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-28"),expanded:[],variables:[]},{id:28,body:(e,t,i,p,d,n,l,o,h,u,m,j,b)=>{let a=e.select("g.force-arrow");a.empty()&&(a=e.append("g").attr("class","force-arrow").attr("pointer-events","none")),a.selectAll("*").remove();const c=a.append("path").attr("fill","white").attr("stroke","white").attr("stroke-width",6).attr("stroke-linejoin","round"),k=a.append("path").attr("fill","#4a90d9").attr("stroke","none");function x(){const y=t.value;if(!i||Math.abs(y)<.001){a.attr("visibility","hidden");return}a.attr("visibility","visible");const v=-p*Math.PI/180,_=.5,P=0;let r,$;if(d)r=.25,$=n*(l>.001?r<l?(2*l*r-r*r)/(l*l):(1-2*l+2*l*r-r*r)/((1-l)*(1-l)):0);else{const Y=o.centerOfPressure||{x:.25,y:0};r=Y.x,$=Y.y}const[s,M]=h(r,$,_,P,v),D=u.xScale(s),L=u.yScale(M),C=Math.abs(y)*m*Math.abs(u.yScale(0)-u.yScale(1)),S=-Math.PI/2-v,f=y>=0?1:-1,g=f*Math.cos(S),A=f*Math.sin(S),I=8,R=Math.min(25,C*.35),Q=22,O=-A,V=g,H=D,z=L,G=D+g*C,T=L+A*C,U=G-g*R,B=T-A*R,X=Q/2,q=I/2,F=`
    M ${H-O*q} ${z-V*q}
    L ${U-O*q} ${B-V*q}
    L ${U-O*X} ${B-V*X}
    L ${G} ${T}
    L ${U+O*X} ${B+V*X}
    L ${U+O*q} ${B+V*q}
    L ${H+O*q} ${z+V*q}
    Z
  `;c.attr("d",F),k.attr("d",F)}return x(),j.addEventListener("update",x),j.addEventListener("liftchange",x),b.then(()=>{j.removeEventListener("update",x),j.removeEventListener("liftchange",x)}),{forceArrowGroup:a,arrowOutline:c,arrowFill:k,updateForceArrow:x}},inputs:["svgLayer","liftState","showPressureDist","alpha","forceAtQuarterChord","camber","camberLoc","panelCpState","rotatePoint","axes","forceArrowScale","stack","invalidation"],outputs:["forceArrowGroup","arrowOutline","arrowFill","updateForceArrow"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-29"),expanded:[],variables:[]},{id:29,body:(e,t,i,p,d,n)=>({baseGeometry:e({count:t,m:i,p,t:d,clustering:n,closeEnd:!1})}),inputs:["meshAirfoil","panelCount","camber","camberLoc","thickness","clustering"],outputs:["baseGeometry"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-30"),expanded:[],variables:[]},{id:30,body:()=>{const e={x:[],y:[],version:0};return{geometryState:e,resetGeometry:p=>{e.x=[...p.x],e.y=[...p.y],e.version++},geometry:{get x(){return e.x},get y(){return e.y}}}},inputs:[],outputs:["geometryState","resetGeometry","geometry"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-31"),expanded:[],variables:[]},{id:31,body:(e,t,i,p,d)=>({vInf:1,solution:t({geometry:i,kuttaCondition:p,vInf:1,alpha:d})}),inputs:["geometryVersion","solveVortexPanel","geometry","kuttaCondition","alpha"],outputs:["vInf","solution"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-32"),expanded:[],variables:[]},{id:32,body:(e,t,i,p,d)=>(e.value=t({geometry:i,solution:p,vInf:d}),{liftCoeff:e.value}),inputs:["liftState","computeLift","geometry","solution","vInf"],outputs:["liftCoeff"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-33"),expanded:[],variables:[]},{id:33,body:async(e,t,i,p,d)=>{const{default:n}=await K(()=>import("./compute-winding-2zH5-t52.js"),[]).then(u=>{if(!("default"in u))throw new SyntaxError("export 'default' not found");return u});function l(u,m,j,b){const{x:a,y:c}=u,k=a.length-1,x=b*Math.PI/180,y=m.shape[0]>k?m.get(k):0,v=[],_=[],P=[],r=[];for(let s=0;s<k;s++){const M=c[s+1]-c[s],D=a[s+1]-a[s];r[s]=Math.atan2(M,D)}const $=n(a,c);for(let s=0;s<k;s++){const M=.5*(a[s]+a[s+1]),D=.5*(c[s]+c[s+1]);_.push([M,D]);const L=r[s],w=-Math.sin(L),C=Math.cos(L);P.push([w,C]);let S=j*Math.cos(L-x);for(let g=0;g<k;g++){const A=m.get(g),I=r[g],R=Math.sqrt((M-a[g])**2+(D-c[g])**2),Q=Math.sqrt((M-a[g+1])**2+(D-c[g+1])**2);let O=Math.PI*$;if(s!==g){const T=M-a[g],U=M-a[g+1],B=D-c[g],X=D-c[g+1],q=T*X-U*B,F=U*T+X*B;O=Math.atan2(q,F)}const V=Math.sin(L-I),H=Math.cos(L-I),z=Math.log(Q/R),G=.5/Math.PI;S+=G*A*(V*O-H*z),S+=G*y*(V*z+H*O)}const f=1-(S/j)**2;v.push(f)}return{cpValues:v,midpoints:_,normals:P}}function o(u,m,j){const{x:b,y:a}=u,c=b.length-1,k=j*Math.PI/180,x=-Math.sin(k),y=Math.cos(k);let v=0,_=0,P=0;for(let r=0;r<c;r++){const $=m.cpValues[r],[s,M]=m.midpoints[r],[D,L]=m.normals[r],w=b[r+1]-b[r],C=a[r+1]-a[r],S=Math.sqrt(w*w+C*C),f=-$*S,g=f*D,A=f*L,I=g*x+A*y;v+=I,_+=s*I,P+=M*I}return Math.abs(v)<1e-10?{x:.25,y:0}:{x:_/v,y:P/v}}e.data=l(t,i,p,d),e.centerOfPressure=o(t,e.data,d);const h=e.data;return{computeWinding:n,computePanelCp:l,computeCenterOfPressure:o,panelCpData:h}},inputs:["panelCpState","geometryState","solution","vInf","alpha"],outputs:["computeWinding","computePanelCp","computeCenterOfPressure","panelCpData"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-34"),expanded:[],variables:[]},{id:34,body:(e,t,i)=>(e(t),{geometryVersion:i.version}),inputs:["resetGeometry","baseGeometry","geometryState"],outputs:["geometryVersion"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-35"),expanded:[],variables:[]},{id:35,body:(e,t,i,p,d,n,l,o,h,u,m,j,b,a,c,k,x,y,v,_,P,r,$,s)=>{s.dirty=!0,s.render&&s.render()},inputs:["alpha","panelCount","camber","camberLoc","thickness","kuttaCondition","clustering","contourOpacity","shadingOpacity","streamlineCount","streamlineOpacity","streamlineLength","fillOpacity","edgeOpacity","edgeWidth","vertexOpacity","pointSize","showPressureDist","pressureScale","pressureOffset","panelData","airfoilMesh","panelCpData","renderState"],outputs:[],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-36"),expanded:[],variables:[]},{id:36,body:(e,t,i,p,d,n,l)=>{typeof l=="function"&&l()},inputs:["alpha","camber","camberLoc","liftCoeff","showPressureDist","forceAtQuarterChord","updateForceArrow"],outputs:[],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-37"),expanded:[],variables:[]},{id:37,body:()=>{const e={_data:null,get(t){return this._data[t]},get length(){return this._data.length},set(t){this._data=t},[Symbol.iterator](){return this._data[Symbol.iterator]()}};return Object.defineProperty(e,"buffer",{get(){return this._data.buffer}}),Object.defineProperty(e,"byteLength",{get(){return this._data.byteLength}}),{panelData:e}},inputs:[],outputs:["panelData"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-38"),expanded:[],variables:[]},{id:38,body:()=>({airfoilMesh:{vertices:null,indices:null}}),inputs:[],outputs:["airfoilMesh"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-39"),expanded:[],variables:[]},{id:39,body:(e,t,i,p,d)=>{e.set(t(i,p)),d.dirty=!0,d.render&&d.render()},inputs:["panelData","preparePanelData","geometryState","solution","renderState"],outputs:[],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-40"),expanded:[],variables:[]},{id:40,body:(e,t,i,p,d)=>{const n=t(i);return p.vertices=n.vertices,p.indices=n.indices,d.dirty=!0,d.render&&d.render(),{newMesh:n}},inputs:["geometryVersion","triangulateAirfoil","geometryState","airfoilMesh","renderState"],outputs:["newMesh"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-41"),expanded:[],variables:[]},{id:41,body:(e,t,i,p,d,n,l,o,h,u,m,j,b,a,c,k,x,y,v,_,P,r,$,s,M,D,L)=>{let w=null;function C(){if(e.dirty){console.log("render");try{let O=function(F,Y){const N=new Float32Array(16);for(let W=0;W<4;W++)for(let Z=0;Z<4;Z++)N[Z*4+W]=F[W]*Y[Z*4]+F[4+W]*Y[Z*4+1]+F[8+W]*Y[Z*4+2]+F[12+W]*Y[Z*4+3];return N},V=function(F,Y,N){const W=Math.cos(F),Z=Math.sin(F),J=Y*(1-W)+N*Z,tt=N*(1-W)-Y*Z;return new Float32Array([W,Z,0,0,-Z,W,0,0,0,0,1,0,J,tt,0,1])};const f=t.createCommandEncoder(),g=f.beginRenderPass({colorAttachments:[{view:i.getCurrentTexture().createView(),loadOp:"clear",storeOp:"store",clearValue:{r:0,g:0,b:0,a:0}}]}),A=p.elements.webgpu,I=d(n,devicePixelRatio,A.height);g.setViewport(I.x,I.y,I.width,I.height,0,1),g.setScissorRect(Math.floor(I.x),Math.floor(I.y),Math.floor(I.width),Math.floor(I.height));const R=l*Math.PI/180,Q=[o*Math.cos(R),o*Math.sin(R)],H=-l*Math.PI/180,z=.5,G=0,T=V(H,z,G),U=V(-H,z,G),B=O(n.view,T),X=O(U,n.viewInverse),q=h._data;if(!q){g.end(),t.queue.submit([f.finish()]),e.dirty=!1,w=requestAnimationFrame(S);return}if(u.drawField(g,{viewInverse:X,vInf:Q,panelData:q,panelCount:m.x.length-1,colorscale:j,contourOpacity:b,shadingOpacity:a}),c>0&&k>.01){const F=Math.hypot(B[0],B[5]);u.drawStreamlines(g,{view:B,viewInverse:X,vInf:Q,resolution:[A.width,A.height],panelData:q,panelCount:m.x.length-1,colorscale:j,lineWidth:2*devicePixelRatio,dt:.1/F,noise:.2,byPressure:0,streamlineCount:c,streamlineLength:x,opacity:k})}y&&v.data&&u.drawPressureDist(g,{view:B,geometry:_,cpData:v.data,scale:P,cpOffset:r,color:[.3,.5,1,.6]}),$>.01&&s.vertices&&s.indices&&u.drawAirfoil(g,{view:B,color:[.3,.3,.3,$],vertices:s.vertices,indices:s.indices}),M>.01&&u.drawPanelEdges(g,{view:B,geometry:_,color:[0,0,0,M],lineWidth:D*devicePixelRatio,resolution:[A.width,A.height]}),g.end(),t.queue.submit([f.finish()]),e.dirty=!1}catch(f){console.error("Render error:",f)}}}function S(){C(),w=requestAnimationFrame(S)}return w=requestAnimationFrame(S),e.render=C,L.then(()=>{w!==null&&(cancelAnimationFrame(w),w=null)}),{animFrameId:w,render:C,renderLoop:S}},inputs:["renderState","device","gpuContext","stack","webgpuAxesViewport","axes","alpha","vInf","panelData","renderer","geometry","colorscale","contourOpacity","shadingOpacity","streamlineCount","streamlineOpacity","streamlineLength","showPressureDist","panelCpState","geometryState","pressureScale","pressureOffset","fillOpacity","airfoilMesh","edgeOpacity","edgeWidth","invalidation"],outputs:["animFrameId","render","renderLoop"],output:void 0,assets:void 0,autodisplay:!1,autoview:void 0,automutable:void 0});E({root:document.getElementById("cell-42"),expanded:[],variables:[]},{id:42,body:(e,t)=>e`## GPU Field Evaluation

The panel method solution (source strengths ${t`\sigma_j`} and vortex strength ${t`\gamma`}) is computed on the CPU, then uploaded to the GPU. For each pixel, the fragment shader evaluates the induced velocity by summing contributions from all panels.

At any field point ${t`\mathbf{r}`}, iterating over panels:

${t.block`
\mathbf{v}_\text{induced} = \frac{1}{2\pi}\sum_{j=1}^{n} \Bigl[\sigma_j\bigl(-\lambda_j\,\mathbf{t}_j + \beta_j\,\mathbf{n}_j\bigr) + \gamma\bigl(\beta_j\,\mathbf{t}_j + \lambda_j\,\mathbf{n}_j\bigr)\Bigr]
`}

where ${t`\beta_j`} and ${t`\lambda_j`} are computed from the vectors to each panel's endpoints.

The pressure coefficient follows from Bernoulli's equation for incompressible flow:

${t.block`C_p = 1 - \frac{|\mathbf{v}|^2}{|\mathbf{v}_\infty|^2}`}

Streamlines are traced by integrating the velocity field in the vertex shader. Each streamline is rendered as a triangle strip with opacity that fades toward the ends.`,inputs:["md","tex"],outputs:[],output:void 0,assets:void 0,autodisplay:!0,autoview:!1,automutable:void 0});
