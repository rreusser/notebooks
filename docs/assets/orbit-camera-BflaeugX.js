import{quat as o,vec3 as a,mat4 as r}from"https://cdn.jsdelivr.net/npm/gl-matrix@3.4.3/+esm";class j{constructor(t=[0,0,-10],e=[0,0,0],c=[0,1,0]){this.rotation=o.create(),this.center=a.clone(e),this.distance=1,this._scratch0=new Float32Array(16),this._scratch1=new Float32Array(16),this._scratchVec=a.create(),this.lookAt(t,e,c)}lookAt(t,e,c){const s=this._scratch0;r.lookAt(s,t,e,c);const i=s,p=[i[0],i[1],i[2],i[4],i[5],i[6],i[8],i[9],i[10]];o.fromMat3(this.rotation,p),a.copy(this.center,e),this.distance=a.distance(t,e)}view(t=r.create()){const e=this._scratch0;this._scratch1;const c=this._scratchVec;return c[0]=0,c[1]=0,c[2]=-this.distance,o.conjugate(e,this.rotation),r.fromRotationTranslation(t,e,c),a.negate(c,this.center),r.translate(t,t,c),t}pan(t){const e=this.distance,c=this._scratchVec;c[0]=-e*(t[0]||0),c[1]=e*(t[1]||0),c[2]=e*(t[2]||0),a.transformQuat(c,c,this.rotation),a.add(this.center,this.center,c)}zoom(t){this.distance*=Math.exp(t/10),this.distance<.01&&(this.distance=.01)}rotate(t,e){const c=this._scratch0,s=this._scratch1;v(c,t),v(s,e),o.invert(s,s),o.multiply(c,c,s),!(o.length(c)<1e-6)&&(o.multiply(this.rotation,this.rotation,c),o.normalize(this.rotation,this.rotation))}}function v(n,t){const e=t[0],c=t[1];t[2];let s=e*e+c*c;s>1&&(s=1),n[0]=-t[0],n[1]=t[1],n[2]=t[2]||Math.sqrt(1-s),n[3]=0}function M(n,t={}){const e=t.eye||[0,1,-20],c=t.center||[0,0,0],s=t.up||[0,1,0],i=t.fovy||Math.PI/4,p=t.near||.1,y=t.far||200,u=new j(e,c,s),h=r.create(),l=r.create(),m=r.create();let f=!0;const _=n({uniforms:{view:()=>h,projection:()=>l,projectionView:()=>m},context:{view:()=>h,projection:()=>l,projectionView:()=>m,dirty:()=>f}});return{camera:u,projectionView:m,taint(){f=!0},tick(V){const w=n._gl,d=w.canvas.width/w.canvas.height;u.view(h),r.perspective(l,i,d,p,y),r.multiply(m,l,h),_(()=>{V({dirty:f})}),f=!1}}}export{j as OrbitCamera,M as createReglCamera,j as default};
