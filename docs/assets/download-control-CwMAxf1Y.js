class u{onAdd(e){this._map=e,this._container=document.createElement("div"),this._container.classList.add("mapboxgl-ctrl"),this._container.classList.add("mapboxgl-ctrl-group"),this._container.classList.add("mapboxgl-ctrl-download");const t=document.createElement("button");t.setAttribute("aria-label","Download snapshot"),t.setAttribute("title","Download snapshot"),t.style.lineHeight="29px",t.style.fontSize="18px";const i=document.createElement("span");return i.classList.add("mapboxgl-ctrl-icon"),i.setAttribute("aria-hidden",!0),i.textContent="ðŸ“·",t.appendChild(i),t.addEventListener("click",this.download.bind(this)),this._container.appendChild(t),this._container}download(){this._map.once("render",()=>{const e=document.createElement("a");e.target="_blank",e.download="map.png",this.prepareImage(this._map.getCanvas()).then(t=>{e.href=t,document.body.appendChild(e),e.click(),document.body.removeChild(e)}).catch(t=>{console.error(t)})}),this._map.triggerRepaint()}prepareImage(e){const t=window.devicePixelRatio,i=document.createElement("canvas");i.width=e.width,i.height=e.height;const n=i.getContext("2d");n.drawImage(e,0,0),n.scale(t,t);const h=this._map.getContainer().querySelector(".mapboxgl-ctrl-logo"),l=this._map.getContainer().querySelector(".mapboxgl-ctrl-attrib"),m=e.width/t,d=e.height/t;let g=Promise.resolve();if(h){const a=new Image,r=23,c=88;g=new Promise(function(o,s){a.onload=()=>o(a),a.onerror=s}).then(o=>{o&&n.drawImage(o,6,d-r-6,c,r)}),a.src=window.getComputedStyle(h).backgroundImage.replace(/^url\(['"]/,"").replace(/['"]\)$/,"")}if(l){const a=l.textContent.replace("Improve this map","").trim();n.font=`${window.getComputedStyle(l).fontSize} ${window.getComputedStyle(l).fontFamily}`;const r=3,c=5;n.textAlign="right",n.textBaseline="bottom";const o=n.measureText(a),s=o.fontBoundingBoxAscent+o.fontBoundingBoxDescent;n.fillStyle="rgb(255 255 255 / .5)",n.fillRect(m-o.width-2*c,d-s-2*r,o.width+2*c,s+2*r),n.fillStyle="black",n.fillText(a,m-c,d-o.fontBoundingBoxDescent-r)}return g.then(()=>i.toDataURL())}onRemove(){this._container.remove()}}export{u as default};
