function Q(e,r,a={}){const V=a.fov||Math.PI/4,L=a.near||.1,y=a.far||1e3,u=a.rotateSpeed||1,_=a.zoomSpeed||.001,f=a.panSpeed||1,O=a.deferEvents||!1,m=new Float32Array(16),i=new Float32Array(16),D=new Float32Array(16);let l=!0,C=!1,E=null,g=0,p=0,h=0,d=0,j=0,N=0,M=!1;const k=5;let w=0,x=0,T=0,Y=null;function v(t){const o=1/Math.tan(V/2),c=1/(L-y);i[0]=o/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=(L+y)*c,i[11]=-1,i[12]=0,i[13]=0,i[14]=L*y*c*2,i[15]=0}function K(t){r.view(m),v(t);for(let o=0;o<4;o++)for(let c=0;c<4;c++){let n=0;for(let s=0;s<4;s++)n+=i[o+s*4]*m[s+c*4];D[o+c*4]=n}}function b(t){if(t.target.tagName==="INPUT"||t.target.tagName==="BUTTON"||t.target.tagName==="SELECT")return;t.preventDefault(),j=t.clientX,N=t.clientY,g=t.clientX,p=t.clientY,M=!1;const o=e.getBoundingClientRect();h=(t.clientX-o.left)/o.width-.5,d=(t.clientY-o.top)/o.height-.5,E=t.shiftKey||t.button===2?"pan":"rotate",C=!0,e.style.cursor="grabbing",window.addEventListener("mousemove",B),window.addEventListener("mouseup",R)}function B(t){if(!C)return;if(!M){const n=t.clientX-j,s=t.clientY-N;if(Math.sqrt(n*n+s*s)<k)return;M=!0}const o=t.clientX-g,c=t.clientY-p;if(g=t.clientX,p=t.clientY,E==="rotate"){const n=e.getBoundingClientRect(),s=(t.clientX-n.left)/n.width-.5,X=(t.clientY-n.top)/n.height-.5;r.rotate([-h*u,-d*u],[-s*u,-X*u]),h=s,d=X}else if(E==="pan"){const n=e.getBoundingClientRect();r.pan([o/n.height*f,c/n.height*f])}l=!0}function R(){C=!1,E=null,e.style.cursor="grab",window.removeEventListener("mousemove",B),window.removeEventListener("mouseup",R)}function z(t){t.preventDefault();const o=e.getBoundingClientRect(),c=(t.clientX-o.left-o.width/2)/o.height,n=(t.clientY-o.top-o.height/2)/o.height,s=r.distance;r.zoom(t.deltaY*_*30);const S=1-r.distance/s;r.pan([-c*S*f,-n*S*f]),l=!0}function A(t){if(t.touches.length===1){Y="rotate",g=t.touches[0].clientX,p=t.touches[0].clientY;const o=e.getBoundingClientRect();h=(t.touches[0].clientX-o.left)/o.width-.5,d=(t.touches[0].clientY-o.top)/o.height-.5}else if(t.touches.length===2){t.preventDefault(),Y="pinch";const o=t.touches[1].clientX-t.touches[0].clientX,c=t.touches[1].clientY-t.touches[0].clientY;w=Math.sqrt(o*o+c*c),x=(t.touches[0].clientX+t.touches[1].clientX)/2,T=(t.touches[0].clientY+t.touches[1].clientY)/2}}function F(t){if(t.touches.length===1&&Y==="rotate"){t.preventDefault();const o=e.getBoundingClientRect(),c=(t.touches[0].clientX-o.left)/o.width-.5,n=(t.touches[0].clientY-o.top)/o.height-.5;r.rotate([-h*u,-d*u],[-c*u,-n*u]),h=c,d=n,g=t.touches[0].clientX,p=t.touches[0].clientY,l=!0}else if(t.touches.length===2&&Y==="pinch"){t.preventDefault();const o=t.touches[1].clientX-t.touches[0].clientX,c=t.touches[1].clientY-t.touches[0].clientY,n=Math.sqrt(o*o+c*c),s=(t.touches[0].clientX+t.touches[1].clientX)/2,X=(t.touches[0].clientY+t.touches[1].clientY)/2;if(w>0){const G=(w/n-1)*30;r.zoom(G);const U=e.getBoundingClientRect(),H=(s-x)/U.height*f,J=(X-T)/U.height*f;r.pan([H,J]),l=!0}w=n,x=s,T=X}}function Z(t){if(t.touches.length===0)Y=null,w=0;else if(t.touches.length===1){Y="rotate",g=t.touches[0].clientX,p=t.touches[0].clientY;const o=e.getBoundingClientRect();h=(t.touches[0].clientX-o.left)/o.width-.5,d=(t.touches[0].clientY-o.top)/o.height-.5,w=0}}function q(t){t.preventDefault()}let I=!1;function P(){I||(I=!0,e.style.cursor="grab",e.addEventListener("mousedown",b),e.addEventListener("wheel",z,{passive:!1}),e.addEventListener("touchstart",A,{passive:!1}),e.addEventListener("touchmove",F,{passive:!1}),e.addEventListener("touchend",Z),e.addEventListener("contextmenu",q))}O||P();function W(){e.removeEventListener("mousedown",b),e.removeEventListener("wheel",z),e.removeEventListener("touchstart",A),e.removeEventListener("touchmove",F),e.removeEventListener("touchend",Z),e.removeEventListener("contextmenu",q),window.removeEventListener("mousemove",B),window.removeEventListener("mouseup",R)}return{attachEvents:P,camera:r,projectionView:D,get dirty(){return l},taint(){l=!0},update(t){K(t);const o=l;return l=!1,{view:m,projection:i,projectionView:D,dirty:o}},destroy:W}}export{Q as createOrbitCameraController,Q as default};
